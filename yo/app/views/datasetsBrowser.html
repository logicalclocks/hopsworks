<div ng-controller="MainCtrl as mainCtrl">
  <div ng-include="'nav.html'"></div>


  <div id="wrapper"
       class="toggled"
       ng-controller="DatasetsCtrl as datasetsCtrl">

    <div ng-controller="MetadataCtrl as metadataCtrl">

      <div class="overlay"></div>
      <section layout="row" flex="">

        <md-content flex="" layout-padding="">
          <div ng-include="'navProject.html'"></div>
          <div align="center" id="projectSearchResults">
            <p ng-bind-html="mainCtrl.searchResult"></p>
          </div>

          <div layout="column" layout-fill="" layout-align="top center">
            <div ng-show="mainCtrl.searchReturned !== ''">
              <div id="projectSearchResults">
                <div ng-include="'views/searchResult.html'"></div>
              </div>
            </div>
            
            <div class="content-wrapper" ng-controller="ProjectCtrl as projectCtrl" ng-show="mainCtrl.searchReturned === ''">
              <h3>
                <a href="#/project/{{datasetsCtrl.projectId}}/datasets">
                  {{ projectCtrl.currentProject.projectName}}
                </a>
                <span data-ng-repeat="path in datasetsCtrl.pathArray track by $index">/
                  <a ng-click="datasetsCtrl.goToFolder($index)">{{path}}</a></span>
              </h3>
              <div class="row">
                <div class="col-lg-2" style="margin-top: 13px;">
                  <table id="mytable" class="table table-bordred table-striped" style="margin-bottom:0px;">
                    <thead>
                    <th style="border-bottom: 1px solid #e7eaec; color: #2e353d; font-size: 22px">
                      <i class="glyphicon glyphicon-folder-open" style="padding-right: 10px;"></i>
                      {{datasetsCtrl.pathArray[0]| limitTo: 17 }}{{datasetsCtrl.pathArray[0].length > 17 ? '...' : ''}}
                    </th>
                    </thead>
                  </table>
                  <p></p>
                  <div class="btn-group"
                       style="width: 100%;">
                    <button style="width: 100%;"
                            ng-click="datasetsCtrl.newDataSetModal()"
                            class="btn btn-warning">
                      New Folder
                    </button>
                  </div>
                  <div class="btn-group"
                       style="width: 100%; margin-top: 10px;">
                    <button style="width: 100%;"
                            ng-click="datasetsCtrl.uploadFile()"
                            class="btn btn-primary">
                      Upload file
                    </button>
                  </div>
                  <div class="ibox-content" style="margin-top:15px;"></div>


                </div>
                <div class="col-lg-7">
                  <div class="row">
                    <div class="col-md-12" style="margin-top: 25px;">
                      <div class="table-responsive" style="overflow: hidden;">

                        <table class="table table-bordred table-hover" >

                          <thead>
                          <th >Name</th>
                          <th >Owner</th>
                          <th >Last modified</th>
                          <th >File size</th>
                          <th></th>
                          <th></th>
                          </thead>

                          <tbody ng-model="datasetsCtrl.files">

                            <tr ng-click="datasetsCtrl.back()">
                              <td style="padding: 0px" colspan="4">&nbsp &nbsp
                                <a style="font-size:25px">..</a>
                              </td>
                            </tr>

                            <tr ng-repeat="file in datasetsCtrl.files| orderBy: 'name'"
                                context-menu
                                data-target="menu-{{ $index}}"

                                ng-class="{ 'highlight': datasetsCtrl.selected === $index, 'expanded': expanded }"
                                ng-dblclick="datasetsCtrl.openDir(file)"
                                ng-click="datasetsCtrl.select($index, file); metadataCtrl.setMetadataTemplate(file)"
                                id="table-{{ $index}}">

                              <td>
                                <i ng-show="file.dir" class="glyphicon glyphicon-folder-close" style="padding-right: 10px; color: #757575;"></i>
                                <i ng-show="!file.dir" class="glyphicon glyphicon-file" style="padding-right: 10px; color: #757575;"></i>
                                {{file.name}}</td>

                              <td>{{file.owner}} me</td>
                              <td>{{file.modification| date:'short'}} <span style=" color: #757575; font-size: 12px; padding-left: 5px;">me</span>
                              </td>
                              <td style="width: 12%;">{{(file.size == 0? '_': projectCtrl.sizeOnDisk(file.size))}}</td>

                              <td>
                                <div class="dropdown position-fixed" id="menu-{{ $index}}">
                                  <ul class="dropdown-menu dropdown-amore" role="menu">
                                    <li>
                                      <a class="pointer"
                                         role="menuitem"
                                         tabindex="1"
                                         ng-click="panel.highlight = true">
                                        <span><i class="fa fa-file-archive-o"></i>
                                          Compress</span>
                                      </a>
                                    </li>

                                    <li>
                                      <a class="pointer"
                                         role="menuitem"
                                         tabindex="2"
                                         ng-click="">
                                        <span><i class="fa fa-share-alt"></i>
                                          Share...</span>
                                      </a>
                                    </li>
                                    <li>
                                      <a class="pointer"
                                         role="menuitem"
                                         tabindex="3"
                                         ng-click="metadataCtrl.attachTemplate(file); $event.stopPropagation();">
                                        <span><i class="fa fa-upload"></i>
                                          Add metadata template</span>
                                      </a>
                                    </li>

                                    <li>
                                      <a class="pointer"
                                         role="menuitem"
                                         tabindex="4"
                                         ng-click="metadataCtrl.detachTemplate(file); $event.stopPropagation();">
                                        <span><i class="fa fa-download"></i>
                                          Remove metadata template</span>
                                      </a>
                                    </li>

                                    <li>
                                      <a class="pointer"
                                         role="menuitem"
                                         tabindex="5"
                                         ng-click="datasetsCtrl.deleteFile(file.name)">
                                        <span><i class="fa fa-trash"></i>
                                          Remove</span>
                                      </a>
                                    </li>

                                  </ul>
                                </div>
                              </td>

                              <td style="margin:0px;width:25px;">
                                <i ng-if="$index >= 5"
                                   title="This file is compressed"
                                   style="color: lightgrey; margin-top:3px;"
                                   class="glyphicon glyphicon-compressed">
                                </i>
                                <i ng-if="file.underConstruction"
                                   title="File under construction"
                                   style="color: lightgrey; margin-top:3px;"
                                   class="glyphicon glyphicon-transfer">
                                </i>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-lg-3" style="border-left: 1px dashed lightgrey; padding-left: 0px;">
                  <div class="ibox float-e-margins">
                    <div class="file-manager">
                      <div>
                        <md-content class="md-padding" style="padding-top: 0px; min-width: 300px; max-width: 395px">
                          <md-tabs md-dynamic-height md-border-bottom>
                            <md-tab label="Details">
                              <md-content>
                                <table id="mytable1" ng-show="datasetsCtrl.selected > - 1 && datasetsCtrl.selected != undefined" class="table table-bordred table-striped" style="margin-top: 16px;">
                                  <tr style="background-color: #fafafa">
                                    <td style="color:lightgrey;">Size</td>
                                    <td style="color: grey;">{{(datasetsCtrl.fileDetail.size == 0? '_': projectCtrl.sizeOnDisk(datasetsCtrl.fileDetail.size))}}</td>
                                  </tr>

                                  <tr style="background-color: #fafafa">
                                    <td style="color:lightgrey;">Description</td>
                                    <td style="color: grey;">{{datasetsCtrl.fileDetail.name}}</td>
                                  </tr>

                                  <tr style="background-color: #fafafa">
                                    <td style="color: lightgrey;">Type</td>
                                    <td ng-show="!datasetsCtrl.fileDetail.dir" style="color: grey;">File</td>
                                    <td ng-show="datasetsCtrl.fileDetail.dir" style="color: grey;">Directory</td>
                                  </tr>

                                  <tr style="background-color: #fafafa">
                                    <td style="color:lightgrey;">Last changed</td>
                                    <td style="color: grey;">{{datasetsCtrl.fileDetail.modification| date:'short'}}</td>
                                  </tr>

                                  <tr style="background-color: #fafafa">
                                    <td style="color:lightgrey;">Owner</td>
                                    <td style="color: grey;">André More</td>
                                  </tr>
                                </table>

                              </md-content>


                              <div class="ibox-content" id="hoverable" ng-click="datasetsCtrl.toggleRight()">
                                <span class="pull-left" style="font-size: 16px; margin-top:-2px;">Add metadata</span> <i
                                  class="fa fa-pencil-square-o pull-right" style="font-size: 20px;"></i>
                              </div>
                              <!--METADATA PRESENTATION SECTION-->
                              <div id="board">
                                <div class="modal-header">
                                  <h4 class="modal-title" ng-model="columnName">Metadata in file <font size="5" color="green">
                                    <b>{{metaSliderCtrl.currentFile.name}}</b></font></h4>
                                </div>

                                <div class="" height="80%">
                                  <div class="input-group-lg" align="center">
                                    <div ng-repeat="table in metadataCtrl.meta"><h2>{{table.name}}</h2>
                                      <div>
                                        <div ng-repeat="field in table.rest"><b><i>{{field.tagName}}</i></b>
                                          <div ng-repeat="value in field.metadataView">
                                            <a href="#" editable-text="value.data" buttons="no"
                                               onaftersave="metadataCtrl.updateMetadata(value)"
                                               blur="submit"
                                               style="font-size: 16px;"
                                               class="column-title ng-binding"
                                               >
                                              {{value.data}}
                                            </a>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>

                            </md-tab>
                            <md-tab label="Activity">
                              <md-content class="md-padding" style="padding-left: 20px;padding-right: 20px;">

                                <div class="row">
                                  <span
                                    style="color: #444;font-size: 11px; margin-bottom: 10px;padding: 16px 6px 6px;text-transform: uppercase;">
                                    LAST WEEK
                                  </span>

                                  <md-whiteframe class="md-whiteframe-z1" layout layout-align="center center"
                                                 style="border-radius: 3px; margin-top:10px;">
                                    <div class="col-md-2" style="margin-top: -45px;">
                                      <img class="profile-image img-circle" style="height: 42px; border: 1px solid lightgrey;"
                                           src="http://gravatar.com/avatar/4b43f0e86b038f246887dde7f399a5a3?d=mm">
                                    </div>
                                    <div class="col-md-10" style="margin-top: 12px;padding-left:20px;">
                                      <b>You</b> uploaded an item
                                      </br>
                                      <span style="color:#444; font-size: 11px;">Apr 30</span>

                                      <p style="margin-top: 20px; color:#444;">
                                        SICSEngineering.pdf
                                      </p>
                                    </div>
                                  </md-whiteframe>

                                  <md-whiteframe class="md-whiteframe-z1" layout layout-align="center center"
                                                 style="border-radius: 3px; margin-top:20px; margin-bottom: 20px;">
                                    <div class="col-md-2" style="margin-top: -45px;">
                                      <img class="profile-image img-circle" style="height: 42px; border: 1px solid lightgrey;"
                                           src="http://gravatar.com/avatar/4b43f0e86b038f246887dde7f399a5a3?d=mm">
                                    </div>
                                    <div class="col-md-10" style="margin-top: 12px;padding-left:20px;">
                                      <b>André</b> uploaded an item
                                      </br>
                                      <span style="color:#444; font-size: 11px;">Apr 11</span>

                                      <p style="margin-top: 20px; color:#444;">
                                        AndreSecretFile.rsa
                                      </p>
                                    </div>
                                  </md-whiteframe>

                                  <span
                                    style="color: #444;font-size: 11px; margin-bottom: 10px;padding: 16px 6px 6px;text-transform: uppercase;">
                                    EARLIER THIS MONTH
                                  </span>


                                  <md-whiteframe class="md-whiteframe-z1" layout layout-align="center center"
                                                 style="border-radius: 3px; margin-top:10px;">
                                    <div class="col-md-2" style="margin-top: -45px;">
                                      <img class="profile-image img-circle" style="height: 42px; border: 1px solid lightgrey;"
                                           src="http://gravatar.com/avatar/f7b87f83afcba880c6300e1e4e4a8790?d=mm">
                                    </div>
                                    <div class="col-md-10" style="margin-top: 12px;padding-left:20px;">
                                      <b>Ermias</b> uploaded an item
                                      </br>
                                      <span style="color:#444; font-size: 11px;">Apr 07</span>

                                      <p style="margin-top: 20px; color:#444;">
                                        happy_birthday.cake
                                      </p>
                                    </div>
                                  </md-whiteframe>
                                </div>
                              </md-content>
                            </md-tab>
                          </md-tabs>
                        </md-content>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div flex=""></div>
        </md-content>

        <!-- Slideout - Add Metadata -->
        <md-sidenav class="md-sidenav-right md-whiteframe-z2" md-component-id="right"
                    style="margin-top: 0px;">

          <md-toolbar class="md-theme-light"
                      style="background-color: #f1f1f1;color: gray; height: 39px; min-height: 39px;">

            <div class="md-toolbar-tools">
              <h2 style="margin:0;">
                <span>Metadata manager</span>
              </h2>
              <span flex></span>
              <button style="font-size:15px;height:28px;color:white;padding-top: 3px;"
                      ng-click="metadataCtrl.submitMetadata(metadataCtrl.metaData); datasetsCtrl.close()"
                      class="btn btn-success">
                <i class="fa fa-save"></i>
                Save
              </button>
            </div>

          </md-toolbar>
          <md-content layout-padding>
            <p>Associating metadata to: <a><b>'{{metadataCtrl.currentFile.name}}'</b></a></p>

            <label class="control-label" ng-show="datasetsCtrl.currentTemplateID === - 1">
              <font color="red">There is no template attached to file {{metadataCtrl.currentFile.name}}</font>
            </label>
            <p></p>

            <tabset justified="false">
              <tab ng-repeat="tab in metadataCtrl.tabs" class="tab-title" heading="{{tab.title}}" active="tab.active"
                   disabled="tab.disabled" select="metadataCtrl.onTabSelect(tab)"
                   style="padding-left: 1em;">

                <form name="{{tab.title}}{{$index}}" ng-submit="metadataCtrl.submitMetadata(metadataCtrl.metaData)"
                      style="padding:0em 1em 50em 1em;">

                  <ul class="card-list" ng-model="column.cards">
                    <li ng-repeat="card in tab.cards" style="padding-bottom: 0;">
                      <div style="padding-bottom: 0;">

                        <!--The table section-->
                        <div class="row col-md-15" style="padding-bottom: 0;">
                          <!--The row section-->
                          <div class="col-md-12" style="padding-bottom: 0;">
                            <div tabindex="1" class="col-md-2">
                              <span class="card-title pull-right btn btn-xs"
                                    style="font-size: 1em">{{card.title}}</span>
                            </div>

                            <div tabindex="2" class="col-md-1" style="padding-bottom: 0;">
                              <span class="field-info pull-left" tooltip="{{card.description}}">
                                <i class="fa fa-exclamation-circle"></i>
                              </span>
                            </div>

                            <div tabindex="3" class="pull-left col-md-9" style="padding-bottom: 0;">
                              <!--text input field type-->
                              <div ng-if="card.fieldtypeid === 1">
                                <input value="" class="fillInMetadataInput" id="sizeFieldInput"
                                       tooltips title="{{card.description}}"
                                       ng-show="true"
                                       ng-model="metadataCtrl.metaData[card.id]"/>
                              </div>

                              <!--single select list input type-->
                              <div ng-if="card.fieldtypeid === 2">

                                <ui-select ng-model="metadataCtrl.metaData[card.id]" theme="select2" ng-disabled="disabled" style="min-width: 300px;" required>
                                  <ui-select-match placeholder="Select a value...">{{$select.selected.value}}</ui-select-match>
                                  <ui-select-choices repeat="item.value as item in card.fieldtypeContent | filter: $select.search">
                                    <!--<div ng-bind-html="item.value | highlight: $select.search"></div>-->
                                    <small>
                                      <span ng-bind-html="''+item.value | highlight: $select.search"></span>
                                    </small>
                                  </ui-select-choices>
                                </ui-select>
                              </div>

                              <!--multi select list input type-->
                              <div ng-if="card.fieldtypeid === 3">
                                <div
                                  isteven-multi-select
                                  input-model="card.fieldtypeContent"
                                  output-model="metadataCtrl.metaData[card.id]"
                                  button-label="value"
                                  item-label="value"
                                  tick-property="ticked"
                                  output-properties="value"
                                  >
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <hr>
                      </div>
                    </li>
                  </ul>
                  <hr/>
                  <div>
                    <button class="btn btn-default">
                      <i class="glyphicon glyphicon-floppy-save"></i>
                      Save
                    </button>
                    <button class="btn btn-default" type="button"
                            ng-click="datasetsCtrl.close()">
                      <i class="glyphicon glyphicon-chevron-left"></i>
                      Back
                    </button>
                  </div>
                </form>
              </tab>
            </tabset>
          </md-content>
        </md-sidenav>
    </div>
    </section>
  </div>
</div>
