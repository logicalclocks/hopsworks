<!--
  ~ Changes to this file committed after and not including commit-id: ccc0d2c5f9a5ac661e60e6eaf138de7889928b8b
  ~ are released under the following license:
  ~
  ~ This file is part of Hopsworks
  ~ Copyright (C) 2018, Logical Clocks AB. All rights reserved
  ~
  ~ Hopsworks is free software: you can redistribute it and/or modify it under the terms of
  ~ the GNU Affero General Public License as published by the Free Software Foundation,
  ~ either version 3 of the License, or (at your option) any later version.
  ~
  ~ Hopsworks is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
  ~ without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
  ~ PURPOSE.  See the GNU Affero General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License along with this program.
  ~ If not, see <https://www.gnu.org/licenses/>.
  ~
  ~ Changes to this file committed before and including commit-id: ccc0d2c5f9a5ac661e60e6eaf138de7889928b8b
  ~ are released under the following license:
  ~
  ~ Copyright (C) 2013 - 2018, Logical Clocks AB and RISE SICS AB. All rights reserved
  ~
  ~ Permission is hereby granted, free of charge, to any person obtaining a copy of this
  ~ software and associated documentation files (the "Software"), to deal in the Software
  ~ without restriction, including without limitation the rights to use, copy, modify, merge,
  ~ publish, distribute, sublicense, and/or sell copies of the Software, and to permit
  ~ persons to whom the Software is furnished to do so, subject to the following conditions:
  ~
  ~ The above copyright notice and this permission notice shall be included in all copies or
  ~ substantial portions of the Software.
  ~
  ~ THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS  OR IMPLIED, INCLUDING
  ~ BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  ~ NONINFRINGEMENT. IN NO EVENT SHALL  THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
  ~ DAMAGES OR  OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
  ~ OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
  -->

<div ng-controller="MainCtrl as mainCtrl">
  <div ng-include="'nav.html'"></div>


  <div id="wrapper" class="toggled" ng-controller="ProjectCtrl as projectCtrl">
    <div class="overlay"></div>

    <div ng-include="'navProject.html'"></div>
    <div class="job-content-wrapper">
      <h3 id="projectBread" style="display: none;"> {{ projectCtrl.currentProject.projectName}} / Jobs</h3>
    </div>
    <div class="" ng-controller="PythonCtrl as pythonCtrl">

      <section>
        <div class="content-wrapper">
          <div ng-if="pythonCtrl.loading" class="loadingwrap" style="z-index: 1000;">
            <div class="loading-content">
              <div class="loader-in-wrap"></div>
              {{pythonCtrl.loadingText}}
            </div>
          </div>
          <h3 id="projectSetings" style="display: none;"> {{ projectCtrl.currentProject.projectName}} Settings</h3>


          <div ng-init="indextab = 0">

            <uib-tabset active="indextab">

              <uib-tab index="0" heading="Conda Libraries">

                <div ng-show="!pythonCtrl.enabled">

                  <div class="jumbotron" style="margin-top: 30px;">
                    <div class="col-md-offset-1">
                      <h1 class="display-3">Anaconda</h1>
                      <p class="lead">Jupyter requires an Anaconda installation. Select one of the two options below.</p>
                      <br />
                      <p class="lead"><b> Option 1 (Recommended for new users): </b> Create a default environment with
                        pre-installed libraries.</p>
                      <p>You can change the version of Python at a later stage by recreating the Anaconda environment.</p>
                      <p class="lead">
                      <div>
                        <div class="btn-group" uib-dropdown style="z-index: 0;">
                          <button ng-disabled="pythonCtrl.enabling" id="single-button" type="button"
                                  class="btn btn-success btn-lg"
                                  uib-dropdown-toggle >
                            Select version &nbsp;<span class="caret"></span>
                          </button>
                          <ul class="dropdown-menu" uib-dropdown-menu role="menu" aria-labelledby="single-button">
                            <li role="menuitem"><a ng-click="pythonCtrl.enable('2.7')">Python 2.7</a></li>
                            <li class="divider"></li>
                            <li role="menuitem"><a ng-click="pythonCtrl.enable('3.6')">Python 3.6</a></li>
                          </ul>
                        </div>
                      </div>
                      </p>
                      <br />
                      <p><b> Option 2: </b> Create environment from Anaconda .yml file.</p>

                      <button ng-disabled="pythonCtrl.enabling" class="btn btn-success btn-lg" type="button"
                              ng-click="pythonCtrl.selectYmlFile()">
                        Select .yml
                      </button>
                    </div>
                  </div>

                </div>
                <div class="col-md-offset-1" ng-show="pythonCtrl.enabled">
                  <h2>Install Python libraries using conda in Anaconda environment </h2>

                  <span ng-show="pythonCtrl.pythonVersion != '0.0'">Python Version is
                      {{pythonCtrl.pythonVersion}}</span>

                  <div class="row">
                    <div class="col-md-5 progress" ng-if="pythonCtrl.enabling">
                      <div class="progress-bar progress-bar-success progress-bar-striped active" role="progressbar"
                           aria-valuenow="{{pythonCtrl.progress()}}" aria-valuemin="0" aria-valuemax="100" style="width:100%">
                        Creating new Anaconda environment...
                      </div>
                    </div>
                    <div class="col-md-5 progress" ng-if="pythonCtrl.removing">
                      <div class="progress-bar progress-bar-success progress-bar-striped active" role="progressbar"
                           aria-valuenow="{{pythonCtrl.progress()}}" aria-valuemin="0" aria-valuemax="100" style="width:100%">
                        Removing old Anaconda environment...
                      </div>
                    </div>
                  </div>
                    <div style="margin-top: 15px;">
                      <div>Conda Channel: <a uib-tooltip="You can search a different conda channel by entering a new channel name here." tooltip-placement="top"
                                             href="#" data-inputclass="xwdith" editable-text="pythonCtrl.condaChannel">{{ pythonCtrl.condaChannel || 'default' }}</a></div>
                    </div>
                  <fieldset>
                    <div class="control-group">
                      <div class="row"></div>
                      <form name="condaNestedForm"
                            ng-submit="pythonCtrl.install(condaLib, 'conda', pythonCtrl.machineTypeVal, condaVersion)">
                        <div class="form-group has-feedback row" style="margin-top: 40px;">
                          <div class="col-md-5">
                            <div class="row">
                              <div class="col-xs-9">
                                <input type="text" class="form-control"
                                       placeholder="Library name ..."
                                       required ng-model="condaLib"/>
                              </div>
                              <div class="col-xs-3">
                                <input name="condaVersionInput" type="text" class="form-control has-error"
                                       placeholder="version"
                                       ng-pattern="/^[a-zA-Z0-9\.\-\_]{1,50}$/"
                                       required ng-model="condaVersion"/>
                                <div class="invalid-feedback">
                                  <span ng-show="condaNestedForm.condaVersionInput.$dirty && condaNestedForm.condaVersionInput.$error.pattern"
                                        class="text-danger ng-hide">Wrong version pattern.</span>
                                </div>
                              </div>
                            </div>
                          </div>
                          <div class="col-md-5">
                            <div class="btn-group row">
                              <button type="submit" class="btn btn-primary" value="Submit">
                                <i ng-if="pythonCtrl.installing[condaLib]" style="margin-top: 2px"
                                   class="fa fa-spinner fa-spin pull-right"></i>
                                Install <i class="fa fa-download"></i>
                              </button>
                            </div>
                          </div>
                        </div>
                      </form>
                    </div>
                  </fieldset>
                  <fieldset>
                    <div class="control-group">
                      <div class="row"></div>
                      <form name="nestedForm">
                        <div class="form-group row" style="margin-top: 40px;">
                          <div class="col-md-5">
                            <input type="text" class="form-control" 
                                   placeholder="Search here ...."
                                   required ng-model="pythonCtrl.condaSelectedLib.lib"/>
                          </div>
                          <div class="col-md-5">
                            <div class="btn-group row">
                              <button class="btn btn-primary button-sm" type="submit" ng-click="pythonCtrl.search('CONDA')"
                                      ng-disabled="pythonCtrl.condaSearching">
                                <i ng-if="pythonCtrl.condaSearching" style="margin-top: 2px" class="fa fa-spinner fa-spin pull-right" ></i>
                                Search <i class="fa fa-search"></i>

                              </button>
                            </div>
                          </div>
                        </div>
                      </form>
                    </div>
                  </fieldset>

                  <div class="col-md-offset-1" ng-show="pythonCtrl.condaResultsMessageShowing">{{pythonCtrl.condaResultsMsg}}</div>

                </div>
                <div ng-show="pythonCtrl.condaSearchResults.length > 0">
                  <div class="col-md-offset-1" ng-show="!((pythonCtrl.environmentTypes['CPU'] && !pythonCtrl.environmentTypes['GPU']) || (!pythonCtrl.environmentTypes['CPU'] && pythonCtrl.environmentTypes['GPU']))">
                    <h2>Installation mode<i class="fa fa-info-circle" uib-tooltip="Install library in Anaconda environment on hosts with specific capability."
                        style="margin-left: 10px"></i></h2>

                    <div class="row">

                      <div class="col-md-1" style="padding-left:15px; margin-top:8px;">All machines
                      </div>
                      <div class="col-md-1">
                        <div class="checkbox c-checkbox">
                          <label style="margin-left: 10px; margin-top: -5px;">
                            <input name="Batching" ng-disabled="pythonCtrl.machineTypeVal === 'ALL'" ng-checked="pythonCtrl.machineTypeALL"
                              ng-click="pythonCtrl.select('ALL')" type="checkbox">
                            <span class="fa fa-check"></span>
                          </label>
                        </div>
                      </div>

                      <div class="col-md-1" style="padding-left:15px; margin-top:8px;">
                        CPU machines
                      </div>

                      <div class="col-md-1">
                        <div class="checkbox c-checkbox">
                          <label style="margin-left: 10px; margin-top: -5px;">
                            <input name="Batching" ng-checked="pythonCtrl.machineTypeCPU" ng-click="pythonCtrl.select('CPU')"
                              type="checkbox">
                            <span class="fa fa-check"></span>
                          </label>
                        </div>
                      </div>

                      <div class="col-md-1" style="padding-left:15px; margin-top:8px;">
                        GPU machines
                      </div>
                      <div class="col-md-1">
                        <div class="checkbox c-checkbox">
                          <label style="margin-left: 10px; margin-top: -5px;">
                            <input name="Batching" ng-checked="pythonCtrl.machineTypeGPU" ng-click="pythonCtrl.select('GPU')"
                              type="checkbox">
                            <span class="fa fa-check"></span>
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>
		  
                  <table ng-show="pythonCtrl.enabled" st-table="rowCollection" class="table table-striped">
                    <thead>
                      <tr>
                        <th st-sort="depName" class="col-sm-4"></th>
                        <th class="col-sm-2"></th>
                        <th class="col-sm-2"></th>
                        <th class="col-sm-2"></th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr st-select-row="row" st-select-mode="single" ng-repeat="row in pythonCtrl.condaSearchResults"
                        ng-class="{'selectedTopicOdd': row.isSelected === true}">
                        <td class="col-sm-4">
                          <div class="row" style="margin-left: 10px;"><b>{{row.library}}</b></div>
                        </td>
                        <td class="col-sm-2">
                          <div class="row">

                            <div class="form-group">
                              <label class="col-sm-3 control-label"
                                     style="margin-top: 5px;">Version</label>
                              <div class="col-sm-8">
                                <ui-select ng-model="pythonCtrl.condaSelectedLibs[row.library].version" theme="select2"
                                  class="form-control" title="Choose a version">
                                  <ui-select-match placeholder="Select a version from the list...">{{pythonCtrl.condaSelectedLibs[row.library].version}}</ui-select-match>
                                  <ui-select-choices
                                          repeat="v.version as v in row.versions | filter: $select.search">
                                    <div ng-bind-html="v.version | highlight: $select.search"></div>
                                  </ui-select-choices>
                                </ui-select>
                              </div>

                            </div>
                          </div>
                        </td>
                        <td class="col-sm-2">
                          <div class="row" style="margin-left: 10px;"><b>{{row.status}}</b></div>
                        </td>
                        <td class="col-sm-2">
                          <button type="submit" class="btn btn-primary" ng-disabled="row.status === 'Installed'"
                                  ng-click="pythonCtrl.install(row.library, 'conda', pythonCtrl.machineTypeVal, pythonCtrl.condaSelectedLibs[row.library].version); active = 4">
                            <i ng-if="pythonCtrl.installing[row.library]" style="margin-top: 2px" class="fa fa-spinner fa-spin pull-right"></i>
                            Install</button>
                        </td>
                      </tr>
                  </table>
                </div>

              </uib-tab>
              <uib-tab index="1" heading="Pip Libraries">

                <div ng-show="!pythonCtrl.enabled">

                  <div class="jumbotron" style="margin-top: 30px;">
                    <div class="col-md-offset-1">
                      <h1 class="display-3">Anaconda</h1>
                      <p class="lead">Jupyter requires an Anaconda installation. Select one of the two options below.</p>
                      <br />
                      <p class="lead"><b> Option 1 (Recommended for new users): </b> Create a default environment with
                        pre-installed libraries.</p>
                      <p>You can change the version of Python at a later stage by recreating the Anaconda environment.</p>
                      <p class="lead">
                      <div>
                        <div class="btn-group" uib-dropdown style="z-index: 0;">
                          <button ng-disabled="pythonCtrl.enabling" id="single-button" type="button"
                                  class="btn btn-success btn-lg"
                                  uib-dropdown-toggle >
                            Select version &nbsp;<span class="caret"></span>
                          </button>
                          <ul class="dropdown-menu" uib-dropdown-menu role="menu" aria-labelledby="single-button">
                            <li role="menuitem"><a ng-click="pythonCtrl.enable('2.7')">Python 2.7</a></li>
                            <li class="divider"></li>
                            <li role="menuitem"><a ng-click="pythonCtrl.enable('3.6')">Python 3.6</a></li>
                          </ul>
                        </div>
                      </div>
                      </p>
                      <br />
                      <p><b> Option 2: </b> Create environment from Anaconda .yml file.</p>

                      <button ng-disabled="pythonCtrl.enabling" class="btn btn-success btn-lg" type="button"
                              ng-click="pythonCtrl.selectYmlFile()">
                        Select .yml
                      </button>
                    </div>
                  </div>

                </div>
                <div class="col-md-offset-1" ng-show="pythonCtrl.enabled">
                  <h2>Install Python libraries using pip in Anaconda environment </h2>
                  <span ng-show="pythonCtrl.pythonVersion != '0.0'">Python Version is
                    {{pythonCtrl.pythonVersion}}</span>


                  <div class="row">
                    <div class="col-md-5 progress" ng-if="pythonCtrl.enabling">
                      <div class="progress-bar progress-bar-success progress-bar-striped active" role="progressbar"
                           aria-valuenow="{{pythonCtrl.progress()}}" aria-valuemin="0" aria-valuemax="100" style="width:100%">
                        Creating new Anaconda environment...
                      </div>
                    </div>
                    <div class="col-md-5 progress" ng-if="pythonCtrl.removing">
                      <div class="progress-bar progress-bar-success progress-bar-striped active" role="progressbar"
                           aria-valuenow="{{pythonCtrl.progress()}}" aria-valuemin="0" aria-valuemax="100" style="width:100%">
                        Removing old Anaconda environment...
                      </div>
                    </div>
                  </div>
                  <fieldset>
                    <div class="control-group">
                      <div class="row"></div>
                      <form name="pipNnestedForm"
                            ng-submit="pythonCtrl.install(pipLib, 'pip', pythonCtrl.machineTypeVal, pipVersion)">
                        <div class="form-group has-feedback row" style="margin-top: 40px;">
                          <div class="col-md-5">
                            <div class="row">
                              <div class="col-xs-9">
                                <input type="text" class="form-control"
                                       placeholder="Library name ..."
                                       required ng-model="pipLib"/>
                              </div>
                              <div class="col-xs-3">
                                <input name="pipVersionInput" type="text" class="form-control"
                                       placeholder="version"
                                       ng-pattern="/^[a-zA-Z0-9\.\-\_]{1,50}$/"
                                       required ng-model="pipVersion"/>
                                <div class="invalid-feedback">
                                  <span ng-show="pipNnestedForm.pipVersionInput.$dirty && pipNnestedForm.pipVersionInput.$error.pattern"
                                        class="text-danger ng-hide">Wrong version pattern.</span>
                                </div>
                              </div>
                            </div>
                          </div>
                          <div class="col-md-5">
                            <div class="btn-group row">
                              <button type="submit" class="btn btn-primary" value="Submit">
                                <i ng-if="pythonCtrl.installing[pipLib]" style="margin-top: 2px"
                                   class="fa fa-spinner fa-spin pull-right"></i>
                                Install <i class="fa fa-download"></i>
                              </button>
                            </div>
                          </div>
                        </div>
                      </form>
                    </div>
                  </fieldset>
                  <fieldset>
                    <div class="control-group">
                      <div class="row"></div>
                      <form name="nestedForm">
                        <div class="form-group row" style="margin-top: 40px;">
                          <div class="col-md-5">
                            <input type="text" class="form-control" placeholder="Search here ...." required ng-model="pythonCtrl.pipSelectedLib.lib" />
                          </div>
                          <div class="col-md-5">
                            <div class="btn-group row">
                              <button class="btn btn-primary button-sm" type="submit" ng-click="pythonCtrl.search('PIP')"
                                ng-disabled="pythonCtrl.pipSearching">
                                <i ng-if="pythonCtrl.pipSearching" style="margin-top: 2px" class="fa fa-spinner fa-spin pull-right"></i>
                                Search <i class="fa fa-search"></i>
                              </button>
                            </div>
                          </div>
                        </div>
                      </form>
                    </div>
                  </fieldset>

                  <div class="col-md-offset-1" ng-show="pythonCtrl.pipResultsMessageShowing">{{pythonCtrl.pipResultsMsg}}</div>

                </div>

                <div ng-show="pythonCtrl.pipSearchResults.length > 0">
                  <div class="col-md-offset-1" ng-show="!((pythonCtrl.environmentTypes['CPU'] && !pythonCtrl.environmentTypes['GPU']) || (!pythonCtrl.environmentTypes['CPU'] && pythonCtrl.environmentTypes['GPU']))">
                    <h2>Installation mode<i class="fa fa-info-circle" uib-tooltip="Install library in Anaconda environment on hosts with specific capability."
                        style="margin-left: 10px"></i></h2>
                    <div class="row">

                      <div class="col-md-1" style="padding-left:15px; margin-top:8px;">All machines
                      </div>
                      <div class="col-md-1">
                        <div class="checkbox c-checkbox">
                          <label style="margin-left: 10px; margin-top: -5px;">
                            <input name="Batching" ng-disabled="pythonCtrl.machineTypeVal === 'ALL'" ng-checked="pythonCtrl.machineTypeALL"
                              ng-click="pythonCtrl.select('ALL')" type="checkbox">
                            <span class="fa fa-check"></span>
                          </label>
                        </div>
                      </div>

                      <div class="col-md-1" style="padding-left:15px; margin-top:8px;">
                        CPU machines
                      </div>
                      <div class="col-md-1">
                        <div class="checkbox c-checkbox">
                          <label style="margin-left: 10px; margin-top: -5px;">
                            <input name="Batching" ng-checked="pythonCtrl.machineTypeCPU" ng-click="pythonCtrl.select('CPU')"
                              type="checkbox">
                            <span class="fa fa-check"></span>
                          </label>
                        </div>
                      </div>
                      <div class="col-md-1" style="padding-left:15px; margin-top:8px;">
                        GPU machines
                      </div>
                      <div class="col-md-1">
                        <div class="checkbox c-checkbox">
                          <label style="margin-left: 10px; margin-top: -5px;">
                            <input name="Batching" ng-checked="pythonCtrl.machineTypeGPU" ng-click="pythonCtrl.select('GPU')"
                              type="checkbox">
                            <span class="fa fa-check"></span>
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>
                  <table ng-show="pythonCtrl.enabled" st-table="rowCollection" class="table table-striped">
                    <thead>
                      <tr>
                        <th st-sort="depName" class="col-sm-4"></th>
                        <th class="col-sm-2"></th>
                        <th class="col-sm-2"></th>
                        <th class="col-sm-2"></th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr st-select-row="row" st-select-mode="single" ng-repeat="row in pythonCtrl.pipSearchResults"
                        ng-class="{'selectedTopicOdd': row.isSelected === true}">
                        <td class="col-sm-4">
                          <div class="row" style="margin-left: 10px;"><b>{{row.library}}</b></div>
                        </td>
                        <td class="col-sm-2">
                          <div class="row">

                            <div class="form-group" ng-if="row.versions[0].version !== ''">
                              <label class="col-sm-3 control-label" style="margin-top: 5px;">Version</label>
                              <div class="col-sm-8">
                                <ui-select ng-model="pythonCtrl.pipSelectedLibs[row.library].version" theme="select2"
                                  class="form-control" title="Choose a version">
                                  <ui-select-match placeholder="Select a version from the list...">{{pythonCtrl.pipSelectedLibs[row.library].version}}</ui-select-match>
                                  <ui-select-choices
                                          repeat="v.version as v in row.versions | filter: $select.search">
                                    <div ng-bind-html="v.version | highlight: $select.search"></div>
                                  </ui-select-choices>
                                </ui-select>
                              </div>
                            </div>
                            <div ng-if="row.versions[0].version === ''" class="col-sm-10">
                              <input ng-disabled="row.status === 'Installed'"
                                     ng-model="pythonCtrl.pipSelectedLibs[row.library].version"
                                     type="text" class="form-control" style="height: 32px;"
                                     placeholder="Enter version to install">
                            </div>
                          </div>
                        </td>
                        <td class="col-sm-2">
                          <div class="row" style="margin-left: 10px;"><b>{{row.status}}</b></div>
                        </td>
                        <td class="col-sm-2">
                          <button type="submit" class="btn btn-primary"
                                  ng-disabled="row.status === 'Installed' || pythonCtrl.pipSelectedLibs[row.library].version.length === 0 "
                                  ng-click="pythonCtrl.install(row.library, 'pip', pythonCtrl.machineTypeVal, pythonCtrl.pipSelectedLibs[row.library].version); active = 4">
                            <i ng-if="pythonCtrl.installing[row.library]" style="margin-top: 2px" class="fa fa-spinner fa-spin pull-right"></i>
                            Install</button>
                        </td>
                      </tr>
                  </table>
                </div>

              </uib-tab>
              <uib-tab index="2" heading="Installed Python Libraries" ng-show="pythonCtrl.enabled && pythonCtrl.installed"
                ng-click="pythonCtrl.getInstalled()">
                <div>
                  <h2 style="margin-bottom: 30px;">Installed Python Libraries
                    <div style="float:right">
                      <button tooltip-placement="auto top" style="float:left; margin-right: 10px;"
                              uib-tooltip="Export the Anaconda environment of the project as a .yml file."
                              class="btn btn-success" style="float:right" type="button" ng-click="pythonCtrl.exportEnvironment()">
                        <span class="fa fa-spinner fa-spin" aria-hidden="true" ng-show="pythonCtrl.exporting"></span>
                        Export Environment
                      </button>
                      <button tooltip-placement="auto top" style="float:right;"
                              uib-tooltip="The Anaconda environment of the project will be deleted. A new environment can be created after deletion."
                              ng-click="pythonCtrl.destroyAnaconda()"
                              type="button" class="btn btn-danger" >
                        Remove Environment
                      </button>
                    </div>
                  </h2>
                </div>
                <!--                <div class="row pull-left">
                                  <div class="dialog-demo-content" layout="row" layout-wrap layout-margin layout-align="center">
                                    <md-button class="md-primary md-hue-1" ng-click="pythonCtrl.showAlert($event)"   >
                                      Show Base Libraries
                                    </md-button>
                                  </div>
                                </div>-->
                <table class="table table-striped" ng-show="pythonCtrl.installedLibs.length > 0">
                  <thead>
                    <tr>
                      <th class="col-sm-2">
                        <a ng-click="sortBy('channel')">
                          Channel
                          <span ng-show="sortType === 'channel'"
                                ng-class="{'fa fa-caret-down': reverse, 'fa fa-caret-up': !reverse}"></span></a>
                      </th>
                      <th class="col-sm-2">
                        <a ng-click="sortBy('library')">
                          Library
                          <span ng-show="sortType === 'library'"
                                ng-class="{'fa fa-caret-down': reverse, 'fa fa-caret-up': !reverse}"></span></a>
                      </th>
                      <th class="col-sm-2">
                        <a ng-click="sortBy('version')">
                          Version
                          <span ng-show="sortType === 'version'"
                                ng-class="{'fa fa-caret-down': reverse, 'fa fa-caret-up': !reverse}"></span></a>
                      </th>
                      <th class="col-sm-2">
                        <a ng-click="sortBy('packageManager')">
                          Package Manager
                          <span ng-show="sortType === 'packageManager'"
                                ng-class="{'fa fa-caret-down': reverse, 'fa fa-caret-up': !reverse}">
                        </span></a>
                      </th>
                      <th class="col-sm-1">
                        <a ng-click="sortBy('machine')">
                          MachineType
                          <span ng-show="sortType === 'machine'"
                                ng-class="{'fa fa-caret-down': reverse, 'fa fa-caret-up': !reverse}"></span>
                        </a>
                      </th>
                      <th class="col-sm-1">
                        <a ng-click="sortBy('status')">
                          Status
                          <span ng-show="sortType === 'status'"
                                ng-class="{'fa fa-caret-down': reverse, 'fa fa-caret-up': !reverse}"></span>
                        </a>
                      </th>
                      <th class="col-sm-2 text-center">
                        <a ng-click="sortBy('preinstalled')">
                          User-Installed
                          <span ng-show="sortType === 'preinstalled'"
                                ng-class="{'fa fa-caret-down': reverse, 'fa fa-caret-up': !reverse}"></span>
                        </a>
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr ng-repeat="row in pythonCtrl.installedLibs | orderBy:sortType:reverse"
                        ng-class="{'selectedTopicOdd': row.isSelected === true}">
                      <td class="col-sm-2">
                        <div class="row" style="margin-left: 10px;"><b>{{row.channel}}</b></div>
                      </td>
                      <td class="col-sm-2">
                        <div class="row" style="margin-left: 10px;"><b>{{row.library}}</b></div>
                      </td>
                      <td class="col-sm-2">
                        <div class="row" style="margin-left: 10px;"><b>{{row.version}}</b></div>
                      </td>
                      <td class="col-sm-2">
                        <div class="row" style="margin-left: 10px;"><b>{{row.packageManager}}</b></div>
                      </td>
                      <td class="col-sm-1">
                        <div class="row" style="margin-left: 10px;"><b>{{row.machine}}</b></div>
                      </td>
                      <td class="col-sm-1">
                        <div ng-show="pythonCtrl.getStatus(row) === 'INSTALLED'">
                          <b>{{pythonCtrl.getStatus(row)}}</b></div>
                        <div ng-show="pythonCtrl.getStatus(row) === 'FAILED'"style="color: #880000 ">
                          <b>{{pythonCtrl.getStatus(row)}}</b></div>
                        <div ng-show="pythonCtrl.getStatus(row) === 'ONGOING'" class="text-muted">
                          <b>{{pythonCtrl.getStatus(row)}}</b>
                        </div>
                      </td>
                      <td class="col-sm-2 text-center">
                        <div class="row" ng-if="row.preinstalled === 'false'">
                          <div class="button-group">
                            <!-- DISABLE UPGRADE FOR NOW
                            <button type="submit" class="btn btn-success" ng-disabled="row.status !== 'SUCCESS' || row.preinstalled === 'true'"
                                    ng-click="pythonCtrl.upgrade(row.channelUrl, row.machineType, row.installType, row.lib, row.version)">
                              <i ng-if="pythonCtrl.upgrading[row.lib]" style="margin-top: 2px" class="col-sm-6 fa fa-spinner fa-spin pull-right" ></i>
                              Upgrade</button>
                            -->
                            <!--ng-disabled="row.status !== 'SUCCESS' || row.preinstalled === 'true'"-->
                            <button type="submit" class="btn btn-danger col-sm-offset-1"
                                    ng-click="pythonCtrl.uninstall(row)"
                                    ng-disabled="pythonCtrl.getStatus(row) === 'ONGOING' || pythonCtrl.uninstalling[row.library]">
                              <i ng-if="pythonCtrl.uninstalling[row.library]" style="margin-top: 2px" class="col-sm-6 fa fa-spinner fa-spin pull-right"></i>
                              Uninstall</button>
                          </div>
                        </div>
                        <div class="row" ng-if="row.preinstalled === 'true'">
                          <div class="col-sm-offset-1">Pre-installed</div>
                        </div>
                      </td>
                    </tr>
                </table>
              </uib-tab>
              <uib-tab index="3" heading="Ongoing Operations" ng-show="pythonCtrl.enabled && pythonCtrl.installed"
                ng-click="pythonCtrl.getInstalled()">
                <h2>Ongoing Anaconda operations</h2>


                <div ng-if="pythonCtrl.showLogs === false">
                  <div ng-if="pythonCtrl.opsStatus.length === 0">There are no ongoing operations.</div>

                  <table st-table="rowCollection" class="table table-striped" ng-if="pythonCtrl.opsStatus.length > 0">
                    <thead>
                      <tr>
                        <th st-sort="depName" class="col-sm-2">Operation</th>
                        <th class="col-sm-2"></th>
                        <th class="col-sm-2"></th>
                        <th class="col-sm-2"></th>
                        <th class="col-sm-4">Progress</th>
                        <th class="col-sm-2"></th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr st-select-row="row" st-select-mode="single" ng-repeat="row in pythonCtrl.opsStatus"
                        ng-class="{'selectedTopicOdd': row.isSelected === true}">
                        <td class="col-sm-2">
                          <div class="row" style="margin-left: 10px;"><b>{{row.commands.items[0].op}}</b></div>
                        </td>
                        <td class="col-sm-2">
                          <div ng-if="row.type === 'environmentDTO'">Environment</div>
                          <div ng-if="row.type === 'libraryDTO'">
                            <span ng-if="row.library !== '0.0'">{{row.library}}</span>
                            <span ng-if="row.library === '0.0'">Creating environment from .yml file</span>
                          </div>
                        </td>
                        <td class="col-sm-2">
                          {{pythonCtrl.getVersion(row)}}
                        </td>
                        <td class="col-sm-2">
                          <span ng-if="pythonCtrl.getStatus(row) === 'FAILED'" style="color: #880000 ">{{pythonCtrl.getStatus(row)}}</span>
                          <span ng-if="pythonCtrl.getStatus(row) !== 'FAILED'">{{pythonCtrl.getStatus(row)}}</span>
                        </td>
                        <td class="col-sm-4">
                          <div id="python-install-progress" class="progress" style="margin-top: 5px">
                            <div class="progress-bar progress-bar-striped progress-bar-success" role="progressbar"
                                 ng-style="{width:pythonCtrl.installProgress('Done', row) + '%'}">
                              <span ng-if="pythonCtrl.installProgress('Done', row) > 15">Done
                                {{pythonCtrl.getCountForStatus('SUCCESS', row) +'/'+ pythonCtrl.getMachineCount(row)}}</span>
                            </div>
                            <div class="progress-bar progress-bar-striped progress-bar-warning" role="progressbar"
                                 ng-style="{width:pythonCtrl.installProgress('Ongoing', row) + '%'}">
                              <span ng-if="pythonCtrl.installProgress('Ongoing', row) > 15">Ongoing
                                {{pythonCtrl.getCountForStatus('ONGOING', row) +
                                pythonCtrl.getCountForStatus('NEW', row) +'/'+ pythonCtrl.getMachineCount(row)}}</span>
                            </div>
                            <div class="progress-bar progress-bar-striped progress-bar-danger" role="progressbar"
                                 ng-style="{width:pythonCtrl.installProgress('Failed', row) + '%'}">
                              <span ng-if="pythonCtrl.installProgress('Failed', row) > 15">Failed
                                {{pythonCtrl.getCountForStatus('FAILED', row) +'/'+ pythonCtrl.getMachineCount(row)}}</span>
                            </div>
                          </div>
                        </td>
                        <td class="col-md-2">
                          <div class="btn-group">
                            <button ng-if="pythonCtrl.getStatus(row) === 'ONGOING'" type="submit" class="btn btn-info"
                                    tooltip-placement="auto left"
                                    uib-tooltip="Show hosts this command has succeeded so far "
                                    ng-click="pythonCtrl.showCommandsLogs(row, true)">
                              <i class="fa fa-bars"></i>
                            </button>
                            <button ng-if="pythonCtrl.getStatus(row) === 'FAILED'" type="submit" class="btn btn-info"
                                    tooltip-placement="auto left"
                                    uib-tooltip="Show the hosts that this conda command failed on "
                                    ng-click="pythonCtrl.showCommandsLogs(row, false)">
                              <i class="fa fa-bars"></i>
                            </button>
                            <button ng-show="pythonCtrl.getStatus(row) === 'FAILED' && pythonCtrl.getOp(row) !== 'YML'" type="submit"
                                    class="btn btn-md btn-danger"
                                    tooltip-placement="auto left"
                                    uib-tooltip="Remove the conda command to clean up this environment"
                                    ng-click="pythonCtrl.uninstall(row)">
                              <i ng-show="pythonCtrl.uninstalling[row.library]" style="margin-top: 2px"
                                 class="fa fa-spinner fa-spin pull-right"></i>
                              <i class="fa fa-trash"></i>
                            </button>
                            <button ng-show="pythonCtrl.getStatus(row) === 'FAILED' && pythonCtrl.getOp(row) === 'YML'" type="submit"
                                    class="btn btn-md btn-danger"
                                    tooltip-placement="auto left"
                                    uib-tooltip="Remove the conda command to clean up this environment"
                                    ng-click="pythonCtrl.deleteEnvironment()">
                              <i class="fa fa-trash"></i>
                            </button>
                            <button ng-show="pythonCtrl.getStatus(row) === 'FAILED' && pythonCtrl.getOp(row) !== 'YML'" type="submit"
                                    class="btn btn-md btn-warning"
                                    tooltip-placement="auto left"
                                    uib-tooltip="Retry the conda command"
                                    ng-click="pythonCtrl.retryFailedCondaOp(row)">
                              <i class="fa fa-repeat"></i>
                            </button>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
                <div class="" ng-if="pythonCtrl.showLogs === true">
                  <button ng-click="pythonCtrl.showMainUI(); $event.stopPropagation();" class="btn btn-primary btn-md fa fa-table"
                    style="font-size:0.9em; padding:7px 10px; margin-bottom: 3px; background-color:#005571;"
                    onmouseover="this.style.backgroundColor='#004159'" onmouseout="this.style.backgroundColor='#005571'"> Conda
                    commands summary</button>
                  <iframe style="overflow-y: auto;" id="ui_iframe" ng-src="{{pythonCtrl.kibanaUI}}" width="99%"
                    height="80%"></iframe>
                </div>
              </uib-tab>

              <div class="pull-right">
                <a href="http://hops-py.logicalclocks.com/">See hops python docs</a>
                <img style="margin-right:5px" width="35" src="images/python_logo_colored.png" />
              </div>
            </uib-tabset>
          </div>
        </div>
      </section>

    </div>
  </div>
</div>