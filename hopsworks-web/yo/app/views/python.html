<!--
  ~ Changes to this file committed after and not including commit-id: ccc0d2c5f9a5ac661e60e6eaf138de7889928b8b
  ~ are released under the following license:
  ~
  ~ This file is part of Hopsworks
  ~ Copyright (C) 2018, Logical Clocks AB. All rights reserved
  ~
  ~ Hopsworks is free software: you can redistribute it and/or modify it under the terms of
  ~ the GNU Affero General Public License as published by the Free Software Foundation,
  ~ either version 3 of the License, or (at your option) any later version.
  ~
  ~ Hopsworks is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
  ~ without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
  ~ PURPOSE.  See the GNU Affero General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License along with this program.
  ~ If not, see <https://www.gnu.org/licenses/>.
  ~
  ~ Changes to this file committed before and including commit-id: ccc0d2c5f9a5ac661e60e6eaf138de7889928b8b
  ~ are released under the following license:
  ~
  ~ Copyright (C) 2013 - 2018, Logical Clocks AB and RISE SICS AB. All rights reserved
  ~
  ~ Permission is hereby granted, free of charge, to any person obtaining a copy of this
  ~ software and associated documentation files (the "Software"), to deal in the Software
  ~ without restriction, including without limitation the rights to use, copy, modify, merge,
  ~ publish, distribute, sublicense, and/or sell copies of the Software, and to permit
  ~ persons to whom the Software is furnished to do so, subject to the following conditions:
  ~
  ~ The above copyright notice and this permission notice shall be included in all copies or
  ~ substantial portions of the Software.
  ~
  ~ THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS  OR IMPLIED, INCLUDING
  ~ BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  ~ NONINFRINGEMENT. IN NO EVENT SHALL  THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
  ~ DAMAGES OR  OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
  ~ OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
  -->

<div ng-controller="MainCtrl as mainCtrl">
  <div ng-include="'nav.html'"></div>


  <div id="wrapper" ng-class="{'toggled': projectCtrl.isClosed}" ng-controller="ProjectCtrl as projectCtrl">
    <div class="overlay"></div>

    <div ng-include="'navProject.html'"></div>
    <div ng-if="mainCtrl.showSearchPage" class="content-wrapper">
      <div id="projectSearchResults">
        <div ng-include="'views/search/search.html'"></div>
      </div>
    </div>
    <div ng-if="!mainCtrl.showSearchPage"class="job-content-wrapper">
      <h3 id="projectBread"> {{ projectCtrl.currentProject.projectName}} / Jobs</h3>
    </div>
    <div ng-if="!mainCtrl.showSearchPage" class="" ng-controller="PythonCtrl as pythonCtrl">

      <section>
        <div class="content-wrapper">
          <div ng-if="pythonCtrl.loading" class="loadingwrap" style="z-index: 1000;">
            <div class="loading-content">
              <div class="loader-in-wrap"></div>
              {{pythonCtrl.loadingText}}
            </div>
          </div>
          <h3 id="projectSetings" style="display: none;"> {{ projectCtrl.currentProject.projectName}} Settings</h3>
          <div>

            <div ng-show="!pythonCtrl.enabled">

              <div class="jumbotron" style="margin-top: 30px;">
                <div class="col-md-offset-1">
                  <h1 class="display-3">Anaconda</h1>
                  <p class="lead">Using Jupyter requires that Anaconda is enabled for the project. Select one of the three options below.</p>
                  <br />
                  <p class="lead"><b> Option 1 (Recommended for new users): </b> Create a default environment with
                    pre-installed libraries and python 3.7.</p>
                  <p>You can remove and recreate the Anaconda environment at a later stage.</p>
                  <p class="lead">
                  <div>
                    <div class="btn-group" uib-dropdown style="z-index: 0;">
                      <button ng-disabled="pythonCtrl.enabling" class="btn btn-success btn-lg" type="button"
                              ng-click="pythonCtrl.enable('3.7')">
                        Enable Environment
                      </button>
                    </div>
                  </div>
                  </p>
                  <br />
                  <p><b> Option 2: </b> Create environment from Anaconda .yml file.</p>

                  <button ng-disabled="pythonCtrl.enabling" class="btn btn-success btn-lg" type="button"
                          ng-click="pythonCtrl.selectImportFile('yaml')">
                    Browse
                  </button>
                  <br />
                  <p style="margin-top:25px;"><b> Option 3: </b> Create environment from pip requirements.txt file.</p>

                  <button ng-disabled="pythonCtrl.enabling" class="btn btn-success btn-lg" type="button"
                          ng-click="pythonCtrl.selectImportFile('requirements.txt')">
                    Browse
                  </button>
                </div>
              </div>

            </div>

            <div ng-show="pythonCtrl.enabled">

              <div class="alert alert-warning" style="padding: 10px;" ng-show="projectCtrl.currentProject.isOldDockerImage">
                  <span style="font-size: 1.1em !important; margin-left:100px;">
                    <i class="fa fa-warning" uib-tooltip="The docker image currently in use by this project is for an older version of Hopsworks. This means that python environment may be outdated and applications may stop working." style="color:orange;">
                    </i> This project is using an old project environment which may not be compatible with the current installation, to upgrade please remove and recreate the environment.
                  </span>
              </div>

            <uib-tabset active="indextab">
              <div class="pull-right">
                <a href="http://hops-py.logicalclocks.com/" target="_blank">See hops python docs</a>
                <img style="margin-right:5px" width="35" src="images/python_logo_colored.png" />
              </div>

              <uib-tab index="0" heading="Install">

                <div class="col-md-offset-1">
                <h4>Select package location</h4>
                <div id="selectPackageLocation" class="btn-group" role="group" aria-label="...">
                  <button type="button" class="btn"
                          ng-click="pythonCtrl.installMode = 'PYPI';"
                          ng-class="{'btn-default': pythonCtrl.installMode !== 'PYPI', 'btn-primary': pythonCtrl.installMode === 'PYPI'}"
                  >PyPi</button>
                  <button type="button" class="btn"
                          ng-click="pythonCtrl.installMode = 'CONDA';"
                          ng-class="{'btn-default': pythonCtrl.installMode !== 'CONDA', 'btn-primary': pythonCtrl.installMode === 'CONDA'}"
                  >Conda</button>
                  <button type="button" class="btn"
                          ng-click="pythonCtrl.installMode = 'UPLOAD';"
                          ng-class="{'btn-default': pythonCtrl.installMode !== 'UPLOAD', 'btn-primary': pythonCtrl.installMode === 'UPLOAD'}"
                  >Upload</button>
                  <button type="button" class="btn"
                          ng-click="pythonCtrl.installMode = 'GIT';"
                          ng-class="{'btn-default': pythonCtrl.installMode !== 'GIT', 'btn-primary': pythonCtrl.installMode === 'GIT'}"
                  >Git</button>
                </div>
                </div>
                <div ng-show="pythonCtrl.installMode === 'PYPI'">
                  <div class="col-md-offset-1" ng-show="pythonCtrl.enabled">
                    <h2>Install Python libraries using pip in Anaconda environment </h2>
                    <span ng-show="pythonCtrl.pythonVersion != '0.0'">Python Version is
                    {{pythonCtrl.pythonVersion}}</span>


                    <div class="row">
                      <div class="col-md-5 progress" ng-if="pythonCtrl.enabling">
                        <div class="progress-bar progress-bar-success progress-bar-striped active" role="progressbar"
                             aria-valuenow="{{pythonCtrl.progress()}}" aria-valuemin="0" aria-valuemax="100" style="width:100%">
                          Creating new Anaconda environment...
                        </div>
                      </div>
                      <div class="col-md-5 progress" ng-if="pythonCtrl.removing">
                        <div class="progress-bar progress-bar-success progress-bar-striped active" role="progressbar"
                             aria-valuenow="{{pythonCtrl.progress()}}" aria-valuemin="0" aria-valuemax="100" style="width:100%">
                          Removing old Anaconda environment...
                        </div>
                      </div>
                    </div>
                    <fieldset>
                      <div class="control-group">
                        <div class="row"></div>
                        <form name="pipNnestedForm"
                              ng-submit="pythonCtrl.install(pipLib, 'PIP', pipVersion)">
                          <div class="form-group has-feedback row" style="margin-top: 40px;">
                            <div class="col-md-5">
                              <div class="row">
                                <div class="col-xs-9">
                                  <input type="text" class="form-control"
                                         placeholder="Library name ..."
                                         required ng-model="pipLib"/>
                                </div>
                                <div class="col-xs-3">
                                  <input name="pipVersionInput" type="text" class="form-control"
                                         placeholder="version"
                                         ng-pattern="/^[a-zA-Z0-9\.\-\_]{1,50}$/"
                                         required ng-model="pipVersion"/>
                                  <div class="invalid-feedback">
                                  <span ng-show="pipNnestedForm.pipVersionInput.$dirty && pipNnestedForm.pipVersionInput.$error.pattern"
                                        class="text-danger ng-hide">Wrong version pattern.</span>
                                  </div>
                                </div>
                              </div>
                            </div>
                            <div class="col-md-5">
                              <div class="btn-group row">
                                <button type="submit" class="btn btn-primary" value="Submit">
                                  <i ng-if="pythonCtrl.installing[pipLib]" style="margin-top: 2px"
                                     class="fa fa-spinner fa-spin pull-right"></i>
                                  Install <i class="fa fa-download"></i>
                                </button>
                              </div>
                            </div>
                          </div>
                        </form>
                      </div>
                    </fieldset>

                    <fieldset ng-show="pythonCtrl.pipSearchEnabled">
                      <div class="control-group">
                        <div class="row"></div>
                        <form name="nestedForm">
                          <div class="form-group row" style="margin-top: 40px;">
                            <div class="col-md-5">
                              <input type="text" class="form-control" placeholder="Search here ...." required ng-model="pythonCtrl.pipSelectedLib.library" />
                            </div>
                            <div class="col-md-5">
                              <div class="btn-group row">
                                <button class="btn btn-primary button-sm" type="submit" ng-click="pythonCtrl.search('PIP')"
                                        ng-disabled="pythonCtrl.pipSearching">
                                  <i ng-if="pythonCtrl.pipSearching" style="margin-top: 2px" class="fa fa-spinner fa-spin pull-right"></i>
                                  Search <i class="fa fa-search"></i>
                                </button>
                              </div>
                            </div>
                          </div>
                        </form>
                      </div>
                    </fieldset>
                    <div class="col-md-offset-1" ng-show="pythonCtrl.pipResultsMessageShowing">{{pythonCtrl.pipResultsMsg}}</div>

                  </div>

                  <div ng-show="pythonCtrl.pipSearchResults.length > 0">
                    <table ng-show="pythonCtrl.enabled" st-table="rowCollection" class="table table-striped">
                      <thead>
                      <tr>
                        <th st-sort="depName" class="col-sm-4"></th>
                        <th class="col-sm-2"></th>
                        <th class="col-sm-2"></th>
                        <th class="col-sm-2"></th>
                      </tr>
                      </thead>
                      <tbody>
                      <tr st-select-row="row" st-select-mode="single" ng-repeat="row in pythonCtrl.pipSearchResults"
                          ng-class="{'selectedTopicOdd': row.isSelected === true}">
                        <td class="col-sm-4">
                          <div class="row" style="margin-left: 10px;"><b>{{row.library}}</b></div>
                        </td>
                        <td class="col-sm-2">
                          <div class="row">

                            <div class="form-group" ng-if="row.versions[0].version !== ''">
                              <label class="col-sm-3 control-label" style="margin-top: 5px;">Version</label>
                              <div class="col-sm-8">
                                <ui-select ng-model="pythonCtrl.pipSelectedLibs[row.library].version" theme="select2"
                                           class="form-control" title="Choose a version">
                                  <ui-select-match placeholder="Select a version from the list...">{{pythonCtrl.pipSelectedLibs[row.library].version}}</ui-select-match>
                                  <ui-select-choices
                                          repeat="v.version as v in row.versions | filter: $select.search">
                                    <div ng-bind-html="v.version | highlight: $select.search"></div>
                                  </ui-select-choices>
                                </ui-select>
                              </div>
                            </div>
                            <div ng-if="row.versions[0].version === ''" class="col-sm-10">
                              <input ng-disabled="row.status === 'Installed'"
                                     ng-model="pythonCtrl.pipSelectedLibs[row.library].version"
                                     type="text" class="form-control" style="height: 32px;"
                                     placeholder="Enter version to install">
                            </div>
                          </div>
                        </td>
                        <td class="col-sm-2">
                          <div class="row" style="margin-left: 10px;"><b>{{row.status}}</b></div>
                        </td>
                        <td class="col-sm-2">
                          <button type="submit" class="btn btn-primary"
                                  ng-disabled="row.status === 'Installed' || pythonCtrl.pipSelectedLibs[row.library].version.length === 0 "
                                  ng-click="pythonCtrl.install(row.library, 'PIP', pythonCtrl.pipSelectedLibs[row.library].version); active = 4">
                            <i ng-if="pythonCtrl.installing[row.library]" style="margin-top: 2px" class="fa fa-spinner fa-spin pull-right"></i>
                            Install</button>
                        </td>
                      </tr>
                    </table>
                  </div>
                </div>

                <div ng-show="pythonCtrl.installMode === 'CONDA'">
                  <div class="col-md-offset-1" ng-show="pythonCtrl.enabled">
                    <h2>Install Python libraries using conda in Anaconda environment </h2>

                    <span ng-show="pythonCtrl.pythonVersion != '0.0'">Python Version is
                      {{pythonCtrl.pythonVersion}}</span>

                    <div class="row">
                      <div class="col-md-5 progress" ng-if="pythonCtrl.enabling">
                        <div class="progress-bar progress-bar-success progress-bar-striped active" role="progressbar"
                             aria-valuenow="{{pythonCtrl.progress()}}" aria-valuemin="0" aria-valuemax="100" style="width:100%">
                          Creating new Anaconda environment...
                        </div>
                      </div>
                      <div class="col-md-5 progress" ng-if="pythonCtrl.removing">
                        <div class="progress-bar progress-bar-success progress-bar-striped active" role="progressbar"
                             aria-valuenow="{{pythonCtrl.progress()}}" aria-valuemin="0" aria-valuemax="100" style="width:100%">
                          Removing old Anaconda environment...
                        </div>
                      </div>
                    </div>
                    <div style="margin-top: 15px;">
                      <div>Conda Channel: <a uib-tooltip="You can search a different conda channel by entering a new channel name here." tooltip-placement="top"
                                             href="#" data-inputclass="xwdith" editable-text="pythonCtrl.condaChannel">{{ pythonCtrl.condaChannel || 'default' }}</a></div>
                    </div>
                    <fieldset>
                      <div class="control-group">
                        <div class="row"></div>
                        <form name="condaNestedForm"
                              ng-submit="pythonCtrl.install(condaLib, 'CONDA', condaVersion)">
                          <div class="form-group has-feedback row" style="margin-top: 40px;">
                            <div class="col-md-5">
                              <div class="row">
                                <div class="col-xs-9">
                                  <input type="text" class="form-control"
                                         placeholder="Library name ..."
                                         required ng-model="condaLib"/>
                                </div>
                                <div class="col-xs-3">
                                  <input name="condaVersionInput" type="text" class="form-control has-error"
                                         placeholder="version"
                                         ng-pattern="/^[a-zA-Z0-9\.\-\_]{1,50}$/"
                                         required ng-model="condaVersion"/>
                                  <div class="invalid-feedback">
                                  <span ng-show="condaNestedForm.condaVersionInput.$dirty && condaNestedForm.condaVersionInput.$error.pattern"
                                        class="text-danger ng-hide">Wrong version pattern.</span>
                                  </div>
                                </div>
                              </div>
                            </div>
                            <div class="col-md-5">
                              <div class="btn-group row">
                                <button type="submit" class="btn btn-primary" value="Submit">
                                  <i ng-if="pythonCtrl.installing[condaLib]" style="margin-top: 2px"
                                     class="fa fa-spinner fa-spin pull-right"></i>
                                  Install <i class="fa fa-download"></i>
                                </button>
                              </div>
                            </div>
                          </div>
                        </form>
                      </div>
                    </fieldset>
                    <fieldset>
                      <div class="control-group">
                        <div class="row"></div>
                        <form name="nestedForm">
                          <div class="form-group row" style="margin-top: 40px;">
                            <div class="col-md-5">
                              <input type="text" class="form-control"
                                     placeholder="Search here ...."
                                     required ng-model="pythonCtrl.condaSelectedLib.library"/>
                            </div>
                            <div class="col-md-5">
                              <div class="btn-group row">
                                <button class="btn btn-primary button-sm" type="submit" ng-click="pythonCtrl.search('CONDA')"
                                        ng-disabled="pythonCtrl.condaSearching">
                                  <i ng-if="pythonCtrl.condaSearching" style="margin-top: 2px" class="fa fa-spinner fa-spin pull-right" ></i>
                                  Search <i class="fa fa-search"></i>

                                </button>
                              </div>
                            </div>
                          </div>
                        </form>
                      </div>
                    </fieldset>

                    <div class="col-md-offset-1" ng-show="pythonCtrl.condaResultsMessageShowing">{{pythonCtrl.condaResultsMsg}}</div>

                  </div>
                  <div ng-show="pythonCtrl.condaSearchResults.length > 0">

                    <table ng-show="pythonCtrl.enabled" st-table="rowCollection" class="table table-striped">
                      <thead>
                      <tr>
                        <th st-sort="depName" class="col-sm-4"></th>
                        <th class="col-sm-2"></th>
                        <th class="col-sm-2"></th>
                        <th class="col-sm-2"></th>
                      </tr>
                      </thead>
                      <tbody>
                      <tr st-select-row="row" st-select-mode="single" ng-repeat="row in pythonCtrl.condaSearchResults"
                          ng-class="{'selectedTopicOdd': row.isSelected === true}">
                        <td class="col-sm-4">
                          <div class="row" style="margin-left: 10px;"><b>{{row.library}}</b></div>
                        </td>
                        <td class="col-sm-2">
                          <div class="row">

                            <div class="form-group">
                              <label class="col-sm-3 control-label"
                                     style="margin-top: 5px;">Version</label>
                              <div class="col-sm-8">
                                <ui-select ng-model="pythonCtrl.condaSelectedLibs[row.library].version" theme="select2"
                                           class="form-control" title="Choose a version">
                                  <ui-select-match placeholder="Select a version from the list...">{{pythonCtrl.condaSelectedLibs[row.library].version}}</ui-select-match>
                                  <ui-select-choices
                                          repeat="v.version as v in row.versions | filter: $select.search">
                                    <div ng-bind-html="v.version | highlight: $select.search"></div>
                                  </ui-select-choices>
                                </ui-select>
                              </div>

                            </div>
                          </div>
                        </td>
                        <td class="col-sm-2">
                          <div class="row" style="margin-left: 10px;"><b>{{row.status}}</b></div>
                        </td>
                        <td class="col-sm-2">
                          <button type="submit" class="btn btn-primary" ng-disabled="row.status === 'Installed'"
                                  ng-click="pythonCtrl.install(row.library, 'CONDA', pythonCtrl.condaSelectedLibs[row.library].version); active = 4">
                            <i ng-if="pythonCtrl.installing[row.library]" style="margin-top: 2px" class="fa fa-spinner fa-spin pull-right"></i>
                            Install</button>
                        </td>
                      </tr>
                    </table>
                  </div>
                </div>

                <div class="col-md-offset-1" ng-show="pythonCtrl.installMode === 'UPLOAD'">
                  <div class="control-group">
                    <h4>Select package file</h4>
                    <div id="selectUpload" class="btn-group" role="group" aria-label="...">
                      <button type="button" class="btn"
                              uib-tooltip="Check this option if you have a requirements.txt to install in the environment."
                              ng-click="pythonCtrl.uploadMode = 'REQUIREMENTS_TXT';"
                              ng-class="{'btn-default': pythonCtrl.uploadMode !== 'REQUIREMENTS_TXT', 'btn-primary': pythonCtrl.uploadMode === 'REQUIREMENTS_TXT'}"
                      >Requirements.txt</button>
                      <button type="button" class="btn"
                              uib-tooltip="Check this option if you have a conda environment file (.yml) to install in the environment"
                              ng-click="pythonCtrl.uploadMode = 'ENVIRONMENT_YAML';"
                              ng-class="{'btn-default': pythonCtrl.uploadMode !== 'ENVIRONMENT_YAML', 'btn-primary': pythonCtrl.uploadMode === 'ENVIRONMENT_YAML'}"
                      >Environment YAML</button>
                      <button type="button" class="btn"
                              uib-tooltip="Check this option if you have a wheel (.whl) to install in the environment"
                              ng-click="pythonCtrl.uploadMode = 'WHEEL';"
                              ng-class="{'btn-default': pythonCtrl.uploadMode !== 'WHEEL', 'btn-primary': pythonCtrl.uploadMode === 'WHEEL'}"
                      >Wheel</button>
                      <button type="button" class="btn"
                              uib-tooltip="Check this option if you have an egg to install in the environment"
                              ng-click="pythonCtrl.uploadMode = 'EGG';"
                              ng-class="{'btn-default': pythonCtrl.uploadMode !== 'EGG', 'btn-primary': pythonCtrl.uploadMode === 'EGG'}"
                      >Egg</button>
                    </div>

                    <label class="control-label" for="selectDep" style="margin-top:15px;" ng-show="pythonCtrl.uploadMode">
                      <button id="selectDep"
                              class="btn btn-default" ng-click="pythonCtrl.selectFile()" style="width:100px; box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 1px 3px 1px rgba(60,64,67,.15);">
                      <span><i class="fa fa-file" style="font-size:0.8em;"/> Browse</span>
                      </button>
                    </label>

                      <p style="font-size: 16px; margin-top:12px;" ng-show="pythonCtrl.uploadDepPath"><b>You selected</b>: {{pythonCtrl.uploadDepPath}}</p>

                    <div ng-show="pythonCtrl.uploadDepPath" style="margin-top:10px;">
                      <button type="submit" class="btn btn-primary"
                        ng-click="pythonCtrl.install(pythonCtrl.uploadDepPath, pythonCtrl.uploadMode, '')">
                        Install <i class="fa fa-download"></i>
                      </button>
                    </div>
                  </div>
                </div>

                <div class="col-md-offset-1" ng-show="pythonCtrl.installMode === 'GIT'">
                  <div class="control-group">
                    <div class="row"></div>
                      <h4 style="margin-top:20px;">Install from git repository</h4>
                      <div class="form-group row" style="margin-top:5px;">
                        <div class="col-sm-5">
                          <div class="row">
                            <div class="col-sm-12">
                              <input type="text" class="form-control"
                                     placeholder="URL to git repository, e.g. https://github.com/organization/repository.git"
                                     required ng-model="pythonCtrl.gitDep"/>
                            </div>
                          </div>
                        </div>
                      </div>
                  </div>


                  <h4>Private git</h4>
                  <div class="row">
                    <div class="col-sm-6">
                    <md-switch id="privateGit" class="md-primary"
                               aria-label="private-git"
                               style="margin: 0px"
                               ng-model="pythonCtrl.privateGitRepo">
                      {{ pythonCtrl.privateGitRepo? 'YES' : 'NO' }}
                    </md-switch>
                  </div>
                  </div>

                  <div ng-show="pythonCtrl.privateGitRepo">
                  <div class="control-group">
                    <div class="form-group row" style="margin-top:5px;">
                      <div class="col-sm-5">
                        <div class="row">
                          <div class="col-sm-12">
                            <div id="enableGit" class="btn-group" role="group" aria-label="...">
                              <button type="button" class="btn"
                                      ng-class="{'btn-default': pythonCtrl.gitBackend !== 'GITHUB', 'btn-primary': pythonCtrl.gitBackend === 'GITHUB'}"
                                      ng-click="pythonCtrl.gitBackend = 'GITHUB'; pythonCtrl.loadThirdPartyApiKeys()">GitHub</button>
                              <button type="button" class="btn"
                                      ng-class="{'btn-default': pythonCtrl.gitBackend !== 'GITLAB', 'btn-primary': pythonCtrl.gitBackend === 'GITLAB'}"
                                      ng-click="pythonCtrl.gitBackend = 'GITLAB'; pythonCtrl.loadThirdPartyApiKeys()">GitLab</button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="control-group">
                    <h4>Select API key</h4>
                    <div class="form-group row" style="margin-top:5px;">
                      <div class="col-sm-5">
                        <div class="row">
                          <div class="col-sm-12">
                            <ui-select id="git-api-key" ng-model="pythonCtrl.gitApiKey" theme="bootstrap"
                                       on-select="pythonCtrl.getRemoteGitBranches()" style="z-index:2">
                              <ui-select-match>
                                <span ng-bind="pythonCtrl.gitApiKey.name"></span>
                              </ui-select-match>
                              <ui-select-choices
                                      repeat="token in (pythonCtrl.thirdPartyApiKeys | filter: $select.search) track by token.name">
                                <span ng-bind="token.name | highlight: $select.search"></span>
                              </ui-select-choices>
                            </ui-select>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  </div>

                  <div ng-show="pythonCtrl.gitDep">
                    <div class="row" style="margin-top:5px;">
                      <div class="col-sm-5">

                        <button type="submit" class="btn btn-primary" ng-click="pythonCtrl.install(pythonCtrl.gitDep, 'GIT', '')"
                                ng-show="pythonCtrl.gitDep !== '' && !pythonCtrl.privateGitRepo">
                          Install <i class="fa fa-download"></i>
                        </button>

                        <button type="submit" class="btn btn-primary" ng-click="pythonCtrl.install(pythonCtrl.gitDep, 'GIT', '')"
                                ng-show="pythonCtrl.gitDep !== '' && pythonCtrl.gitApiKey !== '' && pythonCtrl.privateGitRepo">
                          Install <i class="fa fa-download"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </uib-tab>
              <uib-tab index="1" heading="Manage Environment" ng-show="pythonCtrl.enabled && pythonCtrl.installed"
                ng-click="pythonCtrl.loadLibraries()">
                <div class="alert alert-warning" style="padding: 10px; margin-bottom: 10px;" ng-show="!pythonCtrl.loadingLibs && pythonCtrl.pythonConflicts">
                  <span style="font-size: 1.1em !important; margin-left:100px;">
                    <i class="fa fa-warning" uib-tooltip="pip check detected unsatisfied dependency constraints in the environment. If possible please resolve them." style="color:orange;">
                    </i> <a ng-click="pythonCtrl.showConflicts()" style="cursor: pointer;">Conflicts</a> detected in this environment
                  </span>
                </div>
                <div>
                  <h2 style="margin-bottom: 30px;">Manage Environment
                    <span ng-show="pythonCtrl.loadingLibs" class="glyphicon glyphicon-refresh spin-icon" style="font-size: 0.9em !important;"> </span>
                    <div style="float:right">
                      <button tooltip-placement="auto top" style="float:left; margin-right: 10px;"
                              uib-tooltip="Export the Anaconda environment of the project as a .yml file."
                              class="btn btn-success" style="float:right" type="button" ng-click="pythonCtrl.exportEnvironment()">
                        <span class="fa fa-spinner fa-spin" aria-hidden="true" ng-show="pythonCtrl.exporting"></span>
                        Export Environment
                      </button>
                      <button tooltip-placement="auto top" style="float:right;"
                              uib-tooltip="The Anaconda environment of the project will be deleted. A new environment can be created after deletion."
                              ng-click="pythonCtrl.destroyAnaconda()"
                              type="button" class="btn btn-danger" >
                        Remove Environment
                      </button>
                    </div>
                  </h2>
                </div>
                <div ng-if="pythonCtrl.installedLibs.length === 0 && !pythonCtrl.loadingLibs">There are no installed libraries.</div>
                <table class="table table-striped" ng-show="pythonCtrl.installedLibs.length > 0">
                  <thead>
                    <tr>
                      <th class="col-sm-2">
                        <a ng-click="sortBy('channel')">
                          Channel
                          <span ng-show="sortType === 'channel'"
                                ng-class="{'fa fa-caret-down': reverse, 'fa fa-caret-up': !reverse}"></span></a>
                      </th>
                      <th class="col-sm-2">
                        <a ng-click="sortBy('library')">
                          Library
                          <span ng-show="sortType === 'library'"
                                ng-class="{'fa fa-caret-down': reverse, 'fa fa-caret-up': !reverse}"></span></a>
                      </th>
                      <th class="col-sm-2">
                        <a ng-click="sortBy('version')">
                          Version
                          <span ng-show="sortType === 'version'"
                                ng-class="{'fa fa-caret-down': reverse, 'fa fa-caret-up': !reverse}"></span></a>
                      </th>
                      <th class="col-sm-2">
                        <a ng-click="sortBy('packageSource')">
                          Package Manager
                          <span ng-show="sortType === 'packageSource'"
                                ng-class="{'fa fa-caret-down': reverse, 'fa fa-caret-up': !reverse}">
                        </span></a>
                      </th>
                      <th class="col-sm-1">
                        <a ng-click="sortBy('status')">
                          Status
                          <span ng-show="sortType === 'status'"
                                ng-class="{'fa fa-caret-down': reverse, 'fa fa-caret-up': !reverse}"></span>
                        </a>
                      </th>
                      <th class="col-sm-2 text-center">
                        <a ng-click="sortBy('preinstalled')">
                          User-Installed
                          <span ng-show="sortType === 'preinstalled'"
                                ng-class="{'fa fa-caret-down': reverse, 'fa fa-caret-up': !reverse}"></span>
                        </a>
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr ng-repeat="row in pythonCtrl.installedLibs | orderBy:sortType:reverse"
                        ng-class="{'selectedTopicOdd': row.isSelected === true}">
                      <td class="col-sm-2">
                        <div class="row" style="margin-left: 10px;"><b>{{row.channel}}</b></div>
                      </td>
                      <td class="col-sm-2">
                        <div class="row" style="margin-left: 10px;"><b>{{row.library}}</b></div>
                      </td>
                      <td class="col-sm-2">
                        <div class="row" style="margin-left: 10px;"><b>{{row.version}}</b></div>
                      </td>
                      <td class="col-sm-2">
                        <div class="row" style="margin-left: 10px;"><b>{{row.packageSource}}</b></div>
                      </td>
                      <td class="col-sm-2">
                        <div class="row">
                          <div class="col-sm-10">
                            <div ng-show="pythonCtrl.getStatus(row) === 'INSTALLED'">
                              <b>{{pythonCtrl.getStatus(row)}}</b>
                              <i ng-show="row.library === 'tensorflow' && row.version !== pythonCtrl.tensorflowVersion" class="fa fa-warning" style="color:orange; margin-top:3px;" uib-tooltip="TensorFlow {{row.version}} is not the supported TensorFlow version for this installation.
                            Please revert to version {{pythonCtrl.tensorflowVersion}} if you encounter issues."></i>
                            </div>
                            <div ng-show="pythonCtrl.getStatus(row) === 'FAILED'"style="color: #880000 ">
                              <b>{{pythonCtrl.getStatus(row)}}</b></div>
                            <div ng-show="pythonCtrl.getStatus(row) === 'ONGOING'" class="text-muted">
                              <b>{{pythonCtrl.getStatus(row)}}</b>
                            </div>
                          </div>
                        </div>
                      </td>
                      <td class="col-sm-2 text-center">
                        <div class="row" ng-if="row.preinstalled === 'false'">
                          <div class="button-group">
                            <button type="submit" class="btn btn-danger col-sm-offset-1"
                                    ng-click="pythonCtrl.uninstall(row)"
                                    ng-disabled="pythonCtrl.getStatus(row) === 'ONGOING' || pythonCtrl.uninstalling[row.library]">
                              <i ng-if="pythonCtrl.uninstalling[row.library]" style="margin-top: 2px" class="col-sm-6 fa fa-spinner fa-spin pull-right"></i>
                              Uninstall</button>
                          </div>
                        </div>
                        <div class="row" ng-if="row.preinstalled === 'true'">
                          <div class="col-sm-offset-1">Pre-installed</div>
                        </div>
                      </td>
                    </tr>
                </table>
              </uib-tab>
              <uib-tab index="2" heading="Ongoing Operations" ng-show="pythonCtrl.enabled && pythonCtrl.installed"
                ng-click="pythonCtrl.loadCommands()">
                <h2>Ongoing Anaconda operations
                  <span ng-show="pythonCtrl.loadingCommands" class="glyphicon glyphicon-refresh spin-icon" style="font-size: 0.9em !important;"> </span></h2>

                <div ng-if="pythonCtrl.showLogs === false">
                  <div ng-if="pythonCtrl.opsStatus.length === 0 && !pythonCtrl.loadingCommands">There are no ongoing operations.</div>

                  <table st-table="rowCollection" class="table table-striped" ng-if="pythonCtrl.opsStatus.length > 0">
                    <thead>
                      <tr>
                        <th st-sort="depName" class="col-sm-2">Operation</th>
                        <th class="col-sm-2"></th>
                        <th class="col-sm-2"></th>
                        <th class="col-sm-2"></th>
                        <th class="col-sm-4">Progress</th>
                        <th class="col-sm-2"></th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr st-select-row="row" st-select-mode="single" ng-repeat="row in pythonCtrl.opsStatus"
                        ng-class="{'selectedTopicOdd': row.isSelected === true}">
                        <td class="col-sm-2">
                          <div class="row" style="margin-left: 10px;"><b>{{row.commands.items[0].op}}</b></div>
                        </td>
                        <td class="col-sm-2">
                          <div ng-if="row.type === 'environmentDTO'">Environment</div>
                          <div ng-if="row.type === 'commandDTO'">Listing libraries in base environment</div>
                          <div ng-if="row.type === 'libraryDTO'">
                            <span ng-if="row.library !== '0.0'">{{row.library}}</span>
                            <span ng-if="row.library === '0.0'">Creating environment from .yml file</span>
                          </div>
                        </td>
                        <td class="col-sm-2">
                          {{pythonCtrl.getVersion(row)}}
                        </td>
                        <td class="col-sm-2">
                          <span ng-if="pythonCtrl.getStatus(row) === 'FAILED'" style="color: #880000 ">{{pythonCtrl.getStatus(row)}}</span>
                          <span ng-if="pythonCtrl.getStatus(row) !== 'FAILED'">{{pythonCtrl.getStatus(row)}}</span>
                        </td>
                        <td class="col-sm-4">
                          <div id="python-install-progress" class="progress" style="margin-top: 5px">
                            <div class="progress-bar progress-bar-striped progress-bar-success" role="progressbar"
                                 ng-style="{width:pythonCtrl.installProgress('Done', row) + '%'}">
                              <span ng-if="pythonCtrl.installProgress('Done', row) > 15">Done</span>
                            </div>
                            <div class="progress-bar progress-bar-striped progress-bar-warning" role="progressbar"
                                 ng-style="{width:pythonCtrl.installProgress('Ongoing', row) + '%'}">
                              <span ng-if="pythonCtrl.installProgress('Ongoing', row) > 15">Ongoing</span>
                            </div>
                            <div class="progress-bar progress-bar-striped progress-bar-danger" role="progressbar"
                                 ng-style="{width:pythonCtrl.installProgress('Failed', row) + '%'}">
                              <span ng-if="pythonCtrl.installProgress('Failed', row) > 15">Failed</span>
                            </div>
                          </div>
                        </td>
                        <td class="col-md-2">
                          <div class="btn-group">
                            <button ng-if="pythonCtrl.getStatus(row) === 'FAILED'" type="submit" class="btn btn-info"
                                    tooltip-placement="auto left"
                                    uib-tooltip="Show error logs "
                                    ng-click="pythonCtrl.showCommandsLogs(row, false)">
                              <i class="fa fa-bars"></i>
                            </button>
                            <button ng-show="pythonCtrl.getStatus(row) === 'FAILED' && pythonCtrl.getOp(row) === 'UNINSTALL'" type="submit"
                                    class="btn btn-md btn-danger"
                                    tooltip-placement="auto left"
                                    uib-tooltip="Remove the conda command to clean up this environment"
                                    ng-click="pythonCtrl.deleteCommands(row)">
                              <i class="fa fa-trash"></i>
                            </button>
                            <button ng-show="pythonCtrl.getStatus(row) === 'FAILED' && pythonCtrl.getOp(row) === 'INSTALL'" type="submit"
                                    class="btn btn-md btn-danger"
                                    tooltip-placement="auto left"
                                    uib-tooltip="Remove the conda command to clean up this environment"
                                    ng-click="pythonCtrl.deleteCommands(row)">
                              <i class="fa fa-trash"></i>
                            </button>
                            <button ng-show="pythonCtrl.getStatus(row) === 'FAILED' && (pythonCtrl.getOp(row) === 'CREATE' || pythonCtrl.getOp(row) === 'REMOVE')" type="submit"
                                    class="btn btn-md btn-danger"
                                    tooltip-placement="auto left"
                                    uib-tooltip="Remove the conda command to clean up this environment"
                                    ng-click="pythonCtrl.deleteEnvironment()">
                              <i class="fa fa-trash"></i>
                            </button>
                            <button ng-show="pythonCtrl.getStatus(row) === 'FAILED' && pythonCtrl.getOp(row) === 'YML'" type="submit"
                                    class="btn btn-md btn-danger"
                                    tooltip-placement="auto left"
                                    uib-tooltip="Remove the conda command to clean up this environment"
                                    ng-click="pythonCtrl.deleteEnvironment()">
                              <i class="fa fa-trash"></i>
                            </button>
                            <button ng-show="pythonCtrl.getStatus(row) === 'FAILED' && pythonCtrl.getOp(row) === 'EXPORT'" type="submit"
                                    class="btn btn-md btn-danger"
                                    tooltip-placement="auto left"
                                    uib-tooltip="Remove the conda command to clean up this environment"
                                    ng-click="pythonCtrl.deleteEnvironmentCommands()">
                              <i class="fa fa-trash"></i>
                            </button>
                            <button ng-show="pythonCtrl.getStatus(row) === 'FAILED' && pythonCtrl.getOp(row) !== 'YML' && pythonCtrl.getOp(row) !== 'EXPORT' && pythonCtrl.getOp(row) !== 'CREATE' && pythonCtrl.getOp(row) !== 'REMOVE' && pythonCtrl.getOp(row) !== 'SYNC_BASE_ENV'" type="submit"
                                    class="btn btn-md btn-warning"
                                    tooltip-placement="auto left"
                                    uib-tooltip="Retry the conda command"
                                    ng-click="pythonCtrl.retryFailedCondaLibraryOp(row)">
                              <i class="fa fa-repeat"></i>
                            </button>
                            <button ng-show="pythonCtrl.getStatus(row) === 'FAILED' && (pythonCtrl.getOp(row) === 'EXPORT' || pythonCtrl.getOp(row) === 'CREATE' || pythonCtrl.getOp(row) === 'REMOVE' || pythonCtrl.getOp(row) === 'SYNC_BASE_ENV')" type="submit"
                                    class="btn btn-md btn-warning"
                                    tooltip-placement="auto left"
                                    uib-tooltip="Retry the conda command"
                                    ng-click="pythonCtrl.retryFailedCondaEnvOp(row)">
                              <i class="fa fa-repeat"></i>
                            </button>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
                <div class="" ng-if="pythonCtrl.showLogs === true">
                  <div><button ng-click="pythonCtrl.showMainUI(); $event.stopPropagation();" class="btn btn-primary btn-md fa fa-table"
                               style="font-size:0.9em; padding:7px 10px; margin-bottom: 3px; background-color:#005571;"
                               onmouseover="this.style.backgroundColor='#004159'" onmouseout="this.style.backgroundColor='#005571'"> Conda
                      commands summary</button></div>
                  <div class="panel panel-default" style="min-height: 212px;">
                    <div class="panel-heading" >
                      <div>
                        <span style="font-weight: bold;" id="logs">Error Logs for {{pythonCtrl.errorOp}} {{pythonCtrl.errorArtifact}}</span>
                      </div>
                    </div>
                    <div class="panel-body">
                      <div>
                        <table class="table table-hover ds-sidenav-table" style="width: 100%">
                          <tbody>
                          <div ng-bind-html="pythonCtrl.errorMessage"></div>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </uib-tab>
            </uib-tabset>
            </div>
          </div>
        </div>
      </section>

    </div>
  </div>
</div>