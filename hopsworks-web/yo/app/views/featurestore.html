<!--
  ~ This file is part of Hopsworks
  ~ Copyright (C) 2018, Logical Clocks AB. All rights reserved
  ~
  ~ Hopsworks is free software: you can redistribute it and/or modify it under the terms of
  ~ the GNU Affero General Public License as published by the Free Software Foundation,
  ~ either version 3 of the License, or (at your option) any later version.
  ~
  ~ Hopsworks is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
  ~ without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
  ~ PURPOSE.  See the GNU Affero General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License along with this program.
  ~ If not, see <https://www.gnu.org/licenses/>.
  -->

<div ng-controller="MainCtrl as mainCtrl">
    <div ng-include="'nav.html'"></div>
    <div id="wrapper" class="toggled" ng-controller="featurestoreCtrl as featurestoreCtrl">
        <div class="overlay"></div>
        <div ng-include="'navProject.html'"></div>

        <div class="content-wrapper">
            <!-- Page Content -->
            <div class="content" style="background-color:white">
                <div class="row">
                    <div ng-if="featurestoreCtrl.loading" class="loadingwrap" style="z-index: 102">
                        <div class="loading-content">
                            <div class="loader-in-wrap"></div>
                            {{featurestoreCtrl.loadingText}}
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-sm-2">
                            <button type="button"
                                    ng-click="featurestoreCtrl.viewFeaturestoreInfo()" class="btn btn-sm btn-primary"
                                    uib-tooltip="View feature store info"
                                    id="viewFeaturestoreInfo"
                            >
                                View Info
                            </button>
                        </div>
                        <label class="col-sm-2 control-label" style="margin-top: 5px;">
                            Feature Store:
                            <i class="fa fa-info-circle" tooltip-placement="auto left"
                               uib-tooltip="Each project with the feature store service enabled have a feature store.
                           In addition, feature stores can be shared across projets. This dropdown list shows your project's feature store and all
                           feature stores shared with the project"
                               style="margin-left: 10px"></i>
                        </label>
                        <div class="col-sm-8">
                            <ui-select ng-model="selected.value"
                                       on-select="featurestoreCtrl.onSelectFeaturestoreCallback($item)"
                                       style="z-index: 101"
                                       id="selectFeatureStore">
                                <ui-select-match placeholder="Select one of your feature stores">
                                    <span>{{$select.selected.featurestoreName}}</span>
                                </ui-select-match>
                                <ui-select-choices repeat="item in featurestoreCtrl.featurestores">
                                    <span ng-bind="item.featurestoreName"></span>
                                </ui-select-choices>
                            </ui-select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-sm-2">
                            <button type="button" ng-click="featurestoreCtrl.showCreateFeaturegroupForm()"
                                    class="btn btn-default btn-success control-label" style="margin-bottom: 10px"
                                    uib-tooltip="Create new feature group"
                                    id="createNewFg"
                            >
                                Create New Feature Group<i style="margin-left: 10px" class="glyphicon glyphicon-plus">
                            </i>
                            </button>
                        </div>
                        <div class="col-sm-1"></div>
                        <div class="col-sm-2">
                            <button type="button" ng-click="featurestoreCtrl.showCreateTrainingDatasetForm()"
                                    class="btn btn-default btn-success control-label" style="margin-bottom: 10px"
                                    uib-tooltip="Create new training dataset" ,
                                    id="createNewTd"
                            >
                                Create New Training Dataset<i style="margin-left: 10px"
                                                              class="glyphicon glyphicon-plus">
                            </i>
                            </button>
                        </div>
                        <div class="col-sm-8"></div>
                    </div>
                    <h3 class="text-muted" style="text-align: center;"
                        ng-show="featurestoreCtrl.featuregroupsDictList.length < 1 && featurestoreCtrl.trainingDatasetsDictList.length < 1">
                        No features or training datasets to show.
                    </h3>
                    <div>
                        <div class="row"
                             ng-show="featurestoreCtrl.featuregroupsDictList.length > 0 || featurestoreCtrl.trainingDatasetsDictList.length > 0">
                            <div class="row">
                                <div class="col-sm-12">
                                    <ul class="nav nav-tabs">
                                        <li ng-class="{'active' : featurestoreCtrl.showFeaturesBool === 1}"><a
                                                ng-click="featurestoreCtrl.showFeatures()" id="showFeatures">
                                            Features
                                            <i class="fa fa-info-circle" tooltip-placement="auto left"
                                               uib-tooltip="A view which lists all features across all featuregroups in the selected
                                   feature store"
                                               style="margin-left: 10px"></i>
                                        </a>
                                        </li>
                                        <li ng-class="{'active' : featurestoreCtrl.showFeaturegroupsBool === 1}"><a
                                                ng-click="featurestoreCtrl.showFeaturegroups()" id="showFeaturegroups">
                                            Feature Groups
                                            <i class="fa fa-info-circle" tooltip-placement="auto left"
                                               uib-tooltip="A view which lists all feature groups, a feature group contains
                                one ore more features computed from the same dataset using the same Spark job"
                                               style="margin-left: 10px"></i>
                                        </a>
                                        </li>
                                        <li ng-class="{'active' : featurestoreCtrl.showTrainingDatasetsBool === 1}"><a
                                                ng-click="featurestoreCtrl.showTrainingDatasets()"
                                                id="showTrainingDatasets">
                                            Training Datasets
                                            <i class="fa fa-info-circle" tooltip-placement="auto left"
                                               uib-tooltip="A view which lists all managed training datasets for this feature store,
                                       a training dataset typically contains a set of features and labels and is materialized
                                       into a format optimized for training, such as tfrecords or parquet"
                                               style="margin-left: 10px"></i>
                                        </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>

                            <h3 class="text-muted" style="text-align: center;"
                                ng-show="featurestoreCtrl.showFeaturegroupsBool === 1 && featurestoreCtrl.featuregroupsDictList.length < 1">
                                No Featuregroups to show
                            </h3>
                            <div class="row"
                                 ng-show="featurestoreCtrl.showFeaturegroupsBool === 1 && featurestoreCtrl.featuregroupsDictList.length > 0"
                                 style="margin-right: 20px">
                                <div class="row form-inline" style="margin-top: 10px;">
                                    <div class="col-sm-6 col-md-6 col-lg-6 form-group">
                                        <label style="margin-left: 20px">Search: <input class="form-control"
                                                                                        style="margin-left: 10px;"
                                                                                        ng-model="featurestoreCtrl.fgFilter">
                                        </label>
                                    </div>
                                    <div class="col-sm-6 col-md-6 col-lg-6 form-group">
                                        <div class="pull-right btn-group" style="margin-right: 20px">
                                            <label>Feature groups per page:
                                                <input type="number" min="1"
                                                       max="50"
                                                       class="form-control" ng-model="featurestoreCtrl.pageSize">
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <table class="table table-hover" style="margin-left:20px; margin-right:20px"
                                       id="fgTable">
                                    <thead style="border:none;">
                                    <th style="width: 5%">
                                    </th>
                                    <th style="width: 25%" ng-click="featurestoreCtrl.sort('name')">
                                        Name
                                        <i class="fa fa-info-circle" tooltip-placement="auto left"
                                           uib-tooltip="The name of the feature group"
                                           style="margin-left: 5px"></i>
                                        <span class="glyphicon sort-icon"
                                              ng-show="featurestoreCtrl.featuregroupSortKey == 'name'"
                                              ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
                                    </th>
                                    <th style="width: 30%">
                                        Job
                                        <i class="fa fa-info-circle" tooltip-placement="auto left"
                                           uib-tooltip="The Spark job to compute the feature group"
                                           style="margin-left: 5px"></i>
                                    </th>
                                    <th style="width: 25%">
                                        Last Computed
                                        <i class="fa fa-info-circle" tooltip-placement="auto left"
                                           uib-tooltip="Timestamp when the feature group was last computed,
                               if none it means that the job for computing the feature group has not been run"
                                           style="margin-left: 5px"></i>
                                    </th>
                                    <th style="width: 5%">
                                        Version
                                        <i class="fa fa-info-circle" tooltip-placement="auto left"
                                           uib-tooltip="The version of the feature group"
                                           style="margin-left: 5px"></i>
                                    </th>
                                    <th style="width: 9%" id="fgActionCol">
                                        Actions
                                        <i class="fa fa-info-circle" tooltip-placement="auto left"
                                           uib-tooltip="Delete/Update/Increment Version/Reload contents/View schema/View Details/View Statistics"
                                           style="margin-left: 5px"></i>
                                    </th>
                                    </thead>
                                    <tbody>
                                    <tr dir-paginate="featuregroup in featurestoreCtrl.featuregroupsDictList| orderBy :featurestoreCtrl.featuregroupSortKey:featurestoreCtrl.reverse| filter:featurestoreCtrl.fgFilter:false | itemsPerPage:featurestoreCtrl.pageSize"
                                        pagination-id="featuregroupstable">
                                        <td>
                                            <span class="glyphicon glyphicon-warning-sign"
                                                  uib-tooltip="{{featuregroup.versionToGroups[featuregroup.activeVersion].outOfDateReason}}"
                                                  ng-if="featuregroup.versionToGroups[featuregroup.activeVersion].outOfDate">
                                            </span>
                                            <span class="glyphicon glyphicon-ok-sign"
                                                  uib-tooltip="The feature group is up-to-date,
                                                    no dependencies have been modified since the feature group was last updated"
                                                  ng-if="!featuregroup.versionToGroups[featuregroup.activeVersion].outOfDate">
                                            </span>
                                        </td>
                                        <td>{{featuregroup.name}}</td>
                                        <td>
                                            <div ng-if="featuregroup.versionToGroups[featuregroup.activeVersion].jobName === null">
                                                no job specified
                                            </div>
                                            <div ng-if="featuregroup.versionToGroups[featuregroup.activeVersion].jobName !== null">
                                                    <span ng-if="featurestoreCtrl.isJobLocal(featuregroup.versionToGroups[featuregroup.activeVersion].jobId)"
                                                          style="cursor:pointer;color:black;text-decoration:underline;"
                                                          ng-click="featurestoreCtrl.launchJob(featuregroup.versionToGroups[featuregroup.activeVersion].jobName); $event.stopPropagation();">
                                                        {{featuregroup.versionToGroups[featuregroup.activeVersion].jobName}}
                                                    </span>
                                                <span
                                                        ng-if="!featurestoreCtrl.isJobLocal(featuregroup.versionToGroups[featuregroup.activeVersion].jobId)"
                                                        style="color: #880000 ">
                                         (The job is owned by another project)
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <div ng-if="featuregroup.versionToGroups[featuregroup.activeVersion].lastComputed === null">
                                                -
                                            </div>
                                            <div ng-if="featuregroup.versionToGroups[featuregroup.activeVersion].lastComputed !== null">
                                        <span
                                                ng-if="featuregroup.versionToGroups[featuregroup.activeVersion].jobStatus === 'Undefined'"
                                                style="color: #0066bb ">
                                            {{formatDate(featuregroup.versionToGroups[featuregroup.activeVersion].lastComputed)}}
                                        </span>
                                                <span
                                                        ng-if="featuregroup.versionToGroups[featuregroup.activeVersion].jobStatus === 'Succeeded'"
                                                        style="color: #00A000 ">
                                           {{formatDate(featuregroup.versionToGroups[featuregroup.activeVersion].lastComputed)}}
                                        </span>
                                                <span
                                                        ng-if="featuregroup.versionToGroups[featuregroup.activeVersion].jobStatus === 'Failed'"
                                                        style="color: #880000 ">
                                         {{formatDate(featuregroup.versionToGroups[featuregroup.activeVersion].lastComputed)}}
                                        </span>
                                                <span
                                                        ng-if="featuregroup.versionToGroups[featuregroup.activeVersion].jobStatus === 'Killed'"
                                                        style="color: #880000 ">
                                             {{formatDate(featuregroup.versionToGroups[featuregroup.activeVersion].lastComputed)}}
                                        </span>
                                            </div>
                                        </td>
                                        <td>
                                            <ui-select ng-model="featuregroup.activeVersion"
                                                       style="z-index: {{100-$index}}">
                                                <ui-select-match placeholder="Select a version of the feature group">
                                                    <span>{{$select.selected}}</span>
                                                </ui-select-match>
                                                <ui-select-choices repeat="version in featuregroup.versions">
                                                    <span ng-bind="version"></span>
                                                </ui-select-choices>
                                            </ui-select>
                                        </td>
                                        <td>
                                            <div class="btn-group" role="group">
                                                <button class="btn btn-success glyphicon glyphicon glyphicon-stats"
                                                        uib-tooltip="View statistics"
                                                        ng-click="featurestoreCtrl.viewFeaturegroupStatistics(featuregroup.versionToGroups[featuregroup.activeVersion]); $event.stopPropagation();"></button>
                                                <button class="btn btn-danger glyphicon glyphicon-trash"
                                                        uib-tooltip="Delete"
                                                        ng-click="featurestoreCtrl.deleteFeaturegroup(featuregroup.versionToGroups[featuregroup.activeVersion]); $event.stopPropagation();"></button>
                                                <div uib-dropdown class="btn-group" role="group" style="z-index: auto;">
                                                    <button type="button"
                                                            uib-dropdown-toggle class="btn btn-default glyphicon"
                                                            style="font-family: sans-serif;"
                                                    >
                                                        More
                                                        <span class="caret"></span>
                                                    </button>
                                                    <ul uib-dropdown-menu class="dropdown-menu dropdown-menu-right"
                                                        style="font-family: sans-serif;">
                                                        <li><a role="menuitem"
                                                               ng-click="featurestoreCtrl.newFeaturegroupVersion(featuregroup.versionToGroups, featuregroup.versions); $event.stopPropagation();">
                                                            Create new feature group version</a></li>
                                                        <li><a role="menuitem"
                                                               ng-click="featurestoreCtrl.clearFeaturegroupContents(featuregroup.versionToGroups[featuregroup.activeVersion]); $event.stopPropagation();">
                                                            Clear feature group contents</a></li>
                                                        <li><a role="menuitem"
                                                               ng-click="featurestoreCtrl.updateFeaturegroup(featuregroup.versionToGroups[featuregroup.activeVersion]); $event.stopPropagatphicion();">
                                                            Edit feature group</a></li>
                                                        <li><a role="menuitem"
                                                               ng-click="featurestoreCtrl.previewFeaturegroup(featuregroup.versionToGroups[featuregroup.activeVersion]);">
                                                            Preview feature group data</a></li>
                                                        <li><a role="menuitem"
                                                               ng-click="featurestoreCtrl.viewFeaturegroupInfo(featuregroup.versionToGroups[featuregroup.activeVersion]);">
                                                            View feature group details</a></li>
                                                        <li><a role="menuitem"
                                                               ng-click="featurestoreCtrl.viewSchemaContent(featuregroup.versionToGroups[featuregroup.activeVersion]);">
                                                            View feature group schema</a></li>
                                                        <li><a role="menuitem"
                                                               ng-click="featurestoreCtrl.viewFeaturegroupDependencies(featuregroup.versionToGroups[featuregroup.activeVersion]);">
                                                            View feature group dependencies</a></li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                                <dir-pagination-controls
                                        pagination-id="featuregroupstable"
                                        class="pull-right"
                                        max-size="5"
                                        direction-links="true"
                                        boundary-links="true"
                                        style="margin-right: 20px"
                                >
                                </dir-pagination-controls>
                            </div>

                            <h3 class="text-muted" style="text-align: center;"
                                ng-show="featurestoreCtrl.showFeaturesBool === 1 && featurestoreCtrl.features.length < 1">
                                No features to show.
                            </h3>

                            <div class="row"
                                 ng-show="featurestoreCtrl.showFeaturesBool === 1 && featurestoreCtrl.features.length > 0"
                                 style="margin-right: 20px">
                                <div class="row form-inline" style="margin-top: 10px;">
                                    <div class="col-sm-6 col-md-6 col-lg-6 form-group">
                                        <label style="margin-left: 20px">Search: <input class="form-control"
                                                                                        style="margin-left: 10px;"
                                                                                        ng-model="featurestoreCtrl.fFilter"
                                                                                        id="fSearch"
                                        >
                                        </label>
                                    </div>
                                    <div class="col-sm-6 col-md-6 col-lg-6 form-group">
                                        <div class="pull-right btn-group" style="margin-right: 20px">
                                            <label>Features per page:
                                                <input type="number" min="1"
                                                       max="50"
                                                       class="form-control" ng-model="featurestoreCtrl.pageSize">
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <table class="table table-hover" style="margin-left:20px; margin-right:20px">
                                    <thead style="border:none;">
                                    <th style="width: 28%" ng-click="featurestoreCtrl.sort('name')">
                                        Name
                                        <i class="fa fa-info-circle" tooltip-placement="auto left"
                                           uib-tooltip="The name of the feature (Hive column name)"
                                           style="margin-left: 10px"></i>
                                        <span class="glyphicon sort-icon"
                                              ng-show="featurestoreCtrl.featureSortKey == 'name'"
                                              ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
                                    </th>
                                    <th style="width: 28%">
                                        Type
                                        <i class="fa fa-info-circle" tooltip-placement="auto left"
                                           uib-tooltip="The type of the feature (Hive column type)"
                                           style="margin-left: 10px"></i>
                                    </th>
                                    <th style="width: 28%">
                                        Description
                                        <i class="fa fa-info-circle" tooltip-placement="auto left"
                                           uib-tooltip="Description of the feature"
                                           style="margin-left: 10px"></i>
                                    </th>
                                    <th style="width: 5%">
                                        Version
                                        <i class="fa fa-info-circle" tooltip-placement="auto left"
                                           uib-tooltip="Version of the feature"
                                           style="margin-left: 10px"></i>
                                    </th>
                                    <th style="width: 9%" id="fActionCol">
                                        Actions
                                        <i class="fa fa-info-circle" tooltip-placement="auto left"
                                           uib-tooltip="Delete/Update/Increment Version/Reload contents/View schema/View Details/View Statistics"
                                           style="margin-left: 10px"></i>
                                    </th>
                                    </thead>
                                    <tbody>
                                    <tr dir-paginate="feature in featurestoreCtrl.features| orderBy :featurestoreCtrl.featureSortKey:featurestoreCtrl.reverse| filter:featurestoreCtrl.fFilter:false |itemsPerPage:featurestoreCtrl.pageSize"
                                        pagination-id="featurestable">
                                        <td>{{feature.name}}</td>
                                        <td>{{feature.type}}</td>
                                        <td>{{feature.description}}</td>
                                        <td>{{feature.version}}</td>
                                        <td>
                                            <div class="btn-group" role="group">
                                                <button type="button"
                                                        ng-click="featurestoreCtrl.goToFeaturegroup(feature.featuregroup)"
                                                        class="btn btn-primary glyphicon glyphicon-eye-open"
                                                        uib-tooltip="Go to feature group">
                                                </button>
                                                <button type="button"
                                                        ng-click="featurestoreCtrl.viewFeatureInfo(feature)"
                                                        class="btn btn-primary glyphicon glyphicon-expand"
                                                        uib-tooltip="View Feature Details">
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                                <dir-pagination-controls
                                        pagination-id="featurestable"
                                        class="pull-right"
                                        max-size="5"
                                        direction-links="true"
                                        boundary-links="true"
                                        style="margin-right: 20px"
                                        auto-hide="false"
                                >
                                </dir-pagination-controls>
                            </div>

                            <h3 class="text-muted" style="text-align: center;"
                                ng-show="featurestoreCtrl.showTrainingDatasetsBool === 1 && featurestoreCtrl.trainingDatasetsDictList.length < 1">
                                No training datasets to show.
                            </h3>

                            <div class="row"
                                 ng-show="featurestoreCtrl.showTrainingDatasetsBool === 1 && featurestoreCtrl.trainingDatasetsDictList.length > 0"
                                 style="margin-right: 20px">
                                <div class="row form-inline" style="margin-top: 10px;">
                                    <div class="col-sm-6 col-md-6 col-lg-6 form-group">
                                        <label style="margin-left: 20px">Search: <input class="form-control"
                                                                                        style="margin-left: 10px;"
                                                                                        ng-model="featurestoreCtrl.dFilter"
                                        >
                                        </label>
                                    </div>
                                    <div class="col-sm-6 col-md-6 col-lg-6 form-group">
                                        <div class="pull-right btn-group" style="margin-right: 20px">
                                            <label>Training Datasets per page:
                                                <input type="number" min="1"
                                                       max="50"
                                                       class="form-control" ng-model="featurestoreCtrl.pageSize">
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <table class="table table-hover" style="margin-left:20px; margin-right:20px" id="tdTable">
                                    <thead style="border:none;">
                                    <th style="width: 5%">
                                    </th>
                                    <th ng-click="featurestoreCtrl.sort('name')" style="width: 20%">
                                        Name
                                        <i class="fa fa-info-circle" tooltip-placement="auto left"
                                           uib-tooltip="The name of the training dataset"
                                           style="margin-left: 10px"></i>
                                        <span class="glyphicon sort-icon"
                                              ng-show="featurestoreCtrl.featureSortKey == 'name'"
                                              ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
                                    </th>
                                    <th style="width: 19%">
                                        Data format
                                        <i class="fa fa-info-circle" tooltip-placement="auto left"
                                           uib-tooltip="The data-format of the training dataset"
                                           style="margin-left: 10px"></i>
                                    </th>
                                    <th style="width: 19%">
                                        Job
                                        <i class="fa fa-info-circle" tooltip-placement="auto left"
                                           uib-tooltip="The Spark job to compute the training dataset"
                                           style="margin-left: 10px"></i>
                                    </th>
                                    <th style="width: 19%">
                                        Last Computed
                                        <i class="fa fa-info-circle" tooltip-placement="auto left"
                                           uib-tooltip="Timestamp when the training dataset was last computed,
                               if none it means that the job for computing the feature group has not been run"
                                           style="margin-left: 10px"></i>
                                    </th>
                                    <th style="width: 5%">
                                        Version
                                        <i class="fa fa-info-circle" tooltip-placement="auto left"
                                           uib-tooltip="The version of the training dataset"
                                           style="margin-left: 10px"></i>
                                    </th>
                                    <th style="width: 9%" id="tdActionCol">
                                        Actions
                                        <i class="fa fa-info-circle" tooltip-placement="auto left"
                                           uib-tooltip="Delete/Update/Increment Version/View details"
                                           style="margin-left: 10px"></i>
                                    </th>
                                    </thead>
                                    <tbody>
                                    <tr dir-paginate="dataset in featurestoreCtrl.trainingDatasetsDictList| orderBy :featurestoreCtrl.trainingDatasetSortKey:featurestoreCtrl.reverse| filter:featurestoreCtrl.dFilter:false |itemsPerPage:featurestoreCtrl.pageSize"
                                        pagination-id="trainingdatasetstable">
                                        <td>
                                            <span class="glyphicon glyphicon-warning-sign"
                                                  uib-tooltip="{{dataset.versionToGroups[dataset.activeVersion].outOfDateReason}}"
                                                  ng-if="dataset.versionToGroups[dataset.activeVersion].outOfDate">
                                            </span>
                                            <span class="glyphicon glyphicon-ok-sign"
                                                  uib-tooltip="The training dataset is up-to-date,
                                                    no dependencies have been modified since the training dataset was last updated"
                                                  ng-if="!dataset.versionToGroups[dataset.activeVersion].outOfDate">
                                            </span>
                                        </td>
                                        <td>{{dataset.name}}</td>
                                        <td>{{dataset.versionToGroups[dataset.activeVersion].dataFormat}}</td>
                                        <td>
                                            <div ng-if="dataset.versionToGroups[dataset.activeVersion].jobName === null">
                                                no job specified
                                            </div>
                                            <div ng-if="dataset.versionToGroups[dataset.activeVersion].jobName !== null">
                                                    <span ng-if="featurestoreCtrl.isJobLocal(dataset.versionToGroups[dataset.activeVersion].jobId)"
                                                          style="cursor:pointer;color:black;text-decoration:underline;"
                                                          ng-click="featurestoreCtrl.launchJob(dataset.versionToGroups[dataset.activeVersion].jobName); $event.stopPropagation();">
                                                        {{dataset.versionToGroups[dataset.activeVersion].jobName}}
                                                    </span>
                                                <span
                                                        ng-if="!featurestoreCtrl.isJobLocal(dataset.versionToGroups[dataset.activeVersion].jobId)"
                                                        style="color: #880000 ">
                                         (The job is owned by another project)
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <div ng-if="dataset.versionToGroups[dataset.activeVersion].lastComputed === null">
                                                -
                                            </div>
                                            <div ng-if="dataset.versionToGroups[dataset.activeVersion].lastComputed !== null">
                                        <span
                                                ng-if="dataset.versionToGroups[dataset.activeVersion].jobStatus === 'Undefined'"
                                                style="color: #0066bb ">
                                            {{formatDate(dataset.versionToGroups[dataset.activeVersion].lastComputed)}}
                                        </span>
                                                <span
                                                        ng-if="dataset.versionToGroups[dataset.activeVersion].jobStatus === 'Succeeded'"
                                                        style="color: #00A000 ">
                                           {{formatDate(dataset.versionToGroups[dataset.activeVersion].lastComputed)}}
                                        </span>
                                                <span
                                                        ng-if="dataset.versionToGroups[dataset.activeVersion].jobStatus === 'Failed'"
                                                        style="color: #880000 ">
                                         {{formatDate(dataset.versionToGroups[dataset.activeVersion].lastComputed)}}
                                        </span>
                                                <span
                                                        ng-if="dataset.versionToGroups[dataset.activeVersion].jobStatus === 'Killed'"
                                                        style="color: #880000 ">
                                             {{formatDate(dataset.versionToGroups[dataset.activeVersion].lastComputed)}}
                                        </span>
                                            </div>
                                        </td>
                                        <td>
                                            <ui-select ng-model="dataset.activeVersion"
                                                       style="z-index: {{100-$index}}">
                                                <ui-select-match placeholder="Select a version of the training dataset">
                                                    <span>{{$select.selected}}</span>
                                                </ui-select-match>
                                                <ui-select-choices repeat="version in dataset.versions">
                                                    <span ng-bind="version"></span>
                                                </ui-select-choices>
                                            </ui-select>
                                        </td>
                                        <td>
                                            <div class="btn-group" role="group">
                                                <button class="btn btn-success glyphicon glyphicon glyphicon-stats"
                                                        uib-tooltip="View statistics"
                                                        ng-click="featurestoreCtrl.viewTrainingDatasetStatistics(dataset.versionToGroups[dataset.activeVersion]); $event.stopPropagation();"></button>
                                                <button class="btn btn-danger glyphicon glyphicon-trash"
                                                        uib-tooltip="Delete"
                                                        ng-click="featurestoreCtrl.deleteTrainingDataset(dataset.versionToGroups[dataset.activeVersion]); $event.stopPropagation();"></button>
                                                <div uib-dropdown class="btn-group" role="group" style="z-index: auto;">
                                                    <button type="button"
                                                            uib-dropdown-toggle class="btn btn-default glyphicon"
                                                            style="font-family: sans-serif;"
                                                    >
                                                        More
                                                        <span class="caret"></span>
                                                    </button>
                                                    <ul uib-dropdown-menu class="dropdown-menu dropdown-menu-right"
                                                        style="font-family: sans-serif;">
                                                        <li><a role="menuitem"
                                                               ng-click="featurestoreCtrl.newTrainingDatasetVersion(dataset.versionToGroups, dataset.versions); $event.stopPropagation();">
                                                            Create new training dataset version</a></li>
                                                        <li><a role="menuitem"
                                                               ng-click="featurestoreCtrl.updateTrainingDataset(dataset.versionToGroups[dataset.activeVersion]); $event.stopPropagatphicion();">
                                                            Edit training dataset</a></li>
                                                        <li><a role="menuitem"
                                                               ng-click="featurestoreCtrl.viewTrainingDatasetInfo(dataset.versionToGroups[dataset.activeVersion]);">
                                                            View training dataset details</a></li>
                                                        <li><a role="menuitem"
                                                               ng-click="featurestoreCtrl.viewTrainingDatasetSchemaContent(dataset.versionToGroups[dataset.activeVersion])">
                                                            View training dataset schema</a></li>
                                                        <li><a role="menuitem"
                                                               ng-click="featurestoreCtrl.viewTrainingDatasetDependencies(dataset.versionToGroups[dataset.activeVersion]);">
                                                            View training dataset dependencies</a></li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                                <dir-pagination-controls
                                        pagination-id="trainingdatasetstable"
                                        class="pull-right"
                                        max-size="5"
                                        direction-links="true"
                                        boundary-links="true"
                                        style="margin-right: 20px"
                                        auto-hide="false"
                                >
                                </dir-pagination-controls>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <tour class="ng-scope" step="featurestoreCtrl.tourService.currentStep_TourNine"
              post-tour="closeTour()"
              ng-if="featurestoreCtrl.tourService.activeTour === 'featurestore'
          && (featurestoreCtrl.tourService.informAndTips
              || featurestoreCtrl.tourService.tipsOnly) && !featurestoreCtrl.loading && !projectCtrl.loading">
            <virtual-step
                    ng-if="featurestoreCtrl.tourService.activeTour === 'featurestore'"
                    class="ng-scope"
                    tourtip="This is the feature store registry where you can list and search for
                    features/feature groups/training datasets in the feature store as well as edit their metadata."
                    tourtip-step="0"
                    tourtip-element="#featurestoreTab"
                    tourtip-placement="bottom"
                    tourtip-next-label="Next"
                    on-proceed=""
            ></virtual-step>
            <virtual-step
                    ng-if="featurestoreCtrl.tourService.activeTour === 'featurestore'"
                    class="ng-scope"
                    tourtip="Click here to select your project's feature store. A feature store can also be shared across projects.
                    You can find feature stores that has been shared with your project in the drop-down list here."
                    tourtip-step="1"
                    tourtip-element="#selectFeatureStore"
                    tourtip-placement="bottom"
                    tourtip-next-label="Next"
                    on-proceed=""
            ></virtual-step>
            <virtual-step
                    ng-if="featurestoreCtrl.tourService.activeTour === 'featurestore'"
                    class="ng-scope"
                    tourtip="Click here to view storage/ownership details about the feature store."
                    tourtip-step="2"
                    tourtip-element="#viewFeaturestoreInfo"
                    tourtip-placement="bottom"
                    tourtip-next-label="Next"
                    on-proceed=""
            ></virtual-step>
            <virtual-step
                    ng-if="featurestoreCtrl.tourService.activeTour === 'featurestore'"
                    class="ng-scope"
                    tourtip="Click here to create a new feature group, this will create a Hive table and metadata about the feature group.
                    To insert data in the feature group you can use the feature store API in Python or Scala. A feature group is a logical grouping of features.
                    Typically, all features in the same feature group are computed from the same raw dataset using the same spark-job."
                    tourtip-step="3"
                    tourtip-element="#createNewFg"
                    tourtip-placement="bottom"
                    tourtip-next-label="Next"
                    on-proceed=""
            ></virtual-step>
            <virtual-step
                    ng-if="featurestoreCtrl.tourService.activeTour === 'featurestore'"
                    class="ng-scope"
                    tourtip="Click here to create a new training dataset, this will create a training dataset of features in a format suitable for training, such as tfrecords, csv, parquet, tsv, hdf5 or npy.
                    To insert data in the training dataset you can use the feature store API in Python or Scala."
                    tourtip-step="4"
                    tourtip-element="#createNewTd"
                    tourtip-placement="bottom"
                    tourtip-next-label="Next"
                    on-proceed=""
            ></virtual-step>
            <virtual-step
                    ng-if="featurestoreCtrl.tourService.activeTour === 'featurestore'"
                    class="ng-scope"
                    tourtip="You can find the feature store datasets here."
                    tourtip-step="5"
                    tourtip-element="#datasetsTab"
                    tourtip-placement="bottom"
                    tourtip-next-label="Next"
                    on-proceed="featurestoreCtrl.goToUrl('datasets')"
                    tourtip-offset-vertical="-18"
                    tourtip-offset-horizontal="-13"
            ></virtual-step>
        </tour>
    </div>
</div>
