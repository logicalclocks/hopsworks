<!--
  ~ Changes to this file committed after and not including commit-id: ccc0d2c5f9a5ac661e60e6eaf138de7889928b8b
  ~ are released under the following license:
  ~
  ~ This file is part of Hopsworks
  ~ Copyright (C) 2018, Logical Clocks AB. All rights reserved
  ~
  ~ Hopsworks is free software: you can redistribute it and/or modify it under the terms of
  ~ the GNU Affero General Public License as published by the Free Software Foundation,
  ~ either version 3 of the License, or (at your option) any later version.
  ~
  ~ Hopsworks is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
  ~ without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
  ~ PURPOSE.  See the GNU Affero General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License along with this program.
  ~ If not, see <https://www.gnu.org/licenses/>.
  ~
  ~ Changes to this file committed before and including commit-id: ccc0d2c5f9a5ac661e60e6eaf138de7889928b8b
  ~ are released under the following license:
  ~
  ~ Copyright (C) 2013 - 2018, Logical Clocks AB and RISE SICS AB. All rights reserved
  ~
  ~ Permission is hereby granted, free of charge, to any person obtaining a copy of this
  ~ software and associated documentation files (the "Software"), to deal in the Software
  ~ without restriction, including without limitation the rights to use, copy, modify, merge,
  ~ publish, distribute, sublicense, and/or sell copies of the Software, and to permit
  ~ persons to whom the Software is furnished to do so, subject to the following conditions:
  ~
  ~ The above copyright notice and this permission notice shall be included in all copies or
  ~ substantial portions of the Software.
  ~
  ~ THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS  OR IMPLIED, INCLUDING
  ~ BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  ~ NONINFRINGEMENT. IN NO EVENT SHALL  THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
  ~ DAMAGES OR  OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
  ~ OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
  -->

<div ng-controller="MainCtrl as mainCtrl">
  <div ng-include="'nav.html'"></div>


  <div id="wrapper" ng-class="{'toggled': projectCtrl.isClosed}" ng-controller="ProjectCtrl as projectCtrl">
    <div class="overlay"></div>

    <div ng-include="'navProject.html'"></div>
    <div ng-if="mainCtrl.showSearchPage" class="content-wrapper">
      <div id="projectSearchResults">
        <div ng-include="'views/search/search.html'"></div>
      </div>
    </div>
    <div ng-if="!mainCtrl.showSearchPage" class="job-content-wrapper">
      <h3 id="projectBread"> {{ projectCtrl.currentProject.projectName}} / Jobs</h3>
    </div>
    <div ng-if="!mainCtrl.showSearchPage" class="">

      <section>
        <div class="content-wrapper">
          <h3 id="projectSettings" style="display: none;"> {{ projectCtrl.currentProject.projectName}} Settings</h3>
          <div ng-init="indextab = 0">
            <uib-tabset active="indextab">
              <uib-tab index="0" heading="Project Settings">
                <form role="form" name="projectForm" ng-submit="projectCtrl.saveProject()">
                  <h2>Project Settings</h2>
                  <div class="panel panel-default"  style="width: 800px; background-color: #F7F7F7;">
                    <div class="panel-body">
                      <div id="updateSettings">

                        <div class="row">

                          <div class="col-md-7">
                            <fieldset>
                              <div class="control-group col-md-offset-1">
                                <label class="control-label">Name</label>
                                <div class="controls">
                                  <input class="form-control" name="project_name"
                                         type="text"
                                         id="projectname"
                                         ng-model="projectCtrl.currentProject.projectName"
                                         disabled>
                                </div>
                                <p></p>
                                <label class="control-label">ID</label>
                                <div class="controls">
                                  <input class="form-control" name="id"
                                         type="text"
                                         id="id"
                                         ng-model="projectCtrl.projectId"
                                         disabled>
                                </div>
                                <p></p>
                                <label class="control-label">Description</label>
                                <div class="controls">
                                  <textarea class="form-control" style="resize:none;"
                                            ng-model="projectCtrl.currentProject.description"
                                            rows="3">
                                  </textarea>
                                </div>
                                <p></p>
                              </div>
                            </fieldset>
                          </div>

                          <div class="col-md-5">
                            <label class="control-label">Quotas</label>
                            <fieldset>
                              <label class="text-muted">Datasets</label>
                              <div class="row" style="margin-left:15px; margin-bottom:0px">
                                <fieldset ng-if="projectCtrl.hdfsQuota() != null">
                                  <span style="margin-top: 40px; margin-left:10px; margin-bottom:0px">
                                    {{projectCtrl.hdfsUsage()}} of {{projectCtrl.hdfsQuota()}} used
                                  </span>
                                </fieldset>
                              </div>
                              <div class="row" style="margin-top: 10px; margin-left:15px; margin-bottom:0px">
                                <fieldset ng-if="projectCtrl.hdfsNsCount() != null">
                                  <span style="margin-top: 40px; margin-left:10px; margin-bottom:0px" ng-show="projectCtrl.hdfsNsQuota() === -1">
                                    {{projectCtrl.hdfsNsCount()}} files
                                  </span>
                                  <span style="margin-top: 40px; margin-left:10px; margin-bottom:0px" ng-show="projectCtrl.hdfsNsQuota() !== -1">
                                    {{projectCtrl.hdfsNsCount()}} files of {{projectCtrl.hdfsNsQuota()}} used
                                  </span>
                                </fieldset>
                              </div>
                            </fieldset>

                            <fieldset ng-if="projectCtrl.isServiceEnabled('HIVE')">
                              <label class="text-muted">Hive Database</label>

                              <div class="row" style="margin-left:15px; margin-bottom:0px">
                                <fieldset ng-if="projectCtrl.hiveHdfsQuota() != null">
                                  <span style="margin-top: 40px; margin-left:10px; margin-bottom:0px">
                                    {{projectCtrl.hiveHdfsUsage()}} of {{projectCtrl.hiveHdfsQuota()}} used
                                  </span>
                                </fieldset>
                              </div>
                              <div class="row" style="margin-top: 10px; margin-left:15px; margin-bottom:0px">
                                <fieldset ng-if="projectCtrl.hiveHdfsNsCount() != null">
                                  <span style="margin-top: 40px; margin-left:10px; margin-bottom:0px" ng-show="projectCtrl.hiveHdfsNsQuota() === -1">
                                    {{projectCtrl.hiveHdfsNsCount()}} files
                                  </span>
                                  <span style="margin-top: 40px; margin-left:10px; margin-bottom:0px" ng-show="projectCtrl.hiveHdfsNsQuota() !== -1">
                                    {{projectCtrl.hiveHdfsNsCount()}} files of {{projectCtrl.hiveHdfsNsQuota()}} used
                                  </span>
                                </fieldset>
                              </div>
                            </fieldset>

                            <fieldset ng-if="projectCtrl.isServiceEnabled('FEATURESTORE')">
                              <label class="text-muted">Feature Store</label>

                              <div class="row" style="margin-left:15px; margin-bottom:0px">
                                <fieldset ng-if="projectCtrl.featurestoreHdfsQuota() != null">
                                  <span style="margin-top: 40px; margin-left:10px; margin-bottom:0px">
                                    {{projectCtrl.featurestoreHdfsUsage()}} of {{projectCtrl.featurestoreHdfsQuota()}} used
                                  </span>
                                </fieldset>
                              </div>
                              <div class="row" style="margin-top: 10px; margin-left:15px; margin-bottom:0px">
                                <fieldset ng-if="projectCtrl.featurestoreHdfsNsCount() != null">
                                  <span style="margin-top: 40px; margin-left:10px; margin-bottom:0px" ng-show="projectCtrl.featurestoreHdfsNsQuota() === -1">
                                    {{projectCtrl.featurestoreHdfsNsCount()}} files
                                  </span>
                                  <span style="margin-top: 40px; margin-left:10px; margin-bottom:0px" ng-show="projectCtrl.featurestoreHdfsNsQuota() !== -1">
                                    {{projectCtrl.featurestoreHdfsNsCount()}} files of {{projectCtrl.featurestoreHdfsNsQuota()}} used
                                  </span>
                                </fieldset>
                              </div>
                            </fieldset>

                            <fieldset>
                              <label class="text-muted">CPU</label>
                              <div class="row" style="margin-left:15px; margin-bottom:10px">
                                <fieldset ng-if="projectCtrl.yarnQuota() != null">
                                  <span style="margin-top: 40px; margin-left:10px; margin-bottom:0px" >
                                    {{projectCtrl.yarnQuota()}} CPU hours
                                  </span>
                                </fieldset>
                              </div>
                            </fieldset>

                            <fieldset>
                              <label class="text-muted" ng-show="projectCtrl.allServicesSelected()">Services</label>
                              <div class="control-group col-md-offset-1">
                                <div class="row" ng-repeat="projectType in projectCtrl.projectTypes">
                                  <md-checkbox class=" row md-primary" ng-click="projectCtrl.exists(projectType)">
                                    {{ projectType}}
                                  </md-checkbox>
                                </div>
                              </div>
                            </fieldset>
                            <div class="row" style="margin-left:15px; margin-bottom:0px">
                              <button class="btn btn-success" type="button"

                                      ng-disabled="projectCtrl.working"
                                      ng-click="projectCtrl.getCerts()">
                                Export Certificates
                              </button>
                              <i class="fa fa-info-circle" uib-tooltip="Click to download project's certificates. It allows communication with the project's services from outside Hospworks." style="margin-left: 10px; margin-bottom:0px"></i>
                            </div>
                          </div>

                        </div>
                      </div>
                    </div>
                  </div>
                  <button class="btn btn-primary" type="submit"
                          ng-disabled="projectCtrl.working">
                    <i ng-if="projectCtrl.working" style="margin-top: 2px" class="fa fa-spinner fa-spin pull-right" ></i>
                    Save
                  </button>

                </form>

                <div class="row">
                  <div class="col-md-12">
                    <div class="panel panel-danger"  style="width: 800px">
                      <div class="panel-heading">
                        Danger Zone
                      </div>
                      <div class="panel-body no-padding">
                        <div class="no-padding" ng-repeat="action in projectCtrl.projectDangerActions">
                          <div class="col-md-12 no-padding border-bottom">
                            <div class="col-md-9 no-padding">
                              <h2>
                                {{action.title}}
                              </h2>
                              {{action.description}}
                            </div>
                            <div class="col-md-3 no-padding" style="margin-top:25px">
                              <button class="btn btn-danger"
                                      ng-click="projectCtrl.handleProjectDangerActions(action.action)">
                                {{action.title}}
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </uib-tab>
              <uib-tab index="1" heading="Default Job Configuration">
                <h2>Default job configuration</h2>
                <div class="panel panel-default">
                  <div class="panel-body">
                    <h5>Set a default Job Configuration for all new Jobs. The Python and Spark configuration may also be imported in your Jupyter settings.</h5>
                    <div ng-include="'views/newJob.html'"></div>
                  </div>
                </div>
              </uib-tab>
              <uib-tab index="2" heading="Versions">
                <h3>Hopsworks Software Versions</h3>
                <table st-table="rowCollection" class="table table-striped" ng-show="projectSettingsCtrl.versions.length > 0">
                  <thead>
                    <tr>
                      <th class="col-sm-3">Software</th>
                      <th class="col-sm-9">Version</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr ng-repeat="version in projectSettingsCtrl.versions" class="row">
                      <td class="col-sm-3 pull-left">
                        <div style="margin-left: 10px;"><b>{{version.software}}</b></div>
                      </td>                
                      <td class="col-sm-9">
                        <div style="margin-left: 10px;"><b>{{version.version}}</b></div>
                      </td>                
                    </tr>
                  </tbody>
                </table>
              </uib-tab>
              <uib-tab index="3" heading="Provenance">
                <h3>Hopsworks Provenance Settings</h3>
                <div class="panel panel-default"  style="width: 800px; background-color: #F7F7F7;" ng-controller="ProvenanceCtrl as provenanceCtrl">
                  <div class="panel-body">
                    <div id="projectProvenance">
                      <div class="control-group col-md-offset-1">
                        <fieldset>
                          <table st-table="rowCollection" class="table table-striped">
                            <thead>
                            <tr>
                              <th style="width:20%">None/Meta/Min/Full</th>
                              <th></th>
                            </tr>
                            <tr>
                                <th style="width:20%">
                                  <div style="margin-bottom: 10px;">
                                    <md-radio-group ng-model="provenanceCtrl.projectProvenanceStatus"
                                                    class="md-primary pull-right" layout="row">
                                      <md-radio-button ng-repeat="m in provenanceCtrl.provStatus" ng-value="m.id"
                                                       uib-tooltip="{{m.label}}" aria-label="{{m.label}}"
                                                       ng-disabled="true"/>
                                    </md-radio-group>
                                  </div>
                                </th>
                              <th style="width:80%">Project Provenance Status</th>
                            </tr>
                          </table>
                        </fieldset>
                        <fieldset>
                          <table st-table="rowCollection" class="table table-striped"
                                 ng-show="provenanceCtrl.datasetsProvenanceStatus.length > 0">
                            <thead>
                            <tr>
                              <th></th>
                              <th style="width:80%">Datasets</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr ng-repeat="dataset in provenanceCtrl.datasetsProvenanceStatus">
                              <td>
                                <div style="margin-top: 10px;">
                                  <md-radio-group ng-model="dataset.status" class="md-primary pull-right"
                                                  layout="row" layout-align="start center">
                                    <md-radio-button ng-repeat="m in provenanceCtrl.provStatus" ng-value="m.id"
                                                     uib-tooltip="{{m.label}}" ng-disabled="true"
                                                     aria-label="{{m.id}}"/>
                                  </md-radio-group>
                                </div>
                              </td>
                              <td><b>{{dataset.name}}</b></td>
                            </tr>
                            </tbody>
                          </table>
                        </fieldset>
                        <fieldset>
                          <table st-table="rowCollection" class="table table-striped">
                            <thead>
                            <tr>
                              <th style="width:30%">Tracked</th>
                              <th style="width:70%"></th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                              <td><b>FS Datasets</b></td>
                              <td><b>{{provenanceCtrl.provFSDatasetsSize}}</b></td>
                            </tr>
                            <tr>
                              <td><b>Experiments</b></td>
                              <td><b>{{provenanceCtrl.provExperimentsSize}}</b></td>
                            </tr>
                            <tr>
                              <td><b>Models</b></td>
                              <td><b>{{provenanceCtrl.provModelsSize}}</b></td>
                            </tr>
                            <tr>
                              <td><b>Training Datasets</b></td>
                              <td><b>{{provenanceCtrl.provTrainingDatasetsSize}}</b></td>
                            </tr>
                            </tbody>
                          </table>
                        </fieldset>
                      </div>
                    </div>
                  </div>
                </div>
              </uib-tab>
              <uib-tab index="4" heading="Project Alerts">
                <h3>Project alert settings </h3>
                <div class="row" ng-controller="AlertManagerCtrl as alertsCtrl">
                  <div class="col-sm-6">
                    <div class="panel panel-default" style="background-color: #F7F7F7;">
                      <div class="panel-heading">
                        Service Alerts
                      </div>
                      <div class="panel-body">
                        <div class="loader loader-sm" ng-show="alertsCtrl.loadingServiceAlerts" style="position: unset"></div>
                        <form name="alertForm" role="form" ng-submit="alertsCtrl.createServiceAlert()">
                          <div class="row" style="padding-bottom: 20px">
                          <div class="col-sm-2">
                            <label class="control-label">Service</label>
                            <select class="form-control has-feedback" id="sel1" ng-model="alertsCtrl.newAlert.service"
                                    required>
                              <option value="">--Select service--</option>
                              <option ng-repeat="service in alertsCtrl.values.service">{{service}}</option>
                            </select>
                          </div>
                          <div class="col-sm-3">
                            <label class="control-label">Status</label>
                            <select class="form-control has-feedback" id="sel2" ng-model="alertsCtrl.newAlert.status"
                                    required>
                              <option value="">--Select status--</option>
                              <option ng-repeat="status in alertsCtrl.values.status">{{status}}</option>
                            </select>
                          </div>
                          <div class="col-sm-2">
                            <label class="control-label">Severity</label>
                            <select class="form-control has-feedback" id="sel3" ng-model="alertsCtrl.newAlert.severity"
                                    required>
                              <option value="">--Select severity--</option>
                              <option ng-repeat="severity in alertsCtrl.values.severity">{{severity}}</option>
                            </select>
                          </div>
                          <div class="col-sm-3">
                            <label class="control-label">Receiver</label>
                            <select class="form-control has-feedback" id="sel5" ng-model="alertsCtrl.newAlert.receiver"
                                    required>
                              <option value="">--Select receiver--</option>
                              <option ng-repeat="receiver in alertsCtrl.receivers">{{receiver.name}}</option>
                            </select>
                          </div>
                          <div class="col-sm-2">
                            <label class="control-label">Action</label>
                            <button class="form-control btn btn-success" uib-tooltip="Create"
                                    type="submit">
                              <i class="fa fa-plus"></i> Create new
                            </button>
                          </div>
                        </div>
                        </form>
                        <div ng-show="alertsCtrl.serviceAlerts.length < 1"> No service alerts to show.</div>
                        <div ng-show="alertsCtrl.serviceAlerts.length > 0">
                          <table class="table table-bordered table-striped">
                            <thead>
                            <tr>
                              <th>Service</th>
                              <th>Status</th>
                              <th>Severity</th>
                              <th>Receiver</th>
                              <th>Created on</th>
                              <th class="text-center">Action</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr ng-repeat="serviceAlert in alertsCtrl.serviceAlerts">
                              <td>{{ serviceAlert.service }}</td>
                              <td>{{ serviceAlert.status }}</td>
                              <td>{{ serviceAlert.severity }}</td>
                              <td>{{ serviceAlert.receiver }}</td>
                              <td>{{ serviceAlert.created | date:'medium'}}</td>
                              <td class="text-center">
                                <button class="btn btn-danger" uib-tooltip="Delete"
                                        ng-click="alertsCtrl.deleteServiceAlert(serviceAlert)">
                                  <i class="fa fa-trash"></i>
                                </button>
                                <button class="btn btn-success" uib-tooltip="Test"
                                        ng-click="alertsCtrl.testServiceAlert(serviceAlert)">
                                  <i class="fa fa-paper-plane"></i>
                                </button>
                              </td>
                            </tr>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-sm-6">
                    <div class="panel panel-default" style="background-color: #F7F7F7;">
                      <div class="panel-heading">
                        Routes
                      </div>
                      <div class="panel-body">
                        <div class="row">
                          <div class="col-sm-6 border-right">
                            <h4>Create new</h4>
                            <form name="receiverForm" role="form" ng-submit="alertsCtrl.createRoute(receiverForm)">
                              <div class="form-group has-feedback">
                                <label class="text-muted">Receiver</label>
                                <select name="receiver" class="form-control" ng-model="alertsCtrl.newRoute.receiver" required>
                                  <option value="">--Select Receiver--</option>
                                  <option ng-repeat="receiver in alertsCtrl.receivers">{{receiver.name}}</option>
                                </select>
                                <label class="text-muted">Group Wait</label>
                                <input name="groupWait"
                                       placeholder="Group wait. ex. 30s"
                                       ng-model="alertsCtrl.newRoute.groupWait"
                                       class="form-control "
                                       type="text">
                                <label class="text-muted">Group Interval</label>
                                <input name="groupInterval"
                                       placeholder="Group wait. ex. 5m"
                                       ng-model="alertsCtrl.newRoute.groupInterval"
                                       class="form-control "
                                       type="text">
                                <label class="text-muted">Repeat Interval</label>
                                <input name="repeatInterval"
                                       placeholder="Repeat Interval. ex. 4h"
                                       ng-model="alertsCtrl.newRoute.repeatInterval"
                                       class="form-control "
                                       type="text">
                                <label class="text-muted">Group By</label>
                                <input name="groupBy"
                                       placeholder="Group By. Comma separated values. ex. type,project,alertname"
                                       ng-model="alertsCtrl.newRoute.groupBy"
                                       class="form-control "
                                       type="text">
                                <label class="text-muted">Continue</label>
                                <div class="checkbox c-checkbox">
                                  <label>
                                    <input name="continue" ng-model="alertsCtrl.newRoute.continue" type="checkbox">
                                    <span class="fa fa-check"></span>
                                  </label>
                                </div>
                                <label class="text-muted">Match</label>
                                <div data-ng-repeat="match in alertsCtrl.newRoute.match track by $index"
                                     style="padding-bottom: 5px">
                                  <div class="input-group">
                                    <input name="matchKeyVal" placeholder="Key=Value"
                                           value="{{match}}"
                                           ng-model="alertsCtrl.newRoute.match[$index]"
                                           class="form-control"
                                           type="text" required>
                                    <span class="input-group-btn">
                                      <button class="btn btn-danger fa fa-trash-o icon-resize-small"
                                              type="button"
                                              title="Delete"
                                              ng-click="alertsCtrl.newRoute.match.splice($index, 1)"></button>
                                    </span>
                                  </div>
                                </div>
                                <div>
                                  <button type="button"
                                          uib-tooltip="Add match"
                                          ng-click="alertsCtrl.newRoute.match.push('')"
                                          class="btn btn-sm btn-default btn-success control-label" style="margin-bottom:
                              10px">
                                    Add Match<i style="margin-left: 10px" class="glyphicon glyphicon-plus"></i>
                                  </button>
                                </div>
                                <label class="text-muted">Match regex</label>
                                <div data-ng-repeat="matchRe in alertsCtrl.newRoute.matchRe track by $index"
                                     style="padding-bottom: 5px">
                                  <div class="input-group">
                                    <input name="matchReKeyVal" placeholder="Key=Value"
                                           value="{{matchRe}}"
                                           ng-model="alertsCtrl.newRoute.matchRe[$index]"
                                           class="form-control"
                                           type="text" required>
                                    <span class="input-group-btn">
                                      <button class="btn btn-danger fa fa-trash-o icon-resize-small"
                                              type="button"
                                              title="Delete"
                                              ng-click="alertsCtrl.newRoute.matchRe.splice($index, 1)"></button>
                                    </span>
                                  </div>
                                </div>
                                <div>
                                  <button type="button"
                                          uib-tooltip="Add match regex"
                                          ng-click="alertsCtrl.newRoute.matchRe.push('')"
                                          class="btn btn-sm btn-default btn-success control-label" style="margin-bottom:10px">
                                    Add MatchRe<i style="margin-left: 10px" class="glyphicon glyphicon-plus"></i>
                                  </button>
                                </div>
                              </div>
                              <div class="row">
                                <div class="col-md-12">
                                  <button type="submit" class="btn btn-primary pull-right"
                                          data-ng-disabled="alertsCtrl.routeWorking">
                                    Create Route
                                  </button>
                                </div>
                              </div>
                            </form>
                          </div>
                          <div class="col-sm-6">
                            <h4>Existing routes</h4>
                            <div class="loader loader-sm" ng-show="alertsCtrl.loadingRoutes" style="position: unset"></div>
                            <div ng-show="alertsCtrl.routes.length < 1"> No routes to show.</div>
                            <div ng-show="alertsCtrl.routes.length > 0">

                              <div uib-accordion close-others="true">
                                <div uib-accordion-group class="panel-default"
                                     ng-repeat="route in alertsCtrl.routes track by $index"
                                     is-open="alertsCtrl.statusRoute[$index]">
                                  <uib-accordion-heading>
                                    <div class="hw-ellipsis">
                                      {{route.receiver}}
                                      <i class="pull-right glyphicon"
                                         ng-class="{'glyphicon-chevron-down': alertsCtrl.statusRoute[$index], 'glyphicon-chevron-right': !alertsCtrl.statusRoute[$index]}"></i>
                                    </div>
                                  </uib-accordion-heading>
                                  <div style="overflow-x: auto">
                                    <span ng-show="route.groupBy">Group By: {{route.groupBy}}<br></span>
                                    <span ng-show="route.groupWait">Group Wait: {{route.groupWait}}<br></span>
                                    <span ng-show="route.groupInterval">Group Interval: {{route.groupInterval}}<br></span>
                                    <span ng-show="route.repeatInterval">Repeat Interval: {{route.repeatInterval}}<br></span>
                                    <span ng-show="route.continue">Continue: {{route.continue}}<br></span>
                                    <span ng-show="route.match && route.match['entry'].length > 0">
                                        Match: <br>
                                        <span ng-repeat="match in route.match['entry']">
                                          &nbsp;&nbsp;{{match.key}}: {{match.value}} <br>
                                        </span>
                                    </span>
                                        <span ng-show="route.matchRe && route.matchRe['entry'].length > 0">
                                        MatchRe: <br>
                                        <span ng-repeat="matchRe in route.matchRe['entry']">
                                          &nbsp;&nbsp;{{matchRe.key}}: {{matchRe.value}} <br>
                                        </span>
                                    </span>
                                  </div>
                                  <div class="row">
                                    <button class="btn btn-danger pull-right" style="margin-right: 16px"
                                            ng-if="!alertsCtrl.isGlobalRoute(route)"
                                            data-ng-disabled="alertsCtrl.receiverWorking"
                                            ng-click="alertsCtrl.deleteRoute(route)">
                                      Delete
                                    </button>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-sm-6">
                    <div class="panel panel-default" style="background-color: #F7F7F7;">
                      <div class="panel-heading">
                        Receivers
                      </div>
                      <div class="panel-body">
                        <div class="row">
                          <div class="col-sm-4 border-right">
                            <h4>Create new</h4>
                            <form name="receiverForm" role="form" ng-submit="alertsCtrl.createReceiver(receiverForm)">
                              <div class="form-group has-feedback">
                                <label class="text-muted">Name</label>
                                <input name="receiverName"
                                       placeholder="Receiver"
                                       ng-model="alertsCtrl.newReceiver.name"
                                       class="form-control "
                                       type="text" required>
                                <div class="radio">
                                  <label class="radio text-muted"
                                         ng-repeat="receiverConfig in alertsCtrl.receiverConfigs track by $index">
                                    <input type="radio"
                                           ng-model="alertsCtrl.receiverConfig"
                                           ng-change="alertsCtrl.receiverConfigNewValue()"
                                           value="{{receiverConfig}}">
                                    {{receiverConfig}}
                                  </label>
                                </div>
                                <label class="text-muted">{{alertsCtrl.receiverConfig}}</label>
                                <textarea name="emailConfigs" class="form-control " style="resize: vertical;"
                                          placeholder="[{'to': 'admin@hopsworks.ai', 'html': ''}, {'to': 'admin@hopsworks.ai', 'html': ''}]"
                                          ng-if="alertsCtrl.receiverConfig === 'EmailConfigs'"
                                          ng-model="alertsCtrl.newReceiver.emailConfigs"
                                          ng-change="alertsCtrl.validateJSON(receiverForm.emailConfigs, alertsCtrl.newReceiver.emailConfigs)"
                                          required></textarea>
                                <textarea name="slackConfigs" class="form-control " style="resize: vertical;"
                                          placeholder="[{'apiUrl': 'https://hooks.slack.com/services/xxx', 'channel': '#general', 'iconUrl': 'https://gravatar.com/avatar/e3fb1c1d58b043af5e3a6a645b7f569f'}]"
                                          ng-if="alertsCtrl.receiverConfig === 'SlackConfigs'"
                                          ng-change="alertsCtrl.validateJSON(receiverForm.slackConfigs, alertsCtrl.newReceiver.slackConfigs)"
                                          ng-model="alertsCtrl.newReceiver.slackConfigs" required></textarea>
                                <textarea name="pagerdutyConfigs" class="form-control " style="resize: vertical;"
                                          placeholder="PagerdutyConfigs"
                                          ng-if="alertsCtrl.receiverConfig === 'PagerdutyConfigs'"
                                          ng-change="alertsCtrl.validateJSON(receiverForm.pagerdutyConfigs, alertsCtrl.newReceiver.pagerdutyConfigs)"
                                          ng-model="alertsCtrl.newReceiver.pagerdutyConfigs" required></textarea>
                                <textarea name="pushoverConfigs" class="form-control " style="resize: vertical;"
                                          placeholder="PushoverConfigs"
                                          ng-if="alertsCtrl.receiverConfig === 'PushoverConfigs'"
                                          ng-change="alertsCtrl.validateJSON(receiverForm.pushoverConfigs, alertsCtrl.newReceiver.pushoverConfigs)"
                                          ng-model="alertsCtrl.newReceiver.pushoverConfigs" required></textarea>
                                <textarea name="opsgenieConfigs" class="form-control " style="resize: vertical;"
                                          placeholder="OpsgenieConfigs"
                                          ng-if="alertsCtrl.receiverConfig === 'OpsgenieConfigs'"
                                          ng-change="alertsCtrl.validateJSON(receiverForm.opsgenieConfigs, alertsCtrl.newReceiver.opsgenieConfigs)"
                                          ng-model="alertsCtrl.newReceiver.opsgenieConfigs" required></textarea>
                                <textarea name="webhookConfigs" class="form-control " style="resize: vertical;"
                                          placeholder="WebhookConfigs"
                                          ng-if="alertsCtrl.receiverConfig === 'WebhookConfigs'"
                                          ng-change="alertsCtrl.validateJSON(receiverForm.webhookConfigs, alertsCtrl.newReceiver.webhookConfigs)"
                                          ng-model="alertsCtrl.newReceiver.webhookConfigs" required></textarea>
                                <textarea name="victoropsConfigs" class="form-control " style="resize: vertical;"
                                          placeholder="VictoropsConfigs"
                                          ng-if="alertsCtrl.receiverConfig === 'VictoropsConfigs'"
                                          ng-change="alertsCtrl.validateJSON(receiverForm.victoropsConfigs, alertsCtrl.newReceiver.victoropsConfigs)"
                                          ng-model="alertsCtrl.newReceiver.victoropsConfigs" required></textarea>
                                <textarea name="wechatConfigs" class="form-control " style="resize: vertical;"
                                          placeholder="WechatConfigs"
                                          ng-if="alertsCtrl.receiverConfig === 'WechatConfigs'"
                                          ng-change="alertsCtrl.validateJSON(receiverForm.wechatConfigs, alertsCtrl.newReceiver.wechatConfigs)"
                                          ng-model="alertsCtrl.newReceiver.wechatConfigs" required></textarea>
                              </div>
                              <div class="row">
                                <div class="col-md-12">
                                  <button type="submit" class="btn btn-primary pull-right"
                                          ng-disabled="!receiverForm.$valid"
                                          data-ng-disabled="alertsCtrl.receiverWorking">
                                    Create Receiver
                                  </button>
                                </div>
                              </div>
                            </form>
                          </div>
                          <div class="col-sm-8">
                            <h4>Existing receivers</h4>
                            <div class="loader loader-sm" ng-show="alertsCtrl.loadingReceivers" style="position: unset"></div>
                            <div ng-show="alertsCtrl.receivers.length < 1"> No receivers to show.</div>
                            <div ng-show="alertsCtrl.receivers.length > 0">
                              <div uib-accordion close-others="true" >
                                <div uib-accordion-group class="panel-default"
                                     ng-repeat="receiver in alertsCtrl.receivers"
                                     is-open="alertsCtrl.statusReceiver[receiver.name]">
                                  <uib-accordion-heading>
                                    <div ng-click="alertsCtrl.opened(receiver.name)" class="hw-ellipsis">
                                      {{receiver.name}}
                                      <i class="pull-right glyphicon"
                                         ng-class="{'glyphicon-chevron-down': alertsCtrl.statusReceiver[receiver.name], 'glyphicon-chevron-right': !alertsCtrl.statusReceiver[receiver.name]}"></i>
                                    </div>
                                  </uib-accordion-heading>
                                  <md-input-container class="md-block">
                                    <div class="loader loader-sm" ng-show="alertsCtrl.loadingReceiver" style="position: unset"></div>
                                    <div ng-show="alertsCtrl.receiver.emailConfigs">
                                      <label>Email Configs:</label><br/>
                                      <pre><code>{{alertsCtrl.showReceiverValue(alertsCtrl.receiver.emailConfigs)}}</code></pre>
                                    </div>
                                    <div ng-show="alertsCtrl.receiver.slackConfigs">
                                      <label>Slack Configs:</label><br/>
                                      <pre><code>{{alertsCtrl.showReceiverValue(alertsCtrl.receiver.slackConfigs)}}</code></pre>
                                    </div>
                                    <div ng-show="alertsCtrl.receiver.pagerdutyConfigs">
                                      <label>Pagerduty Configs:</label><br/>
                                      <pre><code>{{alertsCtrl.showReceiverValue(alertsCtrl.receiver.pagerdutyConfigs)}}</code></pre>
                                    </div>
                                    <div ng-show="alertsCtrl.receiver.pushoverConfigs">
                                      <label>Pushover Configs:</label><br/>
                                      <pre><code>{{alertsCtrl.showReceiverValue(alertsCtrl.receiver.pushoverConfigs)}}</code></pre>
                                    </div>
                                    <div ng-show="alertsCtrl.receiver.opsgenieConfigs">
                                      <label>Opsgenie Configs:</label><br/>
                                      <pre><code>{{alertsCtrl.showReceiverValue(alertsCtrl.receiver.opsgenieConfigs)}}</code></pre>
                                    </div>
                                    <div ng-show="alertsCtrl.receiver.webhookConfigs">
                                      <label>Webhook Configs:</label><br/>
                                      <pre><code>{{alertsCtrl.showReceiverValue(alertsCtrl.receiver.webhookConfigs)}}</code></pre>
                                    </div>
                                    <div ng-show="alertsCtrl.receiver.victoropsConfigs">
                                      <label>Victorops Configs:</label><br/>
                                      <pre><code>{{alertsCtrl.showReceiverValue(alertsCtrl.receiver.victoropsConfigs)}}</code></pre>
                                    </div>
                                    <div ng-show="alertsCtrl.receiver.wechatConfigs">
                                      <label>WechatConfigs:</label><br/>
                                      <pre><code>{{alertsCtrl.showReceiverValue(alertsCtrl.receiver.wechatConfigs)}}</code></pre>
                                    </div>
                                  </md-input-container>
                                  <div class="row">
                                    <button class="btn btn-danger pull-right" style="margin-right: 16px"
                                            data-ng-disabled="alertsCtrl.receiverWorking"
                                            ng-if="!alertsCtrl.isGlobalReceiver(receiver)"
                                            ng-click="alertsCtrl.deleteReceiver(receiver.name)">
                                      Delete
                                    </button>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-sm-6">
                    <div class="panel panel-default" style="background-color: #F7F7F7;">
                      <div class="panel-heading">
                        Silence
                      </div>
                      <div class="panel-body">
                        <div class="row">
                          <div class="col-sm-6  border-right">
                            <h4>Create new</h4>
                            <form name="silenceForm" role="form" ng-submit="alertsCtrl.createSilence(silenceForm)">
                              <div class="form-group has-feedback">
                                <label class="text-muted">Comment</label>
                                <input name="newSilence"
                                       placeholder="Comment"
                                       ng-model="alertsCtrl.newSilence.comment"
                                       class="form-control "
                                       type="text" required>
                                <br/>
                                <div class="row">
                                  <div class="col-sm-6">
                                    <label class="control-label text-muted">Starts At</label>
                                    <div class='input-group date'>
                                      <input id="startsAt" type="text" hw-date-picker
                                             ng-model="alertsCtrl.newSilence.startsAt"
                                             data-format="YYYY-MM-DD HH:mm"
                                             class="form-control" required>
                                          <span class="input-group-addon">
                                            <span class="glyphicon glyphicon-calendar"></span>
                                          </span>
                                    </div>
                                  </div>
                                  <div class="col-sm-6">
                                    <label class="control-label text-muted">Ends At</label>
                                    <div class='input-group date'>
                                      <input id="endsAt" type="text" hw-date-picker
                                             ng-model="alertsCtrl.newSilence.endsAt"
                                             data-format="YYYY-MM-DD HH:mm"
                                             class="form-control" required>
                                      <span class="input-group-addon">
                                        <span class="glyphicon glyphicon-calendar"></span>
                                      </span>
                                    </div>
                                  </div>
                                </div>
                                <br/>
                                <label class="text-muted">Matchers</label>
                                <div data-ng-repeat="matcher in alertsCtrl.newSilence.matchers track by $index"
                                     style="padding-bottom: 5px">
                                  <label class="text-muted">Is regex</label>
                                  <div class="checkbox c-checkbox">
                                    <label>
                                      <input name="continue" ng-model="matcher.isRegex" type="checkbox">
                                      <span class="fa fa-check"></span>
                                    </label>
                                  </div>
                                  <label class="text-muted">Name</label>
                                  <input name="matcher" placeholder="Matcher name" ng-model="matcher.name"
                                         class="form-control"
                                         type="text" required>
                                  <label class="text-muted">Value</label>
                                  <input name="matcher" placeholder="Matcher value" ng-model="matcher.value"
                                         class="form-control"
                                         type="text" required>
                                  <br/>
                                  <button class="btn btn-danger fa fa-trash-o"
                                          ng-show="$index > 0"
                                          type="button"
                                          title="Delete"
                                          ng-click="alertsCtrl.newSilence.matchers.splice($index, 1)"></button>
                                  <hr/>
                                </div>
                                <br/>
                                <div>
                                  <button type="button"
                                          uib-tooltip="Add match"
                                          ng-click="alertsCtrl.newSilence.matchers.push({isRegex: false, name: undefined, value: undefined})"
                                          class="btn btn-sm btn-default btn-success control-label" style="margin-bottom:
                              10px">
                                    Add Matcher<i style="margin-left: 10px" class="glyphicon glyphicon-plus"></i>
                                  </button>
                                </div>
                              </div>
                              <div class="row">
                                <div class="col-md-12">
                                  <button type="submit" class="btn btn-primary pull-right"
                                          data-ng-disabled="alertsCtrl.silenceWorking">
                                    Create Silence
                                  </button>
                                </div>
                              </div>
                            </form>
                          </div>
                          <div class="col-sm-6">
                            <h4>Existing silence</h4>
                            <div class="loader loader-sm" ng-show="alertsCtrl.loadingSilences" style="position: unset"></div>
                            <div ng-show="alertsCtrl.silences.length < 1"> No silences to show.</div>
                            <div ng-show="alertsCtrl.silences.length > 0">
                              <div uib-accordion close-others="true">
                                <div uib-accordion-group class="panel-default"
                                     ng-repeat="silence in alertsCtrl.silences"
                                     is-open="alertsCtrl.statusSilences[silence.id]">
                                  <uib-accordion-heading>
                                    <div class="hw-ellipsis">
                                      {{silence.id}} {{silence.comment}}
                                      <i class="pull-right glyphicon"
                                         ng-class="{'glyphicon-chevron-down': alertsCtrl.statusSilences[silence.id], 'glyphicon-chevron-right': !alertsCtrl.statusSilences[silence.id]}"></i>
                                    </div>
                                  </uib-accordion-heading>
                                  <div style="overflow-x: auto">
                                    <span ng-show="silence.comment">Comment: {{silence.comment}}<br></span>
                                    <span ng-show="silence.status">Status: {{silence.status.state}}<br></span>
                                    <span ng-show="silence.createdBy">Created By: {{silence.createdBy}}<br></span>
                                    <span ng-show="silence.updatedAt">UpdatedAt: {{silence.updatedAt | date:'medium'}}<br></span>
                                    <span ng-show="silence.startsAt">StartsAt: {{silence.startsAt | date:'medium'}}<br></span>
                                    <span ng-show="silence.endsAt">EndsAt: {{silence.endsAt | date:'medium'}}<br></span>
                                    <span ng-show="silence.matchers.length > 0">
                                      Matchers: <br>
                                      <span ng-repeat="matcher in silence.matchers">
                                        &nbsp;&nbsp;{{matcher.name}}: {{matcher.value}} <br>
                                      </span>
                                    </span>
                                  </div>
                                  <div class="row">
                                    <button class="btn btn-danger pull-right" style="margin-right: 16px"
                                            data-ng-disabled="alertsCtrl.receiverWorking"
                                            ng-if="silence.status.state !== 'expired'"
                                            ng-click="alertsCtrl.deleteSilence(silence.id)">
                                      Delete
                                    </button>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-sm-6">
                    <div class="panel panel-default" style="background-color: #F7F7F7;">
                      <div class="panel-heading">
                        Active alerts
                      </div>
                      <div class="panel-body">
                        <div class="loader loader-sm" ng-show="alertsCtrl.loadingAlerts" style="position: unset"></div>
                        <div ng-show="alertsCtrl.alerts.length < 1"> No active alerts to show.</div>
                        <div ng-show="alertsCtrl.alerts.length > 0">
                          <div uib-accordion close-others="true">
                            <div uib-accordion-group class="panel-default"
                                 ng-repeat="alert in alertsCtrl.alerts"
                                 is-open="alertsCtrl.statusAlerts[alert.fingerprint]">
                              <uib-accordion-heading>
                                <div>
                                  {{alert.fingerprint}}
                                  <i class="pull-right glyphicon"
                                     ng-class="{'glyphicon-chevron-down': alertsCtrl.statusAlerts[alert.fingerprint], 'glyphicon-chevron-right': !alertsCtrl.statusAlerts[alert.fingerprint]}"></i>
                                </div>
                              </uib-accordion-heading>
                              <div class="alert alert-warning"
                                   ng-show="!alertsCtrl.validReceiver(alert.receivers)">
                                <strong>Warning!</strong> There are no valid receivers found for this alert.
                              </div>
                              <div style="overflow-x: auto">
                                <span ng-show="alert.status">
                                    <span ng-show="alert.status">
                                      <strong>Status:</strong> {{alert.status.state}}<br></span>
                                    <span ng-show="alert.status.inhibitedBy.length > 0">
                                      <strong>InhibitedBy:</strong> {{alert.status.inhibitedBy}}<br></span>
                                    <span ng-show="alert.status.silencedBy.length > 0">
                                      <strong>SilencedBy:</strong> {{alert.status.silencedBy}}<br></span>
                                </span>
                                <span ng-show="alert.updatedAt"><strong>UpdatedAt:</strong> {{alert.updatedAt | date:'medium'}}<br></span>
                                <span ng-show="alert.startsAt"><strong>StartsAt:</strong> {{alert.startsAt | date:'medium'}}<br></span>
                                <span ng-show="alert.endsAt"><strong>EndsAt:</strong> {{alert.endsAt | date:'medium'}}<br></span>
                                <span ng-show="alert.generatorURL"><strong>GeneratorURL:</strong> {{alert.generatorURL}}<br></span>
                                <span ng-show="alert.receivers"><strong>Receivers:</strong> {{alert.receivers}}<br></span>
                                <span ng-show="alert.labels['entry'].length > 0">
                                      <strong>Labels:</strong> <br>
                                      <span ng-repeat="label in alert.labels['entry']">
                                        &nbsp;&nbsp;{{label.key}}:{{label.value}} <br>
                                      </span>
                                </span>
                                <span ng-show="alert.annotations['entry'].length > 0">
                                      <strong>Annotations:</strong> <br>
                                      <span ng-repeat="annotation in alert.annotations['entry']">
                                        &nbsp;&nbsp;{{annotation.key}}:{{annotation.value}}<br>
                                      </span>
                                </span>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </uib-tab>
              <uib-tab index="5" heading="Cloud Roles"
                     ng-if="projectSettingsCtrl.cloudRoleMappings != undefined && projectSettingsCtrl.cloudRoleMappings.length > 0">
                <h3>Cloud Roles accessible from this project</h3>
                <div class="panel panel-default" style="width: 800px; background-color: #F7F7F7;">
                  <div class="panel-body">
                      <div ng-repeat="mapping in projectSettingsCtrl.cloudRoleMappings"
                           ng-style="projectSettingsCtrl.cloudRoleMappings.length > 1 && {'border-bottom' : 'solid #eee 5px'}">
                        <div class="input-group" style="width: 100%">
                          <md-switch id="faultTolerance" class="md-primary pull-right"
                                     aria-label="Fault-tolerant"
                                     style="margin: 0px"
                                     ng-disabled="projectSettingsCtrl.setDefaultWorking"
                                     ng-model="mapping.defaultRole"
                                     ng-change="projectSettingsCtrl.setDefault(mapping)">
                            <md-tooltip ng-if="mapping.defaultRole" md-direction="right">
                              Used as default role when calling the assume role end-point
                            </md-tooltip>
                            <md-tooltip ng-if="!mapping.defaultRole" md-direction="right">Make the default role
                              for {{mapping.projectRole}} {{mapping.projectRole === 'ALL'? ' project roles.': '.'}}
                            </md-tooltip>
                            Default
                          </md-switch>
                        </div>
                        <div class="input-group" style="margin-bottom: 5px; margin-top: 10px">
                          <span class="input-group-addon" id="role_id" style="padding-right: 43px;">Role id</span>
                          <input type="text" class="form-control" placeholder="Role id"
                                 aria-describedby="project-role" value="{{mapping.id}}" readonly>
                        </div>
                        <div class="input-group" style="margin-bottom: 5px">
                          <span class="input-group-addon" id="project-role">Project Role</span>
                          <input type="text" class="form-control" placeholder="Project Role"
                                 aria-describedby="project-role" value="{{mapping.projectRole}}" readonly>
                        </div>
                        <div class="input-group" style="margin-bottom: 10px">
                          <span class="input-group-addon" style="padding-right: 20px;">Cloud Role</span>
                          <input id="fileRef" type="text" class="form-control" aria-label="Cloud role"
                                 value="{{mapping.cloudRole}}" readonly>
                          <botton class="btn btn-default input-group-addon"
                                  ngclipboard data-clipboard-target="#fileRef"
                                  ngclipboard-success="projectSettingsCtrl.onSuccess(e);"
                                  title="Copy role"><i class="fa fa-copy"></i></botton>
                        </div>
                      </div>
                    </div>
                  </div>

              </uib-tab>
            </uib-tabset>
          </div>
        </div>
      </section>
    </div>
  </div>
</div>
