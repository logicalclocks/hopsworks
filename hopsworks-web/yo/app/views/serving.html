<!--
  ~ This file is part of Hopsworks
  ~ Copyright (C) 2022, Logical Clocks AB. All rights reserved
  ~
  ~ Hopsworks is free software: you can redistribute it and/or modify it under the terms of
  ~ the GNU Affero General Public License as published by the Free Software Foundation,
  ~ either version 3 of the License, or (at your option) any later version.
  ~
  ~ Hopsworks is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
  ~ without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
  ~ PURPOSE.  See the GNU Affero General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License along with this program.
  ~ If not, see <https://www.gnu.org/licenses/>.
  -->

<div ng-controller="MainCtrl as mainCtrl">
    <div ng-include="'nav.html'"></div>
    <div id="wrapper" ng-class="{'toggled': projectCtrl.isClosed}" ng-controller="servingCtrl as servingCtrl">
        <div class="overlay"></div>
        <div ng-include="'navProject.html'"></div>

        <div ng-if="mainCtrl.showSearchPage" class="content-wrapper">
            <div id="projectSearchResults">
                <div ng-include="'views/search/search.html'"></div>
            </div>
        </div>
        <div ng-if="!mainCtrl.showSearchPage" class="content-wrapper">
            <h3 id="projectBread" style="border-bottom: none"></h3>
            <div ng-show="servingCtrl.activeTab === 'serving'" layout-align="center center">

                <div class="" ng-if="servingCtrl.showLogs === false">
                    <!-- Page Content -->
                    <div ng-if="servingCtrl.showCreateNewServingForm === true">
                        <form class="form-horizontal" name="servingCtrl.servingConfigForm">
                            <div class="col-xs-10 col-sm-10 col-md-10 col-lg-10" layout-align="left left"
                                 style='margin-left: 0px;'>

                                <div class="row">
                                    <div class="col-xs-9 col-sm-9 col-md-9 col-lg-8">
                                        <button class="close" ng-click="servingCtrl.hideCreateServingForm()"
                                                type="button">
                                            <span aria-hidden="true">&times;</span></button>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3"></div>
                                    <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                                        <md-radio-group ng-model="servingCtrl.editServing.modelServer">
                                            <table class="button-table">
                                                <tbody>
                                                <tr>
                                                    <td>
                                                        <md-radio-button value="TENSORFLOW_SERVING" class="md-primary"
                                                                         ng-click="servingCtrl.setModelServer(servingCtrl.modelServerTensorflow);">
                                                            TensorFlow
                                                        </md-radio-button>
                                                    </td>
                                                    <td>
                                                        <md-radio-button value="PYTHON" class="md-primary"
                                                                         style="display: inline-block"
                                                                         ng-click="servingCtrl.setModelServer(servingCtrl.modelServerPython);">
                                                            Python (SkLearn, XGBoost, ...)
                                                            <i class="fa fa-info-circle" style="pointer-events: all"
                                                               tooltip-placement="auto left"
                                                               tooltip-append-to-body="true"
                                                               uib-tooltip='Python server that exposes a model using an user-provided python script'
                                                               style="margin-left: 10px"></i>
                                                        </md-radio-button>
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </md-radio-group>
                                    </div>
                                </div>

                                <!-- Minimum settings -->
                                <div class="row">
                                    <!-- Labels -->
                                    <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3" style="text-align: right;">
                                        <div style="margin-top: 12px;"><label>Serving Name</label></div>
                                        <div style="margin-top: 12px;">
                                            <label>Model</label>
                                            <i class="fa fa-info-circle" tooltip-placement="auto bottom"
                                               uib-tooltip='Select a model directory. The correct directory structure can be found in the documentation'
                                               style="margin-left: 5px"></i>
                                        </div>
                                        <div style="margin-top: 12px;">
                                            <label>Model Version</label>
                                            <i class="fa fa-info-circle" tooltip-placement="auto bottom"
                                               uib-tooltip='Model files are shared across artifacts of the same model version.'
                                               style="margin-left: 10px"></i>
                                        </div>
                                        <div style="margin-top: 12px;">
                                            <label>Artifact Version</label>
                                            <i class="fa fa-info-circle" tooltip-placement="auto bottom"
                                               uib-tooltip='Artifacts contain all necessary files to serve an inference pipeline including model files, transformer script or conda environment.'
                                               style="margin-left: 10px"></i>
                                        </div>
                                        <div style="margin-top: 12px;">
                                            <label>KFServing</label>
                                            <i class="fa fa-info-circle" tooltip-placement="auto bottom"
                                               uib-tooltip='Deploy a model with KFServing to leverage additional features such as scale-to-zero or online input transformations.'
                                               style="margin-left: 10px"></i>
                                        </div>
                                        <div style="margin-top: 12px;"
                                             ng-if="servingCtrl.editServing.modelServer === servingCtrl.modelServerPython">
                                            <label>Predictor</label>
                                            <i class="fa fa-info-circle" tooltip-placement="auto bottom"
                                               uib-tooltip='Select a python script that implements the Predict class and the predict(inputs) function.'
                                               style="margin-left: 5px"></i>
                                        </div>
                                        <div style="margin-top: 12px;">
                                            <label>Transformer</label>
                                            <i class="fa fa-info-circle" tooltip-placement="auto bottom"
                                               uib-tooltip='Select a python script that implements the Transformer class and the preprocess(inputs) and/or postprocess(outputs) functions.'
                                               style="margin-left: 5px"></i>
                                        </div>
                                        <div style="margin-top: 18px;">
                                            <label ng-click="servingCtrl.showAdvanced()">
                                            <span class="glyphicon glyphicon-chevron-right"
                                                  ng-if="!servingCtrl.showAdvancedForm"></span>
                                                <span class="glyphicon glyphicon-chevron-down"
                                                      ng-if="servingCtrl.showAdvancedForm"></span>
                                                Advanced
                                            </label>
                                        </div>
                                    </div>

                                    <!-- Controls -->
                                    <div class="col-xs-6 col-sm-6 col-md-6 col-lg-5">
                                        <!-- Serving name -->
                                        <input style="margin-top: 6px" name="name" class="form-control" type="text"
                                               ng-model="servingCtrl.editServing.name">
                                        <!-- Model name -->
                                        <div>
                                            <div class="col-xs-8 col-sm-8 col-md-9 col-lg-10" style="padding: 0">
                                                <ui-select tagging tagging="tagTransform"
                                                           ng-model="servingCtrl.editServing.modelName"
                                                           style="margin-top:5px;" class="ui-select-height-auto" theme="bootstrap"
                                                           title="Search for servable models"
                                                           on-select="servingCtrl.setFullModelPath()">
                                                    <ui-select-match placeholder="Enter model name...">
                                                        {{servingCtrl.editServing.modelName}}
                                                    </ui-select-match>
                                                    <ui-select-choices
                                                            refresh="servingCtrl.fetchAsync($select.search)"
                                                            refresh-delay="200"
                                                            repeat="model in servingCtrl.models">
                                                        <div>
                                                            <span ng-bind-html="model"></span>
                                                        </div>
                                                    </ui-select-choices>
                                                    <ui-select-no-choice>
                                                        <div>
                                                                <span ng-if="servingCtrl.loadingModels"
                                                                      class="loading-dots-sm" style="padding-left:5px;"> Searching</span>
                                                            <span ng-if="!servingCtrl.loadingModels"
                                                                  style="padding-left:5px;">{{servingCtrl.selectNoChoice}}</span>
                                                        </div>
                                                    </ui-select-no-choice>
                                                </ui-select>
                                            </div>
                                            <div class="col-xs-4 col-sm-4 col-md-3 col-lg-2"
                                                 style="padding: 0 0 0 5px;">
                                                <div>
                                                    <label style="width: 100%;">
                                                        <button style="margin-top: 5px; width: 100%"
                                                                class="btn btn-default"
                                                                ng-click="servingCtrl.selectFile('model')">
                                                            <span>Browse</span>
                                                        </button>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- Model version -->
                                        <select class="form-control" style="margin-top: 5px; width: 30%"
                                                name="modelVersion"
                                                ng-model="servingCtrl.editServing.modelVersion"
                                                ng-options="x for x in servingCtrl.modelVersions"
                                                ng-change="servingCtrl.setModelVersion(servingCtrl.editServing.modelVersion)"></select>
                                        <!-- Artifact version -->
                                        <select class="form-control" style="margin-top: 5px; width: 30%"
                                                name="artifactVersion"
                                                ng-model="servingCtrl.artifactVersion"
                                                ng-options="x.value for x in servingCtrl.artifactVersions"
                                                ng-disabled="!servingCtrl.isKubernetes"
                                                ng-change="servingCtrl.setArtifactVersion(servingCtrl.artifactVersion)"></select>
                                        <!-- KFServing -->
                                        <div>
                                            <md-checkbox style="margin-top: 7px; margin-bottom: 13px;"
                                                         class="md-primary"
                                                         name="kfserving"
                                                         ng-model="servingCtrl.kfserving"
                                                         ng-disabled="!servingCtrl.isKFServing"
                                                         ng-change="servingCtrl.setKFServing(servingCtrl.kfserving)">
                                                <span style="color: darkred"
                                                      ng-show="servingCtrl.kfserving && servingCtrl.editServing.modelServer === servingCtrl.modelServerPython && !servingCtrl.editServing.predictor">
                                                    Sklearn models only
                                                </span>
                                            </md-checkbox>
                                        </div>
                                        <!-- Predictor -->
                                        <div ng-if="servingCtrl.editServing.modelServer === servingCtrl.modelServerPython">
                                            <div class="col-xs-8 col-sm-8 col-md-9 col-lg-10"
                                                 style="padding: 0">
                                                <input type="text" class="form-control"
                                                       ng-model="servingCtrl.editServing.predictor"
                                                       ng-disabled="servingCtrl.editServing.modelServer === servingCtrl.modelServerTensorflow"
                                                       ng-change="servingCtrl.setPredictor(servingCtrl.editServing.predictor)">
                                            </div>
                                            <div class="col-xs-4 col-sm-4 col-md-3 col-lg-2"
                                                 style="padding: 0 0 0 5px">
                                                <label style="width: 100%">
                                                    <button class="btn btn-default"
                                                            ng-click="servingCtrl.selectFile('predictor')"
                                                            ng-disabled="servingCtrl.editServing.modelServer === servingCtrl.modelServerTensorflow"
                                                            style="width: 100%;">
                                                        <span>Browse</span>
                                                    </button>
                                                </label>
                                            </div>
                                        </div>
                                        <!-- Transformer -->
                                        <div>
                                            <div class="col-xs-8 col-sm-8 col-md-9 col-lg-10"
                                                 style="padding: 0">
                                                <input type="text" class="form-control"
                                                       ng-model="servingCtrl.editServing.transformer"
                                                       ng-disabled="!servingCtrl.kfserving"
                                                       ng-change="servingCtrl.setTransformer(servingCtrl.editServing.transformer)">
                                            </div>
                                            <div class="col-xs-4 col-sm-4 col-md-3 col-lg-2"
                                                 style="padding: 0 0 0 5px">
                                                <label style="width: 100%">
                                                    <button class="btn btn-default"
                                                            ng-click="servingCtrl.selectFile('transformer')"
                                                            ng-disabled="!servingCtrl.kfserving"
                                                            style="width: 100%;">
                                                        <span>Browse</span>
                                                    </button>
                                                </label>
                                            </div>
                                        </div>
                                        <hr>
                                    </div>
                                </div>

                                <!-- Advanced settings -->
                                <div ng-if="servingCtrl.showAdvancedForm" class="animate-if">
                                    <div class="row">
                                        <!-- Labels -->
                                        <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3" style="text-align: right;">
                                            <div style="margin-top: 12px;">
                                                <label>Predictor instances</label>
                                                <i class="fa fa-info-circle" tooltip-placement="auto bottom"
                                                   uib-tooltip='Number of replicas for the model server. It refers to the exact number of replicas
                                               for default servings or minimum number of replicas for KFServing deployments.'
                                                   style="margin-left: 10px"></i>
                                            </div>
                                            <div style="margin-top: 30px;">
                                                <label>Transformer instances</label>
                                                <i class="fa fa-info-circle" tooltip-placement="auto bottom"
                                                   uib-tooltip='Minimum number of replicas for the transformer in KFServing deployments.'
                                                   style="margin-left: 10px"></i>
                                            </div>
                                            <div style="margin-top: 22px;"><label>Request Batching</label></div>
                                            <div style="margin-top: 12px;"><label>Kafka Topic</label></div>
                                            <div style="margin-top: 12px;"><label>Kafka Num Partitions</label></div>
                                            <div style="margin-top: 12px;"><label>Kafka Replication Factor</label>
                                            </div>
                                            <div style="margin-top: 30px;">
                                                <label>Inference logging</label>
                                                <i class="fa fa-info-circle" tooltip-placement="auto bottom"
                                                   uib-tooltip='Select the inference data to log into the Kafka topic.'
                                                   style="margin-left: 10px"></i>
                                            </div>
                                            <div style="margin-top: 21px; heigth: 2em;"
                                                 ng-show="servingCtrl.hasDockerMemory"><label>Memory</label></div>
                                            <div style="margin-top: 14px; heigth: 2em;"
                                                 ng-show="servingCtrl.hasDockerCores"><label>Virtual cores</label>
                                            </div>
                                            <div style="margin-top: 12px; heigth: 2em;"
                                                 ng-show="servingCtrl.hasDockerGpus"><label>GPUs</label></div>
                                        </div>
                                        <!-- Controls -->
                                        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                                            <!-- Predictor instances -->
                                            <rzslider style="margin-top: 22px;"
                                                      rz-slider-model="servingCtrl.predictorSliderOptions.value"
                                                      rz-slider-options="servingCtrl.predictorSliderOptions.options">
                                            </rzslider>
                                            <!-- Transformer instances -->
                                            <rzslider style="margin-top: 38px;"
                                                      rz-slider-model="servingCtrl.transformerSliderOptions.value"
                                                      rz-slider-options="servingCtrl.transformerSliderOptions.options">
                                            </rzslider>
                                            <!-- Request batching -->
                                            <md-checkbox name="requestBatching"
                                                         style="margin-top: 17px; margin-bottom: -2px;"
                                                         class="md-primary"
                                                         ng-model="servingCtrl.editServing.batchingEnabled"
                                                         ng-disabled="servingCtrl.kfserving || servingCtrl.editServing.modelServer === servingCtrl.modelServerPython">
                                            </md-checkbox>
                                            <!-- Kafka -->
                                            <select class="form-control" style="margin-top: 12px; width: 40%"
                                                    name="kafkaTopicName"
                                                    ng-model="servingCtrl.editServing.kafkaTopicDTO"
                                                    ng-options="x.name for x in servingCtrl.projectKafkaTopics"
                                                    ng-change="servingCtrl.updateKafkaDetails(true)"></select>
                                            <input style="margin-top: 5px; width: 40%" name="kafkaNumPartitions"
                                                   class="form-control"
                                                   type="number" min="1"
                                                   ng-model="servingCtrl.editServing.kafkaTopicDTO.numOfPartitions"
                                                   ng-disabled="servingCtrl.editServing.kafkaTopicDTO.name !== 'CREATE'">
                                            <input style="margin-top: 5px; width: 40%" name="kafkaReplicationFactor"
                                                   class="form-control" type="number"
                                                   max="{{servingCtrl.kafkaMaxNumReplicas}}" min="1"
                                                   ng-model="servingCtrl.editServing.kafkaTopicDTO.numOfReplicas"
                                                   ng-disabled="servingCtrl.editServing.kafkaTopicDTO.name !== 'CREATE'">
                                            <div class="row" style="margin-top: 15px">
                                                <div class="col-sm-3 col-md-3 col-lg-3">
                                                    <md-checkbox style="margin-top: 3px" class="md-primary"
                                                                 ng-model="servingCtrl.inferenceLoggingModelInputs"
                                                                 ng-disabled="servingCtrl.editServing.kafkaTopicDTO.name === 'NONE' || !servingCtrl.kfserving">
                                                        Model inputs
                                                    </md-checkbox>
                                                </div>
                                                <div class="col-sm-3 col-md-3 col-lg-3">
                                                    <md-checkbox style="margin-top: 3px" class="md-primary"
                                                                 ng-model="servingCtrl.inferenceLoggingPredictions"
                                                                 ng-disabled="servingCtrl.editServing.kafkaTopicDTO.name === 'NONE' || !servingCtrl.kfserving">
                                                        Predictions
                                                    </md-checkbox>
                                                </div>
                                            </div>
                                            <div ng-show="servingCtrl.hasDockerMemory">
                                                <div style="margin-top: 5px; width:40%;">
                                                    <input type="number" class="form-control" id="mem"
                                                           name="dockerMemory" step="1" ng-min="1024"
                                                           ng-max="servingCtrl.maxDockerMemory"
                                                           ng-model="servingCtrl.editServing.predictorResourceConfig.memory"
                                                           required>
                                                    <span class="text-danger"
                                                          ng-show="(servingCtrl.servingConfigForm.dockerMemory.$dirty) && servingCtrl.servingConfigForm.dockerMemory.$error.number">Must be a number.</span>
                                                    <span class="text-danger"
                                                          ng-show="(servingCtrl.servingConfigForm.dockerMemory.$dirty) && servingCtrl.servingConfigForm.dockerMemory.$error.max">You can at most allocate {{servingCtrl.maxDockerMemory}} MB.</span>
                                                    <span class="text-danger"
                                                          ng-show="(servingCtrl.servingConfigForm.dockerMemory.$dirty) && servingCtrl.servingConfigForm.dockerMemory.$error.min">It is recommended to allocate at minimum 1024 MB.</span>
                                                </div>
                                            </div>
                                            <div ng-show="servingCtrl.hasDockerCores">
                                                <div style="margin-top: 5px; width:40%;">
                                                    <select class="form-control" id="cores"
                                                            ng-model="servingCtrl.editServing.predictorResourceConfig.cores"
                                                            required>
                                                        <option ng-selected="servingCtrl.editServing.predictorResourceConfig.cores === i"
                                                                ng-repeat="i in servingCtrl.range(1, servingCtrl.maxDockerCores)"
                                                                ng-value="i">{{i}}
                                                        </option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div ng-show="servingCtrl.hasDockerGpus">
                                                <div style="margin-top: 5px; width:40%;">
                                                    <select class="form-control" id="gpus"
                                                            ng-model="servingCtrl.editServing.predictorResourceConfig.gpus"
                                                            required>
                                                        <option ng-selected="servingCtrl.editServing.predictorResourceConfig.gpus === i"
                                                                ng-repeat="i in servingCtrl.range(0, servingCtrl.maxDockerGpus)"
                                                                ng-value="i">{{i}}
                                                        </option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3"></div>
                                    <div class="col-xs-6 col-sm-6 col-md-6 col-lg-5">
                                        <button type="button"
                                                style="float:right; margin-bottom: 10px; margin-top: 10px;"
                                                class="btn btn-success" ng-click="servingCtrl.createOrUpdate()">
                                        <span class="fa fa-spinner fa-spin" aria-hidden="true"
                                              ng-if="servingCtrl.sendingRequest === true"></span>
                                            {{servingCtrl.editServing.id == null ? 'Create Serving' : 'Update Serving'}}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>

                    <hr class="col-xs-12 col-sm-12 col-md-12 col-lg-12"
                        ng-if="servingCtrl.showCreateNewServingForm === true"/>

                    <div>
                        <div ng-if="servingCtrl.createNewServingMode === false">
                            <button type="button" ng-click="servingCtrl.showCreateServingForm(true)"
                                    class="btn btn-default btn-success control-label" style="margin: 10px">
                                Create New Serving<i style="margin-left: 10px" class="glyphicon glyphicon-plus">
                            </i>
                            </button>
                        </div>

                        <table class="table table-hover">
                            <thead style="border:none;">
                            <th style="width: 6%"></th>
                            <th style="width: 12%" ng-click="servingCtrl.sort('name')">
                                Serving name
                                <span class="glyphicon sort-icon" ng-show="servingCtrl.sortKey == 'name'"
                                      ng-class="{'glyphicon-chevron-up':!servingCtrl.reverse,'glyphicon-chevron-down':servingCtrl.reverse}"></span>
                            </th>
                            <th style="width: 8%" ng-click="servingCtrl.sort('modelName')">
                                Model name
                                <span class="glyphicon sort-icon" ng-show="servingCtrl.sortKey == 'modelName'"
                                      ng-class="{'glyphicon-chevron-up':!servingCtrl.reverse,'glyphicon-chevron-down':servingCtrl.reverse}"></span>
                            </th>
                            <th style="width: 8%" ng-click="servingCtrl.sort('modelVersion')">
                                Model version
                                <span class="glyphicon sort-icon" ng-show="servingCtrl.sortKey == 'modelVersion'"
                                      ng-class="{'glyphicon-chevron-up':!servingCtrl.reverse,'glyphicon-chevron-down':servingCtrl.reverse}"></span>
                            </th>
                            <th style="width: 9%" ng-click="servingCtrl.sort('artifactVersion')">
                                Artifact version
                                <span class="glyphicon sort-icon" ng-show="servingCtrl.sortKey == 'artifactVersion'"
                            </th>
                            <th style="width: 12%" ng-click="servingCtrl.sort('predictor')">
                                Predictor
                                <span class="glyphicon sort-icon" ng-show="servingCtrl.sortKey == 'predictor'"
                                      ng-class="{'glyphicon-chevron-up':!servingCtrl.reverse,'glyphicon-chevron-down':servingCtrl.reverse}"></span>
                            </th>
                            <th style="width: 12%" ng-click="servingCtrl.sort('transformer')">
                                Transformer
                                <span class="glyphicon sort-icon" ng-show="servingCtrl.sortKey == 'transformer'"
                                      ng-class="{'glyphicon-chevron-up':!servingCtrl.reverse,'glyphicon-chevron-down':servingCtrl.reverse}"></span>
                            </th>
                            <th style="width: 12%" ng-click="servingCtrl.sort('modelServer')">
                                Model server
                                <i class="fa fa-info-circle" tooltip-placement="auto top" tooltip-append-to-body="true"
                                   uib-tooltip='Model server used for running the model, e.g TENSORFLOW_SERVING or PYTHON.'
                                   style="margin-left: 10px"></i>
                                <span class="glyphicon sort-icon" ng-show="servingCtrl.sortKey == 'modelServer'"
                                      ng-class="{'glyphicon-chevron-up':!servingCtrl.reverse,'glyphicon-chevron-down':servingCtrl.reverse}"></span>
                            </th>
                            <th style="width: 14%" ng-click="servingCtrl.sort('created')">
                                Created
                                <span class="glyphicon sort-icon" ng-show="servingCtrl.sortKey == 'created'"
                                      ng-class="{'glyphicon-chevron-up':!servingCtrl.reverse,'glyphicon-chevron-down':servingCtrl.reverse}"></span>
                            </th>
                            <th style="width: 8%" ng-click="servingCtrl.sort('status')">
                                Status
                                <span class="glyphicon sort-icon" ng-show="servingCtrl.sortKey == 'status'"
                                      ng-class="{'glyphicon-chevron-up':!servingCtrl.reverse,'glyphicon-chevron-down':servingCtrl.reverse}"></span>
                            </th>
                            <th style="width: 22%">
                                Actions
                            </th>
                            </thead>
                            <tbody>
                            <tr dir-paginate="serving in servingCtrl.servings| orderBy :servingCtrl.sortKey:servingCtrl.reverse| itemsPerPage:servingCtrl.pageSize"
                                pagination-id="servings_pagination">
                                <td>
                                    <!-- Start -->
                                    <div class="btn-group" role="group" ng-if="serving.status === 'Stopped'">
                                        <button style="max-width: 80px;"
                                                ng-click="servingCtrl.startOrStopServing(serving, 'START'); $event.stopPropagation();"
                                                class="btn btn-default btn-sm btn-block">
                                            <span style="color: #20AD28" class="glyphicon glyphicon-play"
                                                  aria-hidden="true"></span> Run
                                        </button>

                                    </div>

                                    <!-- Stop with starting/update in progress -->
                                    <div class="btn-group" role="group"
                                         ng-if="serving.status === 'Starting' || serving.status === 'Updating'">
                                        <button style="max-width: 80px;" class="btn btn-danger btn-sm btn-block"
                                                ng-click="servingCtrl.startOrStopServing(serving, 'STOP'); $event.stopPropagation();">
                                            <span class="fa fa-spinner fa-spin" aria-hidden="true"></span> Stop
                                        </button>
                                    </div>

                                    <!-- Stopping -->
                                    <div class="btn-group" role="group" ng-if="serving.status === 'Stopping'"
                                         ng-click="servingCtrl.startOrStopServing(serving, 'STOP'); $event.stopPropagation();">
                                        <button style="max-width: 80px;" class="btn btn-danger btn-sm btn-block">
                                            <span class="fa fa-spinner fa-spin" aria-hidden="true"></span> Stopping
                                        </button>
                                    </div>

                                    <!-- Stop -->
                                    <div class="btn-group" role="group" ng-if="serving.status === 'Running'">
                                        <button style="max-width: 80px;" class="btn btn-danger btn-sm btn-block"
                                                ng-click="servingCtrl.startOrStopServing(serving, 'STOP'); $event.stopPropagation();">
                                            <span class="glyphicon glyphicon-stop"></span> Stop
                                        </button>
                                    </div>
                                </td>
                                <td> {{serving.name}}</td>
                                <td> {{serving.modelPath.split("/").pop()}}</td>
                                <td> {{serving.modelVersion}}</td>
                                <td> {{serving.artifactVersion !== undefined ? (serving.artifactVersion == 0 ? "MODEL-ONLY" : serving.artifactVersion) : '-'}}</td>
                                <td> {{serving.predictor ? serving.predictor : '-'}}</td>
                                <td> {{serving.transformer ? serving.transformer : '-'}}</td>
                                <td> {{serving.modelServer}}</td>
                                <td> {{serving.created | date:'medium'}}</td>
                                </td>
                                <td> {{serving.status}}</td>
                                <td class="fs-table">
                                    <div class="btn-group fs-btn" role="group">
                                        <button class="btn btn-info glyphicon glyphicon-edit" uib-tooltip="Edit"
                                                ng-click="servingCtrl.updateServing(serving); $event.stopPropagation();"></button>
                                        <button class="btn btn-danger glyphicon glyphicon-trash" uib-tooltip="Delete"
                                                ng-click="servingCtrl.deleteServing(serving); $event.stopPropagation();"></button>
                                        <button class="btn btn-warning glyphicon glyphicon-list" uib-tooltip="Show Logs"
                                                style="margin-right: -3px;"
                                                ng-click="servingCtrl.showServingLogs(serving); $event.stopPropagation();"></button>
                                        <button style="background-color: rgb(51, 122, 183)"
                                                class="btn btn-primary glyphicon glyphicon-eye-open"
                                                uib-tooltip="Show Detailed Information"
                                                ng-click="servingCtrl.showDetailedInformation(serving); $event.stopPropagation();">
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                        <dir-pagination-controls
                                pagination-id="servings_pagination"
                                class="pull-right"
                                max-size="5"
                                direction-links="true"
                                boundary-links="true">
                        </dir-pagination-controls>
                    </div>
                    <div>
                        <h3 class="text-muted ng-hide" style="text-align: center;"
                            ng-show="servingCtrl.servings.length < 1 && servingCtrl.loaded" aria-hidden="true">
                            No Servings to show
                        </h3>
                    </div>
                    <!-- /#wrapper -->
                </div>
                <div class="" ng-if="servingCtrl.showLogs === true">
                    <button ng-click="servingCtrl.showMainUI();$event.stopPropagation();"
                            class="btn btn-primary btn-md fa fa-table"
                            style="font-size:0.9em; padding:7px 10px; margin-bottom: 3px; background-color:#005571;"
                            onmouseover="this.style.backgroundColor='#004159'"
                            onmouseout="this.style.backgroundColor='#005571'"> Model Serving Summary
                    </button>
                    <iframe style="overflow-y: auto;" id="ui_iframe" ng-src="{{servingCtrl.kibanaUI}}" width="99%"
                            height="86%"></iframe>
                </div>
                <div ng-if="servingCtrl.loading" class="loadingwrap">
                    <div class="loading-content">
                        <div class="loader-in-wrap"></div>
                        {{servingCtrl.loadingText}}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
