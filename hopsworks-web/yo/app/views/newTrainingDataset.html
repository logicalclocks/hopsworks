<!--
  ~ This file is part of Hopsworks
  ~ Copyright (C) 2018, Logical Clocks AB. All rights reserved
  ~
  ~ Hopsworks is free software: you can redistribute it and/or modify it under the terms of
  ~ the GNU Affero General Public License as published by the Free Software Foundation,
  ~ either version 3 of the License, or (at your option) any later version.
  ~
  ~ Hopsworks is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
  ~ without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
  ~ PURPOSE.  See the GNU Affero General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License along with this program.
  ~ If not, see <https://www.gnu.org/licenses/>.
  -->

<div ng-controller="MainCtrl as mainCtrl">
    <div ng-include="'nav.html'"></div>


    <div id="wrapper" class="toggled" ng-controller="newTrainingDatasetCtrl as newTrainingDatasetCtrl">
        <div class="overlay"></div>

        <div ng-include="'navProject.html'"></div>
        <div class="content-wrapper">
            <span style="float: right;margin-top: 7px;" class="fa fa-times-circle fa-2x"
                  ng-click="newTrainingDatasetCtrl.exitToFeaturestore()"
                  uib-tooltip="Clear state and go back to Feature Store main page."
                  ng-if="newTrainingDatasetCtrl.selectFeatureStage || newTrainingDatasetCtrl.trainingDatasetOperation === 'UPDATE'"
            > </span>
            <span style="float: right;margin-top: 7px;" class="fa fa-times-circle fa-2x"
                  ng-click="newTrainingDatasetCtrl.exitToFeatureSearch()"
                  uib-tooltip="Go back to the feature selection stage"
                  ng-if="!newTrainingDatasetCtrl.selectFeatureStage && newTrainingDatasetCtrl.trainingDatasetOperation !== 'UPDATE'"
            > </span>
            <div ng-if="newTrainingDatasetCtrl.selectFeatureStage">
                <h2 style="margin-bottom: 30px;color:#555"
                    ng-if="newTrainingDatasetCtrl.trainingDatasetOperation === 'CREATE'">
                    Select Features to Create a Training Dataset
                    <i class="fa fa-info-circle" tooltip-placement="auto left"
                       uib-tooltip='Training Datasets are immutable snapshots of features in the Feature Store.
                                   A Training Dataset can include features across multiple Feature Groups.'></i>
                </h2>
                <h2 style="margin-bottom: 30px;color:#555"
                    ng-if="newTrainingDatasetCtrl.trainingDatasetOperation === 'UPDATE'">
                    Select Features to Update the Training Dataset
                    <span style="font-weight:700">{{newTrainingDatasetCtrl.trainingDatasetName}}</span>
                    <i class="fa fa-info-circle" tooltip-placement="auto left"
                       uib-tooltip='Training Datasets are immutable snapshots of features in the Feature Store.
                                   A Training Dataset can include features across multiple Feature Groups.'></i>
                </h2>
                <h2 style="margin-bottom: 30px;color:#555"
                    ng-if="newTrainingDatasetCtrl.trainingDatasetOperation === 'NEW_VERSION'">
                    Select Features to Create a New Version of the Training Dataset
                    <span style="font-weight:700">{{newTrainingDatasetCtrl.trainingDatasetName}}</span>
                    <i class="fa fa-info-circle" tooltip-placement="auto left"
                       uib-tooltip='Training Datasets are immutable snapshots of features in the Feature Store.
                                   A Training Dataset can include features across multiple Feature Groups.'></i>
                </h2>
                <div class="row">
                    <div class="col-sm-9">
                        <div>

                            <feature-list id="newTdFeaturesList"
                                          project-id="newTrainingDatasetCtrl.projectId"
                                          project-name="newTrainingDatasetCtrl.projectName"
                                          featurestore="newTrainingDatasetCtrl.featurestore"
                                          features="newTrainingDatasetCtrl.features"
                                          settings="newTrainingDatasetCtrl.settings"
                                          add-feature-to-basket="newTrainingDatasetCtrl.addFeatureToBasket"
                                          feature-in-basket="newTrainingDatasetCtrl.featureInBasket">
                            </feature-list>

                            <div class="row divider" style="margin-bottom: 0px;"></div>
                            <div class="row" style="margin-top: -20px">
                                <dir-pagination-controls
                                        ng-if="filteredResults.length > 0"
                                        max-size="15"
                                        direction-links="true"
                                        boundary-links="true"
                                        class="no-margin-pagination pull-right">
                                </dir-pagination-controls>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div class="pull-left" style="margin-left:20px">
                            <div class="row">
                                <a ng-click="newTrainingDatasetCtrl.toggleCart()"
                                   style="color:rgb(51, 51, 51); font-size:20px;">
                                    <i class="fa fa-shopping-cart fa-2x"></i>
                                    Checkout Features
                                    <span class="shop-badge">
                                        {{newTrainingDatasetCtrl.featureBasket.length}}
                                    </span>
                                </a>
                            </div>
                            <div class="shopping-cart row" ng-if="newTrainingDatasetCtrl.showCart" class="animate-if">
                                <div class="shopping-cart-header">
                                    <i class="fa fa-shopping-cart fa-2x cart-icon"></i><span class="shop-badge">{{newTrainingDatasetCtrl.featureBasket.length}}</span>
                                    <div class="shopping-cart-total pull-right">
                                        <span class="lighter-text">Total:</span>
                                        <span class="main-color-text">{{newTrainingDatasetCtrl.featureBasket.length}}
                                            Features from {{newTrainingDatasetCtrl.basketFeaturegroups().length}}
                                            Feature Groups
                                        </span>
                                    </div>
                                </div>

                                <dir-pagination-controls
                                        pagination-id="featuresbasket"
                                        class="pull-right"
                                        max-size="5"
                                        direction-links="true"
                                        boundary-links="true"></dir-pagination-controls>

                                <ul class="shopping-cart-items"
                                    dir-paginate="basketFeature in newTrainingDatasetCtrl.featureBasket | itemsPerPage:5 "
                                    pagination-id="featuresbasket">

                                    <li class="clearfix">
                                        <button class="btn btn-danger fa fa-trash fa-xs"
                                                style="padding: 3px 8px;"
                                                uib-tooltip="Delete"
                                                ng-click="newTrainingDatasetCtrl.removeFeatureFromBasket($index);"></button>
                                        <span class="item-name">{{basketFeature.name}}</span>
                                        <span class="item-price">Type: {{basketFeature.type}}</span>
                                        <div class="item-quantity">Feature Group: {{basketFeature.featuregroup
                                            .name}}</div>
                                    </li>
                                </ul>
                                <a class="btn btn-success" 
                                   style="margin-top: 5px;"
                                   ng-click="newTrainingDatasetCtrl.setupQueryPlan()"
                                   ng-disabled="newTrainingDatasetCtrl.featureBasket.length === 0">
                                    <span ng-if="newTrainingDatasetCtrl.trainingDatasetOperation === 'CREATE' || newTrainingDatasetCtrl.trainingDatasetOperation === 'NEW_VERSION'">
                                        Create training dataset
                                    </span> 
                                    <span ng-if="newTrainingDatasetCtrl.trainingDatasetOperation === 'UPDATE'">
                                        Update training dataset
                                    </span> 
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div ng-if="!newTrainingDatasetCtrl.selectFeatureStage">
                <div>
                    <div class="row">
                        <div class="panel-header col-md-12">

                            <h2 ng-if="newTrainingDatasetCtrl.trainingDatasetOperation === 'CREATE'">
                                New Training Dataset Definition
                            </h2>
                            <h2 ng-if="newTrainingDatasetCtrl.trainingDatasetOperation === 'UPDATE'">
                                Update Training Dataset: <span style="font-weight:700">{{newTrainingDatasetCtrl.trainingDataset.name}}</span>
                            </h2>
                            <h2 ng-if="newTrainingDatasetCtrl.trainingDatasetOperation === 'NEW_VERSION'">
                                Create New Version of Training Dataset: <span style="font-weight:700">{{newTrainingDatasetCtrl.trainingDataset.name}}</span>
                            </h2>
                        </div>
                    </div>
                    <div uib-accordion close-others="false">

                        <div uib-accordion-group class="panel-default"
                             is-open="newTrainingDatasetCtrl.td_accordion0.isOpen"
                             ng-if="newTrainingDatasetCtrl.trainingDatasetOperation !== 'UPDATE'"
                        >
                            <div uib-accordion-heading>
                                <i class="fa fa-info-circle" tooltip-placement="auto left"
                                   uib-tooltip='Query Plan for creating the Training Dataset'></i>
                                <span style="margin-left: 20px">
                                    {{newTrainingDatasetCtrl.td_accordion0.title}}
                                    {{newTrainingDatasetCtrl.td_accordion0.value}}
                                    </span>
                                <span class="fa fa-database"
                                      style="margin-left: 10px"></span>
                                <span ng-if="newTrainingDatasetCtrl.queryPlanWrongValue === -1"
                                      class="glyphicon glyphicon-alert" tooltip-placement="auto left"
                                      uib-tooltip='A valid query plan could not be inferred'
                                      style="margin-left: 10px"></span>
                            </div>
                            <div>
                                <div class="row">
                                    <div class="col-sm-2">
                                        <span style="font-weight:bold"> Feature Groups</span>
                                    </div>
                                    <div class="col-sm-10">
                                        <div class="row">
                                            <div class="col-sm-5 fs_card card card-inverse card-success"
                                                 ng-repeat="featuregroup in newTrainingDatasetCtrl.queryPlan.featuregroups"
                                            >
                                                <div class="fs_card card-block bg-success">
                                                    Feature Group: {{featuregroup.name}}
                                                    <br>
                                                    Version:
                                                    {{featuregroup.version}}
                                                    <br>
                                                    {{newTrainingDatasetCtrl.getSelectStr(featuregroup)}}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row" style="margin-top:20px"
                                     ng-if="newTrainingDatasetCtrl.queryPlan.featuregroups.length > 0">
                                    <div class="col-sm-2">
                                        <span style="font-weight:bold"> Join Key</span>
                                    </div>
                                    <div class="col-sm-10">
                                        <ui-select ng-model="newTrainingDatasetCtrl.queryPlan.joinKey"
                                                   style="z-index: 100; margin-left:-20px"
                                                   ng-if="newTrainingDatasetCtrl.queryPlan.possibleJoinKeys.length > 0"
                                        >
                                            <ui-select-match placeholder="Select a join key">
                                                <span>{{$select.selected}}</span>
                                            </ui-select-match>
                                            <ui-select-choices
                                                    repeat="key in newTrainingDatasetCtrl.queryPlan.possibleJoinKeys">
                                                <span ng-bind="key"></span>
                                            </ui-select-choices>
                                        </ui-select>
                                        <div
                                                ng-if="newTrainingDatasetCtrl.joinKeyWrongValue === -1"
                                                style="color: red">
                                            <p>
                                                No common join key exists between the feature groups where the selected
                                                features reside. Please go back and update the feature list such that
                                                a common join key can be found. For complex feature joins, use the
                                                Python/Java/Scala Featurestore API directly.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <div uib-accordion-group class="panel-default"
                             is-open="newTrainingDatasetCtrl.td_accordion1.isOpen">
                            <div uib-accordion-heading>
                                <i class="fa fa-info-circle" tooltip-placement="auto left"
                                   uib-tooltip='The name of the Training Dataset'></i>
                                <span style="margin-left: 20px">
                                    {{newTrainingDatasetCtrl.td_accordion1.title}}
                                    {{newTrainingDatasetCtrl.td_accordion1.value}}
                                    </span>
                                <span ng-if="newTrainingDatasetCtrl.trainingDatasetNameWrongValue === -1"
                                      class="glyphicon glyphicon-alert" tooltip-placement="auto left"
                                      uib-tooltip='The provided Training Dataset name is not valid'
                                      style="margin-left: 10px"></span>
                            </div>
                            <input type="text" class="form-control"
                                   placeholder="Enter a Training Dataset Name"
                                   value="newTrainingDatasetCtrl.trainingDatasetName"
                                   ng-model="newTrainingDatasetCtrl.trainingDatasetName"
                                   ng-change="newTrainingDatasetCtrl.nameFilledIn()"
                                   autofocus
                                   ng-if="newTrainingDatasetCtrl.trainingDatasetOperation === 'CREATE'">
                            <input type="text" class="form-control"
                                   placeholder="Enter a Training Dataset Name"
                                   value="newTrainingDatasetCtrl.trainingDatasetName"
                                   ng-model="newTrainingDatasetCtrl.trainingDatasetName"
                                   ng-change="newTrainingDatasetCtrl.nameFilledIn()"
                                   autofocus
                                   readonly
                                   ng-if="newTrainingDatasetCtrl.trainingDatasetOperation === 'NEW_VERSION' || newTrainingDatasetCtrl.trainingDatasetOperation === 'UPDATE'">
                            <div
                                    ng-if="newTrainingDatasetCtrl.trainingDatasetNameWrongValue === -1"
                                    style="color: red">
                                <p>
                                    Training dataset name shouldn't be empty and can only contain lower case
                                    alphanumeric characters and underscores, maximum length is
                                    {{newTrainingDatasetCtrl.trainingDatasetNameMaxLength}}
                                    characters. Hyphens are not allowed in the training dataset name.
                                </p>
                            </div>
                        </div>

                        <div uib-accordion-group class="panel-default"
                             is-open="newTrainingDatasetCtrl.td_accordion2.isOpen"
                             id="trainingDatasetDocDiv">
                            <div uib-accordion-heading>
                                <i class="fa fa-info-circle" tooltip-placement="auto left"
                                   uib-tooltip='A description of the Training Dataset.'></i>
                                <span style="margin-left: 20px">
                                    {{newTrainingDatasetCtrl.td_accordion2.title}}
                                    {{newTrainingDatasetCtrl.td_accordion2.value}}
                                    </span>
                                <span ng-if="newTrainingDatasetCtrl.trainingDatasetDocWrongValue === -1"
                                      class="glyphicon glyphicon-alert" tooltip-placement="auto left"
                                      uib-tooltip='The provided Training Dataset Description is not valid'
                                      style="margin-left: 10px"></span>
                            </div>
                            <input type="text" class="form-control"
                                   placeholder="Enter a Training Dataset Description"
                                   value="newTrainingDatasetCtrl.trainingDatasetDoc"
                                   ng-model="newTrainingDatasetCtrl.trainingDatasetDoc"
                                   ng-change="newTrainingDatasetCtrl.descriptionFilledIn()"
                            >
                            <div
                                    ng-if="newTrainingDatasetCtrl.trainingDatasetDocWrongValue === -1"
                                    style="color: red">
                                <p>
                                    Training Dataset Description should not exceed the maximum length of
                                    {{newTrainingDatasetCtrl.trainingDatasetDescriptionMaxLength}} characters.
                                </p>
                            </div>
                        </div>

                        <div uib-accordion-group class="panel-default"
                             is-open="newTrainingDatasetCtrl.td_accordion3.isOpen"
                        >
                            <div uib-accordion-heading>
                                <i class="fa fa-info-circle" tooltip-placement="auto left"
                                   uib-tooltip='The data format of the Training Dataset'></i>
                                <span style="margin-left: 20px">
                                    {{newTrainingDatasetCtrl.td_accordion3.title}}
                                    {{newTrainingDatasetCtrl.td_accordion3.value}}
                                    </span>
                                <span ng-if="newTrainingDatasetCtrl.trainingDatasetDataFormatWrongValue === -1"
                                      class="glyphicon glyphicon-alert" tooltip-placement="auto left"
                                      uib-tooltip='The selected data format is not valid'
                                      style="margin-left: 10px"></span>
                            </div>
                            <ui-select ng-model="newTrainingDatasetCtrl.trainingDatasetFormat"
                                       ng-disabled="newTrainingDatasetCtrl.trainingDatasetOperation === 'UPDATE'"
                                       style="z-index: 100">
                                <ui-select-match placeholder="Select a data format for the training dataset">
                                    <span>{{$select.selected}}</span>
                                </ui-select-match>
                                <ui-select-choices
                                        repeat="dataformat in newTrainingDatasetCtrl.dataFormats">
                                    <span ng-bind="dataformat"></span>
                                </ui-select-choices>
                            </ui-select>
                            <div
                                    ng-if="newTrainingDatasetCtrl.trainingDatasetDataFormatWrongValue === -1"
                                    style="color: red">
                                <p>
                                    You must select one of the supported data formats for the training dataset.
                                </p>
                            </div>
                        </div>

                        <div uib-accordion-group class="panel-default"
                             is-open="newTrainingDatasetCtrl.td_accordion5.isOpen"
                        >
                            <div uib-accordion-heading>
                                <i class="fa fa-info-circle" tooltip-placement="auto left"
                                   uib-tooltip='The sink where the training dataset will be written'></i>
                                <span style="margin-left: 20px">
                                    {{newTrainingDatasetCtrl.td_accordion5.title}}
                                    {{newTrainingDatasetCtrl.td_accordion5.value}}
                                    </span>
                                <span ng-if="newTrainingDatasetCtrl.sinkWrongValue === -1"
                                      class="glyphicon glyphicon-alert" tooltip-placement="auto left"
                                      uib-tooltip='The selected output sink is not valid'
                                      style="margin-left: 10px"></span>
                            </div>

                            <div class="view-info">
                                <div class="col-md-12">
                                    <div class="col-sm-12" style="margin-bottom: 20px">
                                        <div class="col-sm-3">
                                        </div>
                                        <div class="col-sm-9">
                                            <div class="btn-group blocks" style="padding: 0px;">
                                                <div style="display: inline-block; vertical-align: top;">
                                                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                                        <label class="btn btn-default btn-md"
                                                               id="hopsfs_sink_type"
                                                               ng-click="newTrainingDatasetCtrl.setSinkType(0);"
                                                               ng-class="{unset: newTrainingDatasetCtrl.sinkType !== 0}"
                                                               style="margin:2px; background:rgb(108, 117, 125); color:white; z-index:2">
                                                            <input type="radio" value="HOPSFS_SINK"
                                                                   id="HOPSFS_SINK">
                                                            HopsFS Connector
                                                            <i class="fa fa-info-circle"
                                                               uib-tooltip="To store the training dataset on HopsFS
                                                               in your project, select a configured HopsFS connector"
                                                               tooltip-placement="left" style="margin-left: 10px">
                                                            </i>
                                                        </label>
                                                        <label class="btn btn-default btn-md"
                                                               ng-click="newTrainingDatasetCtrl.setSinkType(1);"
                                                               ng-class="{unset: newTrainingDatasetCtrl.sinkType !== 1}"
                                                               style="margin:2px; background:rgb(108, 117, 125); color:white; z-index:2">
                                                            <input type="radio" value="SQL_JOB"
                                                                   id="SQL_JOB">
                                                            S3 Connector
                                                            <i class="fa fa-info-circle"
                                                               uib-tooltip="To store the training dataset on S3,
                                                               select a configured S3 connector"
                                                               tooltip-placement="left" style="margin-left: 10px">
                                                            </i>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                            <br>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="view-info" ng-if="newTrainingDatasetCtrl.sinkType === 0">
                                <div class="col-md-12">
                                    <div class="col-sm-12" style="margin-bottom: 20px">
                                        <div class="col-sm-3">
                                            <i class="fa fa-info-circle" tooltip-placement="auto left"
                                               uib-tooltip='The HopsFS Connector to use for storing the Training Dataset'></i>
                                            <label style="margin-left:20px;" class="control-label">
                                                HopsFS connector:
                                            </label>
                                        </div>
                                        <div class="col-sm-9">
                                            <ui-select ng-model="newTrainingDatasetCtrl.selectedHopsfsConnector"
                                                       style="z-index: 100"
                                                       ng-if="newTrainingDatasetCtrl.hopsfsConnectors.length > 0"
                                                       ng-disabled="newTrainingDatasetCtrl.trainingDatasetOperation === 'UPDATE'">
                                                <ui-select-match placeholder="Select a HopsFS Connector">
                                                    <span>{{$select.selected.name}}</span>
                                                </ui-select-match>
                                                <ui-select-choices repeat="hopsfs in newTrainingDatasetCtrl.hopsfsConnectors">
                                                    <span ng-bind="hopsfs.name"></span>
                                                </ui-select-choices>
                                            </ui-select>
                                            <div ng-if="newTrainingDatasetCtrl.hopsfsConnectors.length === 0">
                                                No HopsFS Connectors have been configured for this Feature Store
                                            </div>
                                            <div
                                                    ng-if="newTrainingDatasetCtrl.trainingDatasetSinkNotSelected === -1"
                                                    style="color: red">
                                                <p>
                                                    You must select one of the configured HopsFS or S3 connectors as output sink for
                                                    the training dataset.
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="view-info" ng-if="newTrainingDatasetCtrl.sinkType === 1">
                                <div class="col-md-12">
                                    <div class="col-sm-12" style="margin-bottom: 20px">
                                        <div class="col-sm-3">
                                            <i class="fa fa-info-circle" tooltip-placement="auto left"
                                               uib-tooltip='The S3 Connector to use for storing the Training Dataset'></i>
                                            <label style="margin-left:20px;" class="control-label">
                                                S3 connector:
                                            </label>
                                        </div>
                                        <div class="col-sm-9">
                                            <ui-select ng-model="newTrainingDatasetCtrl.selectedS3Connector"
                                                       style="z-index: 100"
                                                       ng-disabled="newTrainingDatasetCtrl.trainingDatasetOperation === 'UPDATE'"
                                                       ng-if="newTrainingDatasetCtrl.s3Connectors.length > 0">
                                                <ui-select-match placeholder="Select a S3 Connector">
                                                    <span>{{$select.selected.name}}</span>
                                                </ui-select-match>
                                                <ui-select-choices repeat="s3 in newTrainingDatasetCtrl.s3Connectors">
                                                    <span ng-bind="s3.name"></span>
                                                </ui-select-choices>
                                            </ui-select>
                                            <div ng-if="newTrainingDatasetCtrl.s3Connectors.length === 0">
                                                No S3 Connectors have been configured for this Feature Store
                                            </div>
                                            <div
                                                    ng-if="newTrainingDatasetCtrl.trainingDatasetSinkNotSelected === -1"
                                                    style="color: red">
                                                <p>
                                                    You must select one of the configured HopsFS or S3 connectors as output sink for
                                                    the training dataset.
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="col-sm-12" style="margin-bottom: 20px">
                                        <div class="col-sm-3">
                                            <i class="fa fa-info-circle" tooltip-placement="auto left"
                                               uib-tooltip='The path within the bucket where to store the Training Dataset'></i>
                                            <label style="margin-left:20px;" class="control-label">
                                                Path (Optional):
                                            </label>
                                        </div>
                                        <div class="col-sm-9">
                                            <input type="text" class="form-control"
                                               placeholder="Path"
                                               value="newTrainingDatasetCtrl.path"
                                               ng-model="newTrainingDatasetCtrl.path"
                                               ng-disabled="newTrainingDatasetCtrl.trainingDatasetOperation === 'UPDATE'"
                                               autofocus
                                               ng-if="newTrainingDatasetCtrl.sinkType === 1">
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <div uib-accordion-group class="panel-default"
                             is-open="newTrainingDatasetCtrl.td_accordion6.isOpen"
                             ng-show="newTrainingDatasetCtrl.trainingDatasetOperation === 'NEW_VERSION'"
                             id="featuregroupSchemaDiv">
                            <div uib-accordion-heading>
                                <i class="fa fa-info-circle" tooltip-placement="auto left"
                                   uib-tooltip='The schema of a training dataset is inferred upon creation.'></i>
                                <span style="margin-left: 20px">
                                    {{newTrainingDatasetCtrl.td_accordion6.title}}
                                    {{newTrainingDatasetCtrl.td_accordion6.value}}
                                    </span>
                            </div>
                            <div data-ng-repeat="feature in newTrainingDatasetCtrl.trainingDataset.features track by $index">
                                <div class="view-info">
                                    <div class="col-md-12">
                                        <div class="col-sm-12" style="margin-bottom: 20px">
                                            <div class="col-sm-3">
                                                <i class="fa fa-info-circle" tooltip-placement="auto left"
                                                   uib-tooltip='The name of the feature'></i>
                                                <label style="margin-left:10px" class="control-label">Feature
                                                    name:</label>
                                            </div>
                                            <div class="col-sm-9">
                                                <input type="text" class="form-control"
                                                       placeholder="Enter a feature name"
                                                       value="{{feature.name}}"
                                                       ng-disabled="newTrainingDatasetCtrl.trainingDatasetOperation === 'UPDATE'"
                                                       ng-model="newTrainingDatasetCtrl.trainingDataset.features[$index].name">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="view-info">
                                    <div class="col-md-12">
                                        <div class="col-sm-12" style="margin-bottom: 20px">
                                            <div class="col-sm-3">
                                                <i class="fa fa-info-circle" tooltip-placement="auto left"
                                                   uib-tooltip='The data type of the feature'></i>
                                                <label style="margin-left:10px">
                                                    <button style="margin-top: 5px;" id="selectArchiveButton"
                                                            class="btn btn-sm btn-default"
                                                            ng-disabled="newTrainingDatasetCtrl.trainingDatasetOperation === 'UPDATE'"
                                                            ng-click="newTrainingDatasetCtrl.selectFeatureType(newTrainingDatasetCtrl.trainingDataset.features[$index])">
                                                        <span>Feature type:</span>
                                                    </button>
                                                </label>
                                            </div>
                                            <div class="col-sm-9">
                                                <input type="text" class="form-control"
                                                       ng-model="newTrainingDatasetCtrl.trainingDataset.features[$index].type"
                                                       placeholder="Select a feature type" readonly>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="view-info">
                                    <div class="col-md-12">
                                        <div class="col-sm-12">
                                            <div class="col-sm-3">
                                                <i class="fa fa-info-circle" tooltip-placement="auto left"
                                                   uib-tooltip='The feature description'></i>
                                                <label style="margin-left:10px" class="control-label">Feature
                                                    description:</label>
                                            </div>
                                            <div class="col-sm-9">
                                                <input type="text" class="form-control"
                                                       placeholder="Enter a feature description"
                                                       value="{{feature.description}}"
                                                       ng-model="newTrainingDatasetCtrl.trainingDataset.features[$index].description">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="view-info">
                                    <div class="col-md-12">
                                        <div class="col-sm-12" style="margin-bottom: 20px">
                                            <div class="col-sm-3">
                                            </div>
                                            <div class="col-sm-9">
                                                <button class="btn btn-sm btn-danger glyphicon glyphicon-trash"
                                                        uib-tooltip="delete"
                                                        ng-click="newTrainingDatasetCtrl.removeFeature($index)"
                                                        ng-disabled="newTrainingDatasetCtrl.trainingDatasetOperation === 'UPDATE'"
                                                >
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="view-info">
                                <div class="col-md-12">
                                    <div class="col-sm-12" style="margin-bottom: 20px">
                                        <div class="col-sm-3">
                                            <button type="button"
                                                    ng-click="newTrainingDatasetCtrl.addNewFeature()"
                                                    class="btn btn-sm btn-default btn-success control-label"
                                                    ng-disabled="newTrainingDatasetCtrl.trainingDatasetOperation === 'UPDATE'"
                                                    style="margin-bottom:10px">
                                                Add Feature<i style="margin-left: 10px"
                                                              class="glyphicon glyphicon-plus">
                                            </i>
                                            </button>
                                        </div>
                                        <div class="col-sm-9">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div uib-accordion-group class="panel-default"
                             is-open="newTrainingDatasetCtrl.td_accordion4.isOpen"
                        >
                            <div uib-accordion-heading>
                                <i class="fa fa-info-circle" tooltip-placement="auto left"
                                   uib-tooltip='Creating a Training Dataset will join the selected features together and store them
                                   in the preferred data format in the selected data sink.'
                                   ng-if="newTrainingDatasetCtrl.trainingDatasetOperation === 'CREATE' || newTrainingDatasetCtrl.trainingDatasetOperation === 'NEW_VERSION'"
                                ></i>
                                <i class="fa fa-info-circle" tooltip-placement="auto left"
                                   uib-tooltip='Updating a Training Dataset will update the associated metadata'
                                   ng-if="newTrainingDatasetCtrl.trainingDatasetOperation === 'UPDATE'"
                                ></i>
                                <span style="margin-left: 20px">
                                     {{newTrainingDatasetCtrl.td_accordion4.title}}
                                    {{newTrainingDatasetCtrl.td_accordion4.value}}
                                    </span>
                            </div>
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="form-group"
                                         ng-if="newTrainingDatasetCtrl.trainingDatasetOperation === 'CREATE' || newTrainingDatasetCtrl.trainingDatasetOperation === 'NEW_VERSION'">
                                        <button ng-click="newTrainingDatasetCtrl.createTrainingDataset()"
                                                class="btn btn-default btn-success"
                                        >
                                            Create
                                            <i ng-if="newTrainingDatasetCtrl.working" style="margin-top: 2px"
                                               class="fa fa-spinner fa-spin pull-right"></i>
                                        </button>
                                        <md-checkbox class="md-primary"
                                                     ng-checked="newTrainingDatasetCtrl.configureJob"
                                                     ng-click="newTrainingDatasetCtrl.setConfigureJob()"
                                                     aria-label="If this box is checked, a Spark job for creating the Training Dataset will be configured automatically"
                                                     style="margin-left:20px;"
                                                     dir="rtl"
                                        >
                                            <span>Configure Spark Job for creating the training dataset</span>
                                        </md-checkbox>
                                    </div>
                                    <button ng-click="newTrainingDatasetCtrl.updateTrainingDatasetMetadata()"
                                            class="btn btn-default btn-success"
                                            ng-if="newTrainingDatasetCtrl.trainingDatasetOperation === 'UPDATE'"
                                    >
                                        Update
                                        <i ng-if="newTrainingDatasetCtrl.working" style="margin-top: 2px"
                                           class="fa fa-spinner fa-spin pull-right"></i>
                                    </button>
                                </div>
                                <div class="col-sm-4 alert alert-warning" role="alert"
                                     ng-show="newTrainingDatasetCtrl.trainingDatasetWrong_values === -1">
                                    There are errors in your input configuration, see error messages above.
                                </div>
                                <div class="col-sm-2">
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<!-- /#wrapper -->
